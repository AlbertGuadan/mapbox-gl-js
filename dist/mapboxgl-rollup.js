!function(t,e){if(!function(){try{return self instanceof WorkerGlobalScope}catch(t){return!1}}()){const t=e;e=function(){const e=`const mbgl = (${t})();\n                mbgl._createWorker(self);`,i=t();return i.workerUrl=window.URL.createObjectURL(new Blob([e],{type:"text/javascript"})),i}}"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mapboxgl=e()}(this,function(){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}e&&e.terminate();return URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&function(t){void 0===i[t]&&(i[t]=function(t){var i=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",n)||i.probablySupportsContext("experimental-webgl",n):i.supportsContext?i.supportsContext("webgl",n)||i.supportsContext("experimental-webgl",n):i.getContext("webgl",n)||i.getContext("experimental-webgl",n)}(t));return i[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),i=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),n=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,r=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,o={now:i,frame:function(t){return n(t)},cancelFrame:function(t){return r(t)},getImageData:function(t){var e=self.document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(0,0,t.width,t.height)},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},supportsWebp:!1};o.devicePixelRatio;if(self.document){var a=self.document.createElement("img");a.onload=function(){o.supportsWebp=!0},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="}var s=l;function l(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}l.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},l.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},l.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},l.prototype.solveCurveX=function(t,e){var i,n,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},l.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var u=function(t,e,i){this.column=t,this.row=e,this.zoom=i};u.prototype.clone=function(){return new u(this.column,this.row,this.zoom)},u.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},u.prototype.sub=function(t){return this.clone()._sub(t)},u.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},u.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this};var c=h;function h(t,e){this.x=t,this.y=e}function p(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!p(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!p(t[n],e[n]))return!1;return!0}return t===e}function f(t,e,i,n){var r=new s(t,e,i,n);return function(t){return r.solve(t)}}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.x+i*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=r,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(t){return t instanceof h?t:Array.isArray(t)?new h(t[0],t[1]):t};var d=f(.25,.1,.25,1);function m(t,e,i){return Math.min(i,Math.max(e,t))}function y(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function g(t,e,i){if(!t.length)return i(null,[]);var n=t.length,r=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),r[a]=e,0==--n&&i(o,r)})})}function v(t){var e=[];for(var i in t)e.push(t[i]);return e}function _(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var o=r[n];for(var a in o)t[a]=o[a]}return t}function x(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i}var b=1;function w(){return b++}function T(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function S(t,e){return-1!==t.indexOf(e,t.length-e.length)}function z(t,e,i){var n={};for(var r in t)n[r]=e.call(i||this,t[r],r,t);return n}function A(t,e,i){var n={};for(var r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n}function k(t){return Array.isArray(t)?t.map(k):"object"==typeof t&&t?z(t,k):t}function E(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}var I={};function M(t){I[t]||("undefined"!=typeof console&&console.warn(t),I[t]=!0)}function C(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function P(t){for(var e=0,i=0,n=t.length,r=n-1,o=void 0,a=void 0;i<n;r=i++)o=t[i],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e}var L={create:function(t,e,i){var n=self.document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n},createNS:function(t,e){return self.document.createElementNS(t,e)}},D=self.document?self.document.documentElement.style:null;function R(t){if(!D)return null;for(var e=0;e<t.length;e++)if(t[e]in D)return t[e];return t[0]}var B,O=R(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);L.disableDrag=function(){O&&(B=D[O],D[O]="none")},L.enableDrag=function(){O&&(D[O]=B)};var F=R(["transform","WebkitTransform"]);L.setTransform=function(t,e){t.style[F]=e};var j=function(t){t.preventDefault(),t.stopPropagation(),self.removeEventListener("click",j,!0)};L.suppressClick=function(){self.addEventListener("click",j,!0),self.setTimeout(function(){self.removeEventListener("click",j,!0)},0)},L.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new c(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)},L.touchPos=function(t,e){for(var i=t.getBoundingClientRect(),n=[],r="touchend"===e.type?e.changedTouches:e.touches,o=0;o<r.length;o++)n.push(new c(r[o].clientX-i.left-t.clientLeft,r[o].clientY-i.top-t.clientTop));return n},L.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var V={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(V);var N=function(t){function e(e,i){t.call(this,e),this.status=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error);function U(t){var e=new self.XMLHttpRequest;for(var i in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(i,t.headers[i]);return e.withCredentials="include"===t.credentials,e}var q=function(t,e){var i=U(t);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return e(t)}e(null,t)}else e(new N(i.statusText,i.status))},i.send(),i},Z=function(t,e){var i=U(t);return i.responseType="arraybuffer",i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){var t=i.response;if(0===t.byteLength&&200===i.status)return e(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?e(null,{data:t,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):e(new N(i.statusText,i.status))},i.send(),i};var G=function(t,e){return Z(t,function(t,i){if(t)e(t);else if(i){var n=new self.Image,r=self.URL||self.webkitURL;n.onload=function(){e(null,n),r.revokeObjectURL(n.src)};var o=new self.Blob([new Uint8Array(i.data)],{type:"image/png"});n.cacheControl=i.cacheControl,n.expires=i.expires,n.src=i.data.byteLength?r.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}})};function W(t,e,i){i[t]=i[t]||[],i[t].push(e)}function X(t,e,i){if(i&&i[t]){var n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}var H=function(){};H.prototype.on=function(t,e){return this._listeners=this._listeners||{},W(t,e,this._listeners),this},H.prototype.off=function(t,e){return X(t,e,this._listeners),X(t,e,this._oneTimeListeners),this},H.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},W(t,e,this._oneTimeListeners),this},H.prototype.fire=function(t,e){if(this.listens(t)){e=_({},e,{type:t,target:this});for(var i=0,n=this._listeners&&this._listeners[t]?this._listeners[t].slice():[];i<n.length;i+=1){n[i].call(this,e)}for(var r=0,o=this._oneTimeListeners&&this._oneTimeListeners[t]?this._oneTimeListeners[t].slice():[];r<o.length;r+=1){var a=o[r];X(t,a,this._oneTimeListeners),a.call(this,e)}this._eventedParent&&this._eventedParent.fire(t,_({},e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}else S(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},H.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},H.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var K={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties.",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property.",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties.",example:{duration:300,delay:0}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_canvas"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A raster DEM source using Mapbox Terrain RGB"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups."},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{doc:"A canvas data source."}},doc:"The data type of the canvas source."},coordinates:{required:!0,doc:"Corners of canvas specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}},animate:{type:"boolean",default:"true",doc:"Whether the canvas source is animated. If the canvas is static, `animate` should be set to `false` to improve performance."},canvas:{type:"string",required:!0,doc:"HTML ID of the canvas from which to read pixels."}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB tiles","sdk-support":{"basic functionality":{js:"0.43.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:"A expression specifying conditions on source features. Only features that match the filter are displayed."},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},layout_fill:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},layout_circle:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0"}}}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"},"data-driven styling":{}}},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"data-driven styling":{}}},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"data-driven styling":{}}},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,doc:"Name of image in sprite to use for drawing an image background. Within literal values and zoom functions, property names enclosed in curly brackets (e.g. `{token}`) are replaced with the value of the named property. Expressions and property functions do not support this syntax; for equivalent functionality in expressions, use the [`concat`](#expressions-concat) and [`get`](#expressions-get) operators.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"icon-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{}}},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"},"data-driven styling":{}}},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"},"data-driven styling":{}}},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0,doc:"Value to use for a text label. Within literal values and zoom functions, property names enclosed in curly brackets (e.g. `{token}`) are replaced with the value of the named property. Expressions and property functions do not support this syntax; for equivalent functionality in expressions, use the [`concat`](#expressions-concat) and [`get`](#expressions-get) operators.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,"property-function":!0,doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,doc:"The maximum line width for text wrapping.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}}},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,"property-function":!0,doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.",value:"number",units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,length:2,default:[0,0],requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0"},"data-driven styling":{}}}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding"},var:{doc:'References variable bound using "let".',group:"Variable binding"},literal:{doc:"Provides a literal array or object value.",group:"Types"},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types"},at:{doc:"Retrieves an item from an array.",group:"Lookup"},case:{doc:"Selects the first output whose corresponding test condition evaluates to true.",group:"Decision"},match:{doc:'Selects the output whose label value matches the input value, or the fallback value if no match is found. The `input` can be any string or number expression (e.g. `["get", "building_type"]`). Each label can either be a single literal value or an array of values.',group:"Decision"},coalesce:{doc:"Evaluates each expression in turn until the first non-null value is obtained, and returns that value.",group:"Decision"},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first input if the input is less than the first stop.',group:"Ramps, scales, curves"},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves"},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math"},pi:{doc:"Returns the mathematical constant pi.",group:"Math"},e:{doc:"Returns the mathematical constant e.",group:"Math"},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types"},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string value is obtained. If none of the inputs are strings, the expression is an error.",group:"Types"},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number value is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types"},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean value is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types"},object:{doc:"Asserts that the input value is an object. If it is not, the expression is an error.",group:"Types"},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `"null"`. If the input is a boolean, the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a color, it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types"},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types"},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types"},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color"},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types"},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color"},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color"},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns null if the requested property is missing.",group:"Lookup"},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup"},length:{doc:"Gets the length of an array or string.",group:"Lookup"},properties:{doc:'Gets the feature properties object.  Note that in some cases, it may be more efficient to use ["get", "property_name"] directly.',group:"Feature data"},"geometry-type":{doc:"Gets the feature's geometry type: Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon.",group:"Feature data"},id:{doc:"Gets the feature's id, if it has one.",group:"Feature data"},zoom:{doc:'Gets the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Zoom"},"heatmap-density":{doc:"Gets the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap"},"+":{doc:"Returns the sum of the inputs.",group:"Math"},"*":{doc:"Returns the product of the inputs.",group:"Math"},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math"},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math"},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math"},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math"},sqrt:{doc:"Returns the square root of the input.",group:"Math"},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math"},ln:{doc:"Returns the natural logarithm of the input.",group:"Math"},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math"},sin:{doc:"Returns the sine of the input.",group:"Math"},cos:{doc:"Returns the cosine of the input.",group:"Math"},tan:{doc:"Returns the tangent of the input.",group:"Math"},asin:{doc:"Returns the arcsine of the input.",group:"Math"},acos:{doc:"Returns the arccosine of the input.",group:"Math"},atan:{doc:"Returns the arctangent of the input.",group:"Math"},min:{doc:"Returns the minimum value of the inputs.",group:"Math"},max:{doc:"Returns the maximum value of the inputs.",group:"Math"},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. Equality is strictly typed: values of different types are always considered not equal.",group:"Decision"},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. Equality is strictly typed: values of different types are always considered not equal.",group:"Decision"},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The inputs must be numbers or strings, and both of the same type.",group:"Decision"},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The inputs must be numbers or strings, and both of the same type.",group:"Decision"},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The inputs must be numbers or strings, and both of the same type.",group:"Decision"},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The inputs must be numbers or strings, and both of the same type.",group:"Decision"},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision"},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision"},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision"},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String"},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String"},concat:{doc:"Returns a string consisting of the concatenation of the inputs.",group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},transition:!1,"zoom-function":!0,"property-function":!1,function:"piecewise-constant",doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1,doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0"}}},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"data-driven styling":{}}},"circle-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{}}},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed.","sdk-support":{"basic functionality":{js:"0.41.0"},"data-driven styling":{}}},"heatmap-weight":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0"},"data-driven styling":{js:"0.41.0"}}},"heatmap-intensity":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0"},"data-driven styling":{}}},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0"},"data-driven styling":{}}},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0"},"data-driven styling":{}}}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,doc:"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}}},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}}}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",function:"interpolated","zoom-function":!0,transition:!1},"hillshade-illumination-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated."},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",function:"interpolated","zoom-function":!0,transition:!0}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",function:"interpolated","zoom-function":!0,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{}}},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{}}},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512).","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{}}},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}}};function J(t,e,i){this.message=(t?t+": ":"")+i,null!=e&&e.__line__&&(this.line=e.__line__)}function Y(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var o=r[n];for(var a in o)t[a]=o[a]}return t}function $(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}var Q=function(t){function e(e,i){t.call(this,i),this.message=i,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var i=0,n=e;i<n.length;i+=1){var r=n[i],o=r[0],a=r[1];this.bindings[o]=a}};tt.prototype.concat=function(t){return new tt(this,t)},tt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},tt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var et={kind:"null"},it={kind:"number"},nt={kind:"string"},rt={kind:"boolean"},ot={kind:"color"},at={kind:"object"},st={kind:"value"};function lt(t,e){return{kind:"array",itemType:t,N:e}}function ut(t){if("array"===t.kind){var e=ut(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var ct=[et,it,nt,rt,ot,at,lt(st)];function ht(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&!ht(t.itemType,e.itemType)&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var i=0,n=ct;i<n.length;i+=1){if(!ht(n[i],e))return null}}return"Expected "+ut(t)+" but found "+ut(e)+" instead."}var pt=t(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100*255):n(parseInt(t))}function a(t){return"%"===t[t.length-1]?r(parseFloat(t)/100):r(parseFloat(t))}function s(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=r.indexOf("("),u=r.indexOf(")");if(-1!==l&&u+1===r.length){var c=r.substr(0,l),h=r.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),m=a(h[2]),y=m<=.5?m*(d+1):m+d-m*d,g=2*m-y;return[n(255*s(g,y,f+1/3)),n(255*s(g,y,f)),n(255*s(g,y,f-1/3)),p];default:return null}}return null}}catch(t){}}).parseCSSColor,ft=function(t,e,i,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=i,this.a=n};function dt(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,i,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function mt(t){if(null===t)return et;if("string"==typeof t)return nt;if("boolean"==typeof t)return rt;if("number"==typeof t)return it;if(t instanceof ft)return ot;if(Array.isArray(t)){for(var e,i=t.length,n=0,r=t;n<r.length;n+=1){var o=mt(r[n]);if(e){if(e===o)continue;e=st;break}e=o}return lt(e||st,i)}return at}ft.parse=function(t){if(t){if(t instanceof ft)return t;if("string"==typeof t){var e=pt(t);if(e)return new ft(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ft.prototype.toString=function(){var t=this;return"rgba("+[this.r,this.g,this.b].map(function(e){return Math.round(255*e/t.a)}).concat(this.a).join(",")+")"},ft.black=new ft(0,0,0,1),ft.white=new ft(1,1,1,1),ft.transparent=new ft(0,0,0,0);var yt=function(t,e){this.type=t,this.value=e};yt.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ft)return!0;if(Array.isArray(e)){for(var i=0,n=e;i<n.length;i+=1)if(!t(n[i]))return!1;return!0}if("object"==typeof e){for(var r in e)if(!t(e[r]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var i=t[1],n=mt(i),r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new yt(n,i)},yt.prototype.evaluate=function(){return this.value},yt.prototype.eachChild=function(){},yt.prototype.possibleOutputs=function(){return[this.value]};var gt=function(t){this.name="ExpressionEvaluationError",this.message=t};gt.prototype.toJSON=function(){return this.message};var vt={string:nt,number:it,boolean:rt,object:at},_t=function(t,e){this.type=t,this.args=e};_t.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],n=vt[i],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,st);if(!a)return null;r.push(a)}return new _t(n,r)},_t.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!ht(this.type,mt(i)))return i;if(e===this.args.length-1)throw new gt("Expected value to be of type "+ut(this.type)+", but found "+ut(mt(i))+" instead.")}return null},_t.prototype.eachChild=function(t){this.args.forEach(t)},_t.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t};var xt={string:nt,number:it,boolean:rt},bt=function(t,e){this.type=t,this.input=e};bt.parse=function(t,e){if(t.length<2||t.length>4)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var i,n;if(t.length>2){var r=t[1];if("string"!=typeof r||!(r in xt))return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=xt[r]}else i=st;if(t.length>3){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);n=t[2]}var o=lt(i,n),a=e.parse(t[t.length-1],t.length-1,st);return a?new bt(o,a):null},bt.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(ht(this.type,mt(e)))throw new gt("Expected value to be of type "+ut(this.type)+", but found "+ut(mt(e))+" instead.");return e},bt.prototype.eachChild=function(t){t(this.input)},bt.prototype.possibleOutputs=function(){return this.input.possibleOutputs()};var wt={"to-number":it,"to-color":ot},Tt=function(t,e){this.type=t,this.args=e};Tt.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],n=wt[i],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,st);if(!a)return null;r.push(a)}return new Tt(n,r)},Tt.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,i,n=0,r=this.args;n<r.length;n+=1){if(i=null,"string"==typeof(e=r[n].evaluate(t))){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(i=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":dt(e[0],e[1],e[2],e[3])))return new ft(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new gt(i||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null!==(a=l[s].evaluate(t))){var u=Number(a);if(!isNaN(u))return u}}throw new gt("Could not convert "+JSON.stringify(a)+" to number.")},Tt.prototype.eachChild=function(t){this.args.forEach(t)},Tt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t};var St=["Unknown","Point","LineString","Polygon"],zt=function(){this.scope=new tt,this._parseColorCache={}};zt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},zt.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?St[this.feature.type]:this.feature.type:null},zt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},zt.prototype.pushScope=function(t){this.scope=this.scope.concat(t)},zt.prototype.popScope=function(){this.scope=this.scope.parent},zt.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ft.parse(t)),e};var At=function(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n};function kt(t){return{type:t}}function Et(t){if(t instanceof At){if("get"===t.name&&1===t.args.length)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!Et(t)&&(e=!1)}),e}function It(t,e){if(t instanceof At&&e.indexOf(t.name)>=0)return!1;var i=!0;return t.eachChild(function(t){i&&!It(t,e)&&(i=!1)}),i}At.prototype.evaluate=function(t){return this._evaluate(t,this.args)},At.prototype.eachChild=function(t){this.args.forEach(t)},At.prototype.possibleOutputs=function(){return[void 0]},At.parse=function(t,e){var i=t[0],n=At.definitions[i];if(!n)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter(function(e){var i=e[0];return!Array.isArray(i)||i.length===t.length-1}),s=[],l=1;l<t.length;l++){var u=t[l],c=void 0;if(1===a.length){var h=a[0][0];c=Array.isArray(h)?h[l-1]:h.type}var p=e.parse(u,1+s.length,c);if(!p)return null;s.push(p)}for(var f=null,d=0,m=a;d<m.length;d+=1){var y=m[d],g=y[0],v=y[1];if(f=new Pt(e.registry,e.path,null,e.scope),Array.isArray(g)&&g.length!==s.length)f.error("Expected "+g.length+" arguments, but found "+s.length+" instead.");else{for(var _=0;_<s.length;_++){var x=Array.isArray(g)?g[_]:g.type,b=s[_];f.concat(_+1).checkSubtype(x,b.type)}if(0===f.errors.length)return new At(i,r,v,s)}}if(1===a.length)e.errors.push.apply(e.errors,f.errors);else{var w=(a.length?a:o).map(function(t){var e,i=t[0];return e=i,Array.isArray(e)?"("+e.map(ut).join(", ")+")":"("+ut(e.type)+"...)"}).join(" | "),T=s.map(function(t){return ut(t.type)}).join(", ");e.error("Expected arguments of type "+w+", but found ("+T+") instead.")}return null},At.register=function(t,e){for(var i in At.definitions=e,e)t[i]=At};var Mt={isFeatureConstant:Et,isGlobalPropertyConstant:It},Ct=function(t,e){this.type=e,this.name=t};Ct.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var i=t[1];return e.scope.has(i)?new Ct(i,e.scope.get(i).type):e.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},Ct.prototype.evaluate=function(t){return t.scope.get(this.name).evaluate(t)},Ct.prototype.eachChild=function(){},Ct.prototype.possibleOutputs=function(){return[void 0]};var Pt=function(t,e,i,n,r){void 0===e&&(e=[]),void 0===n&&(n=new tt),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=r,this.expectedType=i};function Lt(t,e){for(var i,n,r=0,o=t.length-1,a=0;r<=o;){if(i=t[a=Math.floor((r+o)/2)],n=t[a+1],e===i||e>i&&e<n)return a;if(i<e)r=a+1;else{if(!(i>e))throw new gt("Input is not a number.");o=a-1}}return Math.max(a-1,0)}Pt.prototype.parse=function(t,e,i,n,r){void 0===r&&(r={});var o=this;if(e&&(o=o.concat(e,i,n)),null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return o.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=t[0];if("string"!=typeof a)return o.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var s=o.registry[a];if(s){var l=s.parse(t,o);if(!l)return null;if(o.expectedType){var u=o.expectedType,c=l.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind||"value"!==c.kind)if("array"===u.kind&&"value"===c.kind)r.omitTypeAnnotations||(l=new bt(u,l));else if("color"!==u.kind||"value"!==c.kind&&"string"!==c.kind){if(o.checkSubtype(o.expectedType,l.type))return null}else r.omitTypeAnnotations||(l=new Tt(u,[l]));else r.omitTypeAnnotations||(l=new _t(u,[l]))}if(!(l instanceof yt)&&function(t){if(t instanceof Ct)return!1;if(t instanceof At&&"error"===t.name)return!1;var e=!0;if(t.eachChild(function(t){t instanceof yt||(e=!1)}),!e)return!1;return Et(t)&&It(t,["zoom","heatmap-density"])}(l)){var h=new zt;try{l=new yt(l.type,l.evaluate(h))}catch(t){return o.error(t.message),null}}return l}return o.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?o.error("'undefined' value invalid. Use null instead."):"object"==typeof t?o.error('Bare objects invalid. Use ["literal", {...}] instead.'):o.error("Expected an array, but found "+typeof t+" instead.")},Pt.prototype.concat=function(t,e,i){var n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new Pt(this.registry,n,e||null,r,this.errors)},Pt.prototype.error=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Q(n,t))},Pt.prototype.checkSubtype=function(t,e){var i=ht(t,e);return i&&this.error(i),i};var Dt=function(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,r=i;n<r.length;n+=1){var o=r[n],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};Dt.parse=function(t,e){var i=t[1],n=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,1,it)))return null;var r=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),n.unshift(-1/0);for(var a=0;a<n.length;a+=2){var s=n[a],l=n[a+1],u=a+1,c=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var h=e.parse(l,c,o);if(!h)return null;o=o||h.type,r.push([s,h])}return new Dt(o,i,r)},Dt.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[Lt(e,n)].evaluate(t)},Dt.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1){t(i[e])}},Dt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t};var Rt=Bt;function Bt(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}Bt.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Bt.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Bt.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Bt.prototype.solveCurveX=function(t,e){var i,n,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},Bt.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Ot={number:Ft,color:function(t,e,i){return new ft(Ft(t.r,e.r,i),Ft(t.g,e.g,i),Ft(t.b,e.b,i),Ft(t.a,e.a,i))},array:function(t,e,i){return t.map(function(t,n){return Ft(t,e[n],i)})}};function Ft(t,e,i){return t*(1-i)+e*i}var jt=function(t,e,i,n){this.type=t,this.interpolation=e,this.input=i,this.labels=[],this.outputs=[];for(var r=0,o=n;r<o.length;r+=1){var a=o[r],s=a[0],l=a[1];this.labels.push(s),this.outputs.push(l)}};function Vt(t,e,i,n){var r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}jt.interpolationFactor=function(t,e,i,n){var r=0;if("exponential"===t.name)r=Vt(e,t.base,i,n);else if("linear"===t.name)r=Vt(e,1,i,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;r=new Rt(o[0],o[1],o[2],o[3]).solve(Vt(e,1,i,n))}return r},jt.parse=function(t,e){var i=t[1],n=t[2],r=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var o=i[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:o}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var a=i.slice(1);if(4!==a.length||a.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:a}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,it)))return null;var s=[],l=null;e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var u=0;u<r.length;u+=2){var c=r[u],h=r[u+1],p=u+3,f=u+4;if("number"!=typeof c)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(s.length&&s[s.length-1][0]>=c)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var d=e.parse(h,f,l);if(!d)return null;l=l||d.type,s.push([c,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new jt(l,i,n,s):e.error("Type "+ut(l)+" is not interpolatable.")},jt.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);var o=Lt(e,n),a=e[o],s=e[o+1],l=jt.interpolationFactor(this.interpolation,n,a,s),u=i[o].evaluate(t),c=i[o+1].evaluate(t);return Ot[this.type.kind.toLowerCase()](u,c,l)},jt.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1){t(i[e])}},jt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t};var Nt=function(t,e){this.type=t,this.args=e};Nt.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var i=null,n=e.expectedType;n&&"value"!==n.kind&&(i=n);for(var r=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],l=e.parse(s,1+r.length,i,void 0,{omitTypeAnnotations:!0});if(!l)return null;i=i||l.type,r.push(l)}var u=n&&r.some(function(t){return ht(n,t.type)});return new Nt(u?st:i,r)},Nt.prototype.evaluate=function(t){for(var e=null,i=0,n=this.args;i<n.length;i+=1){if(null!==(e=n[i].evaluate(t)))break}return e},Nt.prototype.eachChild=function(t){this.args.forEach(t)},Nt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t};var Ut=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Ut.prototype.evaluate=function(t){t.pushScope(this.bindings);var e=this.result.evaluate(t);return t.popScope(),e},Ut.prototype.eachChild=function(t){for(var e=0,i=this.bindings;e<i.length;e+=1){t(i[e][1])}t(this.result)},Ut.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var i=[],n=1;n<t.length-1;n+=2){var r=t[n];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}var a=e.parse(t[t.length-1],t.length-1,void 0,i);return a?new Ut(i,a):null},Ut.prototype.possibleOutputs=function(){return this.result.possibleOutputs()};var qt=function(t,e,i){this.type=t,this.index=e,this.input=i};qt.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,it),n=e.parse(t[2],2,lt(e.expectedType||st));if(!i||!n)return null;var r=n.type;return new qt(r.itemType,i,n)},qt.prototype.evaluate=function(t){var e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0||e>=i.length)throw new gt("Array index out of bounds: "+e+" > "+i.length+".");if(e!==Math.floor(e))throw new gt("Array index must be an integer, but found "+e+" instead.");return i[e]},qt.prototype.eachChild=function(t){t(this.index),t(this.input)},qt.prototype.possibleOutputs=function(){return[void 0]};var Zt=function(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o};Zt.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,mt(p)))return null}else i=mt(p);if(void 0!==r[String(p)])return u.error("Branch labels must be unique.");r[String(p)]=o.length}var f=e.parse(l,a,n);if(!f)return null;n=n||f.type,o.push(f)}var d=e.parse(t[1],1,i);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?new Zt(i,n,d,r,o,m):null},Zt.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Zt.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Zt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t};var Gt=function(t,e,i){this.type=t,this.branches=e,this.otherwise=i};function Wt(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function Xt(t){return function(){function e(t,e){this.type=rt,this.lhs=t,this.rhs=e}return e.parse=function(t,i){if(3!==t.length)return i.error("Expected two arguments.");var n=i.parse(t[1],1,st);if(!n)return null;var r=i.parse(t[2],2,st);return r?Wt(n.type)||Wt(r.type)?n.type.kind!==r.type.kind&&"value"!==n.type.kind&&"value"!==r.type.kind?i.error("Cannot compare "+ut(n.type)+" and "+ut(r.type)+"."):new e(n,r):i.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+ut(n.type)+", "+ut(r.type)+") instead."):null},e.prototype.evaluate=function(e){return t(this.lhs.evaluate(e),this.rhs.evaluate(e))},e.prototype.eachChild=function(t){t(this.lhs),t(this.rhs)},e.prototype.possibleOutputs=function(){return[!0,!1]},e}()}Gt.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n=[],r=1;r<t.length-1;r+=2){var o=e.parse(t[r],r,rt);if(!o)return null;var a=e.parse(t[r+1],r+1,i);if(!a)return null;n.push([o,a]),i=i||a.type}var s=e.parse(t[t.length-1],t.length-1,i);return s?new Gt(i,n,s):null},Gt.prototype.evaluate=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[0],o=n[1];if(r.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},Gt.prototype.eachChild=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[0],o=n[1];t(r),t(o)}t(this.otherwise)},Gt.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.branches.map(function(t){t[0];return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t};var Ht={"==":Xt(function(t,e){return t===e}),"!=":Xt(function(t,e){return t!==e}),array:bt,at:qt,boolean:_t,case:Gt,coalesce:Nt,interpolate:jt,let:Ut,literal:yt,match:Zt,number:_t,object:_t,step:Dt,string:_t,"to-color":Tt,"to-number":Tt,var:Ct};function Kt(t,e){var i=e[0],n=e[1],r=e[2],o=e[3];i=i.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);var a=o?o.evaluate(t):1,s=dt(i,n,r,a);if(s)throw new gt(s);return new ft(i/255*a,n/255*a,r/255*a,a)}function Jt(t,e){return t in e}function Yt(t,e){var i=e[t];return void 0===i?null:i}function $t(t,e){return e[0].evaluate(t).length}function Qt(t,e){var i=e[0],n=e[1];return i.evaluate(t)<n.evaluate(t)}function te(t,e){var i=e[0],n=e[1];return i.evaluate(t)>n.evaluate(t)}function ee(t,e){var i=e[0],n=e[1];return i.evaluate(t)<=n.evaluate(t)}function ie(t,e){var i=e[0],n=e[1];return i.evaluate(t)>=n.evaluate(t)}function ne(t){return{result:"success",value:t}}function re(t){return{result:"error",value:t}}At.register(Ht,{error:[{kind:"error"},[nt],function(t,e){var i=e[0];throw new gt(i.evaluate(t))}],typeof:[nt,[st],function(t,e){return ut(mt(e[0].evaluate(t)))}],"to-string":[nt,[st],function(t,e){var i=e[0],n=typeof(i=i.evaluate(t));return null===i||"string"===n||"number"===n||"boolean"===n?String(i):i instanceof ft?i.toString():JSON.stringify(i)}],"to-boolean":[rt,[st],function(t,e){var i=e[0];return Boolean(i.evaluate(t))}],"to-rgba":[lt(it,4),[ot],function(t,e){var i=e[0].evaluate(t),n=i.r,r=i.g,o=i.b,a=i.a;return[255*n/a,255*r/a,255*o/a,a]}],rgb:[ot,[it,it,it],Kt],rgba:[ot,[it,it,it,it],Kt],length:{type:it,overloads:[[[nt],$t],[[lt(st)],$t]]},has:{type:rt,overloads:[[[nt],function(t,e){return Jt(e[0].evaluate(t),t.properties())}],[[nt,at],function(t,e){var i=e[0],n=e[1];return Jt(i.evaluate(t),n.evaluate(t))}]]},get:{type:st,overloads:[[[nt],function(t,e){return Yt(e[0].evaluate(t),t.properties())}],[[nt,at],function(t,e){var i=e[0],n=e[1];return Yt(i.evaluate(t),n.evaluate(t))}]]},properties:[at,[],function(t){return t.properties()}],"geometry-type":[nt,[],function(t){return t.geometryType()}],id:[st,[],function(t){return t.id()}],zoom:[it,[],function(t){return t.globals.zoom}],"heatmap-density":[it,[],function(t){return t.globals.heatmapDensity||0}],"+":[it,kt(it),function(t,e){for(var i=0,n=0,r=e;n<r.length;n+=1){i+=r[n].evaluate(t)}return i}],"*":[it,kt(it),function(t,e){for(var i=1,n=0,r=e;n<r.length;n+=1){i*=r[n].evaluate(t)}return i}],"-":{type:it,overloads:[[[it,it],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)-n.evaluate(t)}],[[it],function(t,e){return-e[0].evaluate(t)}]]},"/":[it,[it,it],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)/n.evaluate(t)}],"%":[it,[it,it],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)%n.evaluate(t)}],ln2:[it,[],function(){return Math.LN2}],pi:[it,[],function(){return Math.PI}],e:[it,[],function(){return Math.E}],"^":[it,[it,it],function(t,e){var i=e[0],n=e[1];return Math.pow(i.evaluate(t),n.evaluate(t))}],sqrt:[it,[it],function(t,e){var i=e[0];return Math.sqrt(i.evaluate(t))}],log10:[it,[it],function(t,e){var i=e[0];return Math.log10(i.evaluate(t))}],ln:[it,[it],function(t,e){var i=e[0];return Math.log(i.evaluate(t))}],log2:[it,[it],function(t,e){var i=e[0];return Math.log2(i.evaluate(t))}],sin:[it,[it],function(t,e){var i=e[0];return Math.sin(i.evaluate(t))}],cos:[it,[it],function(t,e){var i=e[0];return Math.cos(i.evaluate(t))}],tan:[it,[it],function(t,e){var i=e[0];return Math.tan(i.evaluate(t))}],asin:[it,[it],function(t,e){var i=e[0];return Math.asin(i.evaluate(t))}],acos:[it,[it],function(t,e){var i=e[0];return Math.acos(i.evaluate(t))}],atan:[it,[it],function(t,e){var i=e[0];return Math.atan(i.evaluate(t))}],min:[it,kt(it),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[it,kt(it),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],"filter-==":[rt,[nt,st],function(t,e){var i=e[0],n=e[1];return t.properties()[i.value]===n.value}],"filter-id-==":[rt,[st],function(t,e){var i=e[0];return t.id()===i.value}],"filter-type-==":[rt,[nt],function(t,e){var i=e[0];return t.geometryType()===i.value}],"filter-<":[rt,[nt,st],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r<o}],"filter-id-<":[rt,[st],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<r}],"filter->":[rt,[nt,st],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r>o}],"filter-id->":[rt,[st],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n>r}],"filter-<=":[rt,[nt,st],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[rt,[st],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<=r}],"filter->=":[rt,[nt,st],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[rt,[st],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n>=r}],"filter-has":[rt,[st],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[rt,[],function(t){return null!==t.id()}],"filter-type-in":[rt,[lt(nt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[rt,[lt(st)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[rt,[nt,lt(st)],function(t,e){var i=e[0];return e[1].value.indexOf(t.properties()[i.value])>=0}],"filter-in-large":[rt,[nt,lt(st)],function(t,e){var i=e[0],n=e[1];return function(t,e,i,n){for(;i<=n;){var r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[i.value],n.value,0,n.value.length-1)}],">":{type:rt,overloads:[[[it,it],te],[[nt,nt],te]]},"<":{type:rt,overloads:[[[it,it],Qt],[[nt,nt],Qt]]},">=":{type:rt,overloads:[[[it,it],ie],[[nt,nt],ie]]},"<=":{type:rt,overloads:[[[it,it],ee],[[nt,nt],ee]]},all:{type:rt,overloads:[[[rt,rt],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)&&n.evaluate(t)}],[kt(rt),function(t,e){for(var i=0,n=e;i<n.length;i+=1){if(!n[i].evaluate(t))return!1}return!0}]]},any:{type:rt,overloads:[[[rt,rt],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)||n.evaluate(t)}],[kt(rt),function(t,e){for(var i=0,n=e;i<n.length;i+=1){if(n[i].evaluate(t))return!0}return!1}]]},"!":[rt,[rt],function(t,e){return!e[0].evaluate(t)}],upcase:[nt,[nt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[nt,[nt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[nt,kt(nt),function(t,e){return e.map(function(e){return e.evaluate(t)}).join("")}]});var oe=.95047,ae=1,se=1.08883,le=4/29,ue=6/29,ce=3*ue*ue,he=ue*ue*ue,pe=Math.PI/180,fe=180/Math.PI;function de(t){return t>he?Math.pow(t,1/3):t/ce+le}function me(t){return t>ue?t*t*t:ce*(t-le)}function ye(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ge(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ve(t){var e=ge(t.r),i=ge(t.g),n=ge(t.b),r=de((.4124564*e+.3575761*i+.1804375*n)/oe),o=de((.2126729*e+.7151522*i+.072175*n)/ae);return{l:116*o-16,a:500*(r-o),b:200*(o-de((.0193339*e+.119192*i+.9503041*n)/se)),alpha:t.a}}function _e(t){var e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=ae*me(e),i=oe*me(i),n=se*me(n),new ft(ye(3.2404542*i-1.5371385*e-.4985314*n),ye(-.969266*i+1.8760108*e+.041556*n),ye(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}var xe={lab:{forward:ve,reverse:_e,interpolate:function(t,e,i){return{l:Ft(t.l,e.l,i),a:Ft(t.a,e.a,i),b:Ft(t.b,e.b,i),alpha:Ft(t.alpha,e.alpha,i)}}},hcl:{forward:function(t){var e=ve(t),i=e.l,n=e.a,r=e.b,o=Math.atan2(r,n)*fe;return{h:o<0?o+360:o,c:Math.sqrt(n*n+r*r),l:i,alpha:t.a}},reverse:function(t){var e=t.h*pe,i=t.c;return _e({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:function(t,e,i){var n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}(t.h,e.h,i),c:Ft(t.c,e.c,i),l:Ft(t.l,e.l,i),alpha:Ft(t.alpha,e.alpha,i)}}}};function be(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function we(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Te(t){return t}function Se(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function ze(t,e,i,n,r){return Se(typeof i===r?n[i]:void 0,t.default,e.default)}function Ae(t,e,i){if("number"!==be(i))return Se(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];var r=Ie(t.stops,i);return t.stops[r][1]}function ke(t,e,i){var n=void 0!==t.base?t.base:1;if("number"!==be(i))return Se(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];var o=Ie(t.stops,i),a=function(t,e,i,n){var r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],u=Ot[e.type]||Te;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=xe[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==n)return u(i,n,a)}}:u(s,l,a)}function Ee(t,e,i){return"color"===e.type?i=ft.parse(i):be(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Se(i,t.default,e.default)}function Ie(t,e){for(var i,n,r=0,o=t.length-1,a=0;r<=o;){if(i=t[a=Math.floor((r+o)/2)][0],n=t[a+1][0],e===i||e>i&&e<n)return a;i<e?r=a+1:i>e&&(o=a-1)}return Math.max(a-1,0)}var Me=function(t){this.expression=t};Me.prototype.evaluate=function(t,e){return this._evaluator||(this._evaluator=new zt),this._evaluator.globals=t,this._evaluator.feature=e,this.expression.evaluate(this._evaluator)};var Ce=function(t){function e(e,i){var n;t.call(this,e),this._warningHistory={},this._defaultValue="color"===(n=i).type&&we(n.default)?new ft(0,0,0,0):"color"===n.type?ft.parse(n.default)||null:void 0===n.default?null:n.default,"enum"===i.type&&(this._enumValues=i.values)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.evaluate=function(t,e){this._evaluator||(this._evaluator=new zt),this._evaluator.globals=t,this._evaluator.feature=e;try{var i=this.expression.evaluate(this._evaluator);if(null==i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new gt("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}},e}(Me);function Pe(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ht}function Le(t,e,i){void 0===i&&(i={});var n=new Pt(Ht,[],function(t){var e={color:ot,string:nt,number:it,enum:nt,boolean:rt};if("array"===t.type)return lt(e[t.value]||st,t.length);return e[t.type]||null}(e)),r=n.parse(t);return r?!1===i.handleErrors?ne(new Me(r)):ne(new Ce(r,e)):re(n.errors)}var De=function(t,e){this.kind=t,this._styleExpression=e};De.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)};var Re=function(t,e,i){this.kind=t,this.zoomStops=i.labels,this._styleExpression=e,i instanceof jt&&(this._interpolationType=i.interpolation)};function Be(t,e,i){if(void 0===i&&(i={}),"error"===(t=Le(t,e,i)).result)return t;var n=t.value.expression,r=Mt.isFeatureConstant(n);if(!r&&!e["property-function"])return re([new Q("","property expressions not supported")]);var o=Mt.isGlobalPropertyConstant(n,["zoom"]);if(!o&&!1===e["zoom-function"])return re([new Q("","zoom expressions not supported")]);var a=function t(e){var i=null;if(e instanceof Ut)i=t(e.result);else if(e instanceof Nt)for(var n=0,r=e.args;n<r.length;n+=1){var o=r[n];if(i=t(o))break}else(e instanceof Dt||e instanceof jt)&&e.input instanceof At&&"zoom"===e.input.name&&(i=e);if(i instanceof Q)return i;e.eachChild(function(e){var n=t(e);n instanceof Q?i=n:!i&&n?i=new Q("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&n&&i!==n&&(i=new Q("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))});return i}(n);return a||o?a instanceof Q?re([a]):a instanceof jt&&"piecewise-constant"===e.function?re([new Q("",'"interpolate" expressions cannot be used with this property')]):ne(a?new Re(r?"camera":"composite",t.value,a):new De(r?"constant":"source",t.value)):re([new Q("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Re.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)},Re.prototype.interpolationFactor=function(t,e,i){return this._interpolationType?jt.interpolationFactor(this._interpolationType,t,e,i):0};var Oe=function(t,e){this._parameters=t,this._specification=e,Y(this,function t(e,i){var n,r,o,a="color"===i.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||void 0!==e.property,u=s||!l,c=e.type||("interpolated"===i.function?"exponential":"interval");if(a&&((e=Y({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],ft.parse(t[1])]})),e.default?e.default=ft.parse(e.default):e.default=ft.parse(i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!xe[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)n=ke;else if("interval"===c)n=Ae;else if("categorical"===c){n=ze,r=Object.create(null);for(var h=0,p=e.stops;h<p.length;h+=1){var f=p[h];r[f[0]]=f[1]}o=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');n=Ee}if(s){for(var d={},m=[],y=0;y<e.stops.length;y++){var g=e.stops[y],v=g[0].zoom;void 0===d[v]&&(d[v]={zoom:v,type:e.type,property:e.property,default:e.default,stops:[]},m.push(v)),d[v].stops.push([g[0].value,g[1]])}for(var _=[],x=0,b=m;x<b.length;x+=1){var w=b[x];_.push([d[w].zoom,t(d[w],i)])}return{kind:"composite",interpolationFactor:jt.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:_.map(function(t){return t[0]}),evaluate:function(t,n){var r=t.zoom;return ke({stops:_,base:e.base},i,r).evaluate(r,n)}}}return u?{kind:"camera",interpolationFactor:"exponential"===c?jt.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var a=t.zoom;return n(e,i,a,r,o)}}:{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Se(e.default,i.default):n(e,i,s,r,o)}}}(this._parameters,this._specification))};function Fe(t,e){if(we(t))return new Oe(t,e);if(Pe(t)){var i=Be(t,e);if("error"===i.result)throw new Error(i.value.map(function(t){return t.key+": "+t.message}).join(", "));return i.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=ft.parse(t)),{kind:"constant",evaluate:function(){return n}}}function je(t){var e=require("./validate_function"),i=require("./validate_expression"),n=require("./validate_object"),r={"*":function(){return[]},array:require("./validate_array"),boolean:require("./validate_boolean"),number:require("./validate_number"),color:require("./validate_color"),constants:require("./validate_constants"),enum:require("./validate_enum"),filter:require("./validate_filter"),function:require("./validate_function"),layer:require("./validate_layer"),object:require("./validate_object"),source:require("./validate_source"),light:require("./validate_light"),string:require("./validate_string")},o=t.value,a=t.valueSpec,s=t.styleSpec;return a.function&&we($(o))?e(t):a.function&&Pe($.deep(o))?i(t):a.type&&r[a.type]?r[a.type](t):n(Y({},t,{valueSpec:a.type?s[a.type]:a}))}function Ve(t){var e=t.value,i=t.key,n=function(t){var e=t.value,i=t.key,n=be(e);return"string"!==n?[new J(i,e,"string expected, "+n+" found")]:[]}(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new J(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new J(i,e,'"glyphs" url must include a "{range}" token')),n)}function Ne(t){var e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=be(i);if("object"!==l)return[new J(e,i,"object expected, "+l+" found")];for(var u in i){var c=u.split(".")[0],h=n[c]||n["*"],p=void 0;if(r[c])p=r[c];else if(n[c])p=je;else if(r["*"])p=r["*"];else{if(!n["*"]){s.push(new J(e,i[u],'unknown property "'+u+'"'));continue}p=je}s=s.concat(p({key:(e?e+".":e)+u,value:i[u],valueSpec:h,style:o,styleSpec:a,object:i,objectKey:u},i))}for(var f in n)r[f]||n[f].required&&void 0===n[f].default&&void 0===i[f]&&s.push(new J(e,i,'missing required property "'+f+'"'));return s}function Ue(t){var e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf($(i))&&r.push(new J(e,i,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(n.values).indexOf($(i))&&r.push(new J(e,i,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(i)+" found")),r}function qe(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&(Array.isArray(t[1])||Array.isArray(t[2]));case"any":case"all":for(var e=0,i=t.slice(1);e<i.length;e+=1){var n=i[e];if(!qe(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Oe.deserialize=function(t){return new Oe(t._parameters,t._specification)},Oe.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Ze={type:"boolean",default:!1,function:!0,"property-function":!0,"zoom-function":!0};function Ge(t){if(!t)return function(){return!0};qe(t)||(t=Xe(t));var e=Le(t,Ze);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,i){return e.value.evaluate(t,i)}}function We(t,e){return t<e?-1:t>e?1:0}function Xe(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?He(t[1],t[2],"=="):"!="===i?Ye(He(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?He(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(Xe))):"all"===i?["all"].concat(t.slice(1).map(Xe)):"none"===i?["all"].concat(t.slice(1).map(Xe).map(Ye)):"in"===i?Ke(t[1],t.slice(2)):"!in"===i?Ye(Ke(t[1],t.slice(2))):"has"===i?Je(t[1]):"!has"!==i||Ye(Je(t[1]))}function He(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function Ke(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(We)]]:["filter-in-small",t,["literal",e]]}}function Je(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ye(t){return["!",t]}function $e(t){return qe($.deep(t.value))?function(t){var e=("property"===t.expressionContext?Be:Le)($.deep(t.value),t.valueSpec);return"error"===e.result?e.value.map(function(e){return new J(""+t.key+e.key,t.value,e.message)}):"property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==e.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new J(t.key,t.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:[]}(Y({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var i=e.value;var n=e.key;if("array"!==be(i))return[new J(n,i,"array expected, "+be(i)+" found")];var r=e.styleSpec;var o;var a=[];if(i.length<1)return[new J(n,i,"filter array must have at least 1 element")];a=a.concat(Ue({key:n+"[0]",value:i[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec}));switch($(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===$(i[1])&&a.push(new J(n,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&a.push(new J(n,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":i.length>=2&&"string"!==(o=be(i[1]))&&a.push(new J(n+"[1]",i[1],"string expected, "+o+" found"));for(var s=2;s<i.length;s++)o=be(i[s]),"$type"===$(i[1])?a=a.concat(Ue({key:n+"["+s+"]",value:i[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&a.push(new J(n+"["+s+"]",i[s],"string, number, or boolean expected, "+o+" found"));break;case"any":case"all":case"none":for(var l=1;l<i.length;l++)a=a.concat(t({key:n+"["+l+"]",value:i[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=be(i[1]),2!==i.length?a.push(new J(n,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==o&&a.push(new J(n+"[1]",i[1],"string expected, "+o+" found"))}return a}(t)}function Qe(t,e){var i=t.key,n=t.style,r=t.styleSpec,o=t.value,a=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return je({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});var u,c=t.valueSpec||s[a];if(!c)return[new J(i,o,'unknown property "'+a+'"')];if("string"===be(o)&&c["property-function"]&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new J(i,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new J(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&we($.deep(o))&&"identity"===$(o.type)&&h.push(new J(i,o,'"text-font" does not support identity functions'))),h.concat(je({key:t.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyKey:a}))}function ti(t){return Qe(t,"paint")}function ei(t){return Qe(t,"layout")}function ii(t,e){e=e||K;var i,n,r,o=[];return o=o.concat(je({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Ve,"*":function(){return[]}}})),t.constants&&(o=o.concat((i={key:"constants",value:t.constants,style:t,styleSpec:e},n=i.key,(r=i.value)?[new J(n,r,"constants have been deprecated as of v8")]:[]))),ni(o)}function ni(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function ri(t){return function(){return ni(t.apply(this,arguments))}}function oi(t,e){if(e&&e.length){for(var i=0,n=e;i<n.length;i+=1){var r=n[i].message;t.fire("error",{error:new Error(r)})}return!0}return!1}ii.source=ri(function(t){var e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new J(i,e,'"type" is required')];var o=$(e.type),a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(Ne({key:i,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new J(i+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":return Ne({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n});case"video":return Ne({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Ne({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return Ne({key:i,value:e,valueSpec:n.source_canvas,style:r,styleSpec:n});default:return Ue({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image","canvas"]},style:r,styleSpec:n})}}),ii.light=ri(function(t){var e=t.value,i=t.styleSpec,n=i.light,r=t.style,o=[],a=be(e);if(void 0===e)return o;if("object"!==a)return o=o.concat([new J("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=l&&n[l[1]]&&n[l[1]].transition?o.concat(je({key:s,value:e[s],valueSpec:i.transition,style:r,styleSpec:i})):n[s]?o.concat(je({key:s,value:e[s],valueSpec:n[s],style:r,styleSpec:i})):o.concat([new J(s,e[s],'unknown property "'+s+'"')])}return o}),ii.layer=ri(function(t){var e=[],i=t.value,n=t.key,r=t.style,o=t.styleSpec;i.type||i.ref||e.push(new J(n,i,'either "type" or "ref" is required'));var a,s=$(i.type),l=$(i.ref);if(i.id)for(var u=$(i.id),c=0;c<t.arrayIndex;c++){var h=r.layers[c];$(h.id)===u&&e.push(new J(n,i.id,'duplicate layer id "'+i.id+'", previously used at line '+h.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&e.push(new J(n,i[t],'"'+t+'" is prohibited for ref layers'))}),r.layers.forEach(function(t){$(t.id)===l&&(a=t)}),a?a.ref?e.push(new J(n,i.ref,"ref cannot reference another ref layer")):s=$(a.type):e.push(new J(n,i.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(i.source){var p=r.sources&&r.sources[i.source],f=p&&$(p.type);p?"vector"===f&&"raster"===s?e.push(new J(n,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new J(n,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==f||i["source-layer"]?"raster-dem"===f&&"hillshade"!==s&&e.push(new J(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):e.push(new J(n,i,'layer "'+i.id+'" must specify a "source-layer"')):e.push(new J(n,i.source,'source "'+i.source+'" not found'))}else e.push(new J(n,i,'missing required property "source"'));return e=e.concat(Ne({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return je({key:n+".type",value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"})},filter:$e,layout:function(t){return Ne({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return ei(Y({layerType:s},t))}}})},paint:function(t){return Ne({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return ti(Y({layerType:s},t))}}})}}}))}),ii.filter=ri($e),ii.paintProperty=ri(ti),ii.layoutProperty=ri(ei);var ai=li,si=3;function li(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],e=r[1],i=r[2],this.d=e+2*i;for(var o=0;o<this.d*this.d;o++){var a=r[si+o],s=r[si+o+1];n.push(a===s?null:r.subarray(a,s))}var l=r[si+n.length],u=r[si+n.length+1];this.keys=r.subarray(l,u),this.bboxes=r.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var h=i/e*t;this.min=-h,this.max=t+h}li.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},li.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},li.prototype._insertCell=function(t,e,i,n,r,o){this.cells[r].push(o)},li.prototype.query=function(t,e,i,n){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=i&&o<=n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{}),a},li.prototype._queryCell=function(t,e,i,n,r,o,a){var s=this.cells[r];if(null!==s)for(var l=this.keys,u=this.bboxes,c=0;c<s.length;c++){var h=s[c];if(void 0===a[h]){var p=4*h;t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&n>=u[p+1]?(a[h]=!0,o.push(l[h])):a[h]=!1}}},li.prototype._forEachCell=function(t,e,i,n,r,o,a){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(i),c=this._convertToCellCoord(n),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.d*p+h;if(r.call(this,t,e,i,n,f,o,a))return}},li.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},li.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=si+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];r[si+a]=o,r.set(s,o),o+=s.length}return r[si+t.length]=o,r.set(this.keys,o),o+=this.keys.length,r[si+t.length+1]=o,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var ui=self.ImageData,ci={};function hi(t,e,i){void 0===i&&(i={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ci[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}for(var pi in hi("Object",Object),ai.serialize=function(t,e){var i=t.toArrayBuffer();return e&&e.push(i),i},ai.deserialize=function(t){return new ai(t)},hi("Grid",ai),hi("Color",ft),hi("StylePropertyFunction",Oe),hi("StyleExpression",Me,{omit:["_evaluator"]}),hi("StyleExpressionWithErrorHandling",Ce,{omit:["_evaluator"]}),hi("ZoomDependentExpression",Re),hi("ZoomConstantExpression",De),hi("CompoundExpression",At,{omit:["_evaluate"]}),Ht)Ht[pi]._classRegistryKey||hi("Expression_"+pi,Ht[pi]);function fi(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var i=t;return e&&e.push(i.buffer),i}if(t instanceof ui)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],r=0,o=t;r<o.length;r+=1){var a=o[r];n.push(fi(a,e))}return n}if("object"==typeof t){var s=t.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");var u={};if(s.serialize)u._serialized=s.serialize(t,e);else for(var c in t)if(t.hasOwnProperty(c)&&!(ci[l].omit.indexOf(c)>=0)){var h=t[c];u[c]=ci[l].shallow.indexOf(c)>=0?h:fi(h,e)}return{name:l,properties:u}}throw new Error("can't serialize object of type "+typeof t)}function di(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof ui)return t;if(Array.isArray(t))return t.map(function(t){return di(t)});if("object"==typeof t){var e=t,i=e.name,n=e.properties;if(!i)throw new Error("can't deserialize object of anonymous class");var r=ci[i].klass;if(!r)throw new Error("can't deserialize unregistered class "+i);if(r.deserialize)return r.deserialize(n._serialized);for(var o=Object.create(r.prototype),a=0,s=Object.keys(n);a<s.length;a+=1){var l=s[a];o[l]=ci[i].shallow.indexOf(l)>=0?n[l]:di(n[l])}return o}throw new Error("can't deserialize object of type "+typeof t)}var mi=function(t,e){this.property=t,this.value=e,this.expression=Fe(void 0===e?t.specification.default:e,t.specification)};mi.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},mi.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var yi=function(t){this.property=t,this.value=new mi(t,void 0)};yi.prototype.transitioned=function(t,e){return new vi(this.property,this.value,e,_({},t.transition,this.transition),t.now)},yi.prototype.untransitioned=function(){return new vi(this.property,this.value,null,{},0)};var gi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};gi.prototype.getValue=function(t){return k(this._values[t].value.value)},gi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new yi(this._values[t].property)),this._values[t].value=new mi(this._values[t].property,null===e?void 0:k(e))},gi.prototype.getTransition=function(t){return k(this._values[t].transition)},gi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new yi(this._values[t].property)),this._values[t].transition=k(e)||void 0},gi.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},gi.prototype.transitioned=function(t,e){for(var i=new _i(this._properties),n=0,r=Object.keys(this._values);n<r.length;n+=1){var o=r[n];i._values[o]=this._values[o].transitioned(t,e._values[o])}return i},gi.prototype.untransitioned=function(){for(var t=new _i(this._properties),e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e];t._values[n]=this._values[n].untransitioned()}return t};var vi=function(t,e,i,n,r){this.property=t,this.value=e,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)};vi.prototype.possiblyEvaluate=function(t){var e=t.now||0,i=this.value.possiblyEvaluate(t),n=this.prior;if(n){if(e>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(e<this.begin)return n.possiblyEvaluate(t);var r=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(r))}return i};var _i=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};_i.prototype.possiblyEvaluate=function(t){for(var e=new wi(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var r=n[i];e._values[r]=this._values[r].possiblyEvaluate(t)}return e},_i.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var i=e[t];if(this._values[i].prior)return!0}return!1};var xi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};xi.prototype.getValue=function(t){return k(this._values[t].value)},xi.prototype.setValue=function(t,e){this._values[t]=new mi(this._values[t].property,null===e?void 0:k(e))},xi.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r)}return t},xi.prototype.possiblyEvaluate=function(t){for(var e=new wi(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var r=n[i];e._values[r]=this._values[r].possiblyEvaluate(t)}return e};var bi=function(t,e,i){this.property=t,this.value=e,this.globals=i};bi.prototype.isConstant=function(){return"constant"===this.value.kind},bi.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},bi.prototype.evaluate=function(t){return this.property.evaluate(this.value,this.globals,t)};var wi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};wi.prototype.get=function(t){return this._values[t]};var Ti=function(t){this.specification=t};Ti.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Ti.prototype.interpolate=function(t,e,i){var n=Ot[this.specification.type];return n?n(t,e,i):t};var Si=function(t){this.specification=t};Si.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new bi(this,{kind:"constant",value:t.expression.evaluate(e)},e):new bi(this,t.expression,e)},Si.prototype.interpolate=function(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0!==t.value.value&&void 0!==e.value.value){var n=Ot[this.specification.type];return n?new bi(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.globals):t}},Si.prototype.evaluate=function(t,e,i){return"constant"===t.kind?t.value:t.evaluate(e,i)};var zi=function(t){this.specification=t};zi.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e)}},zi.prototype._calculate=function(t,e,i,n){var r=n.zoom,o=r-Math.floor(r),a=n.crossFadingFactor();return r>n.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:o+(1-o)*a}:{from:i,to:e,fromScale:.5,toScale:1,t:1-(1-a)*o}},zi.prototype.interpolate=function(t){return t};var Ai=function(t){this.specification=t};Ai.prototype.possiblyEvaluate=function(){},Ai.prototype.interpolate=function(){};var ki=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var i=t[e],n=this.defaultPropertyValues[e]=new mi(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new yi(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};hi("DataDrivenProperty",Si),hi("DataConstantProperty",Ti),hi("CrossFadedProperty",zi),hi("HeatmapColorProperty",Ai);var Ei=function(t){function e(e,i){for(var n in t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible","background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this._featureFilter=function(){return!0},i.layout&&(this._unevaluatedLayout=new xi(i.layout)),this._transitionablePaint=new gi(i.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,i){if(null!=e){var n="layers."+this.id+".layout."+t;if(this._validate(ii.layoutProperty,n,t,e,i))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible"},e.prototype.getPaintProperty=function(t){return S(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,i){if(null!=e){var n="layers."+this.id+".paint."+t;if(this._validate(ii.paintProperty,n,t,e,i))return}S(t,"-transition")?this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0):this._transitionablePaint.setValue(t,e)},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility)},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),A(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&oi(this,t.call(ii,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:K,style:{glyphs:!0,sprite:!0}}))},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e}(H),Ii={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Mi=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ci=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Pi(t,e){void 0===e&&(e=1);var i=0,n=0;return{members:t.map(function(t){var r,o=(r=t.type,Ii[r].BYTES_PER_ELEMENT),a=i=Li(i,Math.max(e,o)),s=t.components||1;return n=Math.max(n,o),i+=o*s,{name:t.name,type:t.type,components:s,offset:a}}),size:Li(i,Math.max(n,e)),alignment:e}}function Li(t,e){return Math.ceil(t/e)*e}Ci.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ci.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ci.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ci.prototype.clear=function(){this.length=0},Ci.prototype.resize=function(t){this.reserve(t),this.length=t},Ci.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ci.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.int16[n+0]=t,this.int16[n+1]=e,i},e}(Ci);Di.prototype.bytesPerElement=4,hi("StructArrayLayout2i4",Di);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;this.resize(r+1);var o=4*r;return this.int16[o+0]=t,this.int16[o+1]=e,this.int16[o+2]=i,this.int16[o+3]=n,r},e}(Ci);Ri.prototype.bytesPerElement=8,hi("StructArrayLayout4i8",Ri);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=r,this.int16[s+5]=o,a},e}(Ci);Bi.prototype.bytesPerElement=12,hi("StructArrayLayout2i4i12",Bi);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s){var l=this.length;this.resize(l+1);var u=6*l,c=12*l;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=i,this.int16[u+3]=n,this.uint8[c+8]=r,this.uint8[c+9]=o,this.uint8[c+10]=a,this.uint8[c+11]=s,l},e}(Ci);Oi.prototype.bytesPerElement=12,hi("StructArrayLayout4i4ub12",Oi);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s){var l=this.length;this.resize(l+1);var u=8*l;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=i,this.int16[u+3]=n,this.uint16[u+4]=r,this.uint16[u+5]=o,this.uint16[u+6]=a,this.uint16[u+7]=s,l},e}(Ci);Fi.prototype.bytesPerElement=16,hi("StructArrayLayout4i4ui16",Fi);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.float32[r+0]=t,this.float32[r+1]=e,this.float32[r+2]=i,n},e}(Ci);ji.prototype.bytesPerElement=12,hi("StructArrayLayout3f12",ji);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.uint32[i+0]=t,e},e}(Ci);Vi.prototype.bytesPerElement=4,hi("StructArrayLayout1ul4",Vi);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s,l,u,c){var h=this.length;this.resize(h+1);var p=12*h,f=6*h;return this.int16[p+0]=t,this.int16[p+1]=e,this.int16[p+2]=i,this.int16[p+3]=n,this.int16[p+4]=r,this.int16[p+5]=o,this.uint32[f+3]=a,this.uint16[p+8]=s,this.uint16[p+9]=l,this.int16[p+10]=u,this.int16[p+11]=c,h},e}(Ci);Ni.prototype.bytesPerElement=24,hi("StructArrayLayout6i1ul2ui2i24",Ni);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=r,this.int16[s+5]=o,a},e}(Ci);Ui.prototype.bytesPerElement=12,hi("StructArrayLayout2i2i2i12",Ui);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=4*i;return this.uint8[n+0]=t,this.uint8[n+1]=e,i},e}(Ci);qi.prototype.bytesPerElement=4,hi("StructArrayLayout2ub4",qi);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s,l,u,c,h,p,f){var d=this.length;this.resize(d+1);var m=20*d,y=10*d,g=40*d;return this.int16[m+0]=t,this.int16[m+1]=e,this.uint16[m+2]=i,this.uint16[m+3]=n,this.uint32[y+2]=r,this.uint32[y+3]=o,this.uint32[y+4]=a,this.uint16[m+10]=s,this.uint16[m+11]=l,this.uint16[m+12]=u,this.float32[y+7]=c,this.float32[y+8]=h,this.uint8[g+36]=p,this.uint8[g+37]=f,d},e}(Ci);Zi.prototype.bytesPerElement=40,hi("StructArrayLayout2i2ui3ul3ui2f2ub40",Zi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.float32[i+0]=t,e},e}(Ci);Gi.prototype.bytesPerElement=4,hi("StructArrayLayout1f4",Gi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.int16[r+0]=t,this.int16[r+1]=e,this.int16[r+2]=i,n},e}(Ci);Wi.prototype.bytesPerElement=6,hi("StructArrayLayout3i6",Wi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=2*n,o=4*n;return this.uint32[r+0]=t,this.uint16[o+2]=e,this.uint16[o+3]=i,n},e}(Ci);Xi.prototype.bytesPerElement=8,hi("StructArrayLayout1ul2ui8",Xi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.uint16[r+0]=t,this.uint16[r+1]=e,this.uint16[r+2]=i,n},e}(Ci);Hi.prototype.bytesPerElement=6,hi("StructArrayLayout3ui6",Hi);var Ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.uint16[n+0]=t,this.uint16[n+1]=e,i},e}(Ci);Ki.prototype.bytesPerElement=4,hi("StructArrayLayout2ui4",Ki);var Ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.float32[n+0]=t,this.float32[n+1]=e,i},e}(Ci);Ji.prototype.bytesPerElement=8,hi("StructArrayLayout2f8",Ji);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;this.resize(r+1);var o=4*r;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=i,this.float32[o+3]=n,r},e}(Ci);Yi.prototype.bytesPerElement=16,hi("StructArrayLayout4f16",Yi);var $i=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},i.radius.get=function(){return this._structArray.int16[this._pos2+10]},i.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},i.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},i.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},i.anchorPoint.get=function(){return new c(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,i),e}(Mi);$i.prototype.size=24;var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new $i(this,t)},e}(Ni);hi("CollisionBoxArray",Qi);var tn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},i.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},Object.defineProperties(e.prototype,i),e}(Mi);tn.prototype.size=40;var en=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new tn(this,t)},e}(Zi);hi("PlacedSymbolArray",en);var nn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={offsetX:{configurable:!0}};return i.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},i.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,i),e}(Mi);nn.prototype.size=4;var rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new nn(this,t)},e}(Gi);hi("GlyphOffsetArray",rn);var on=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return i.x.get=function(){return this._structArray.int16[this._pos2+0]},i.x.set=function(t){this._structArray.int16[this._pos2+0]=t},i.y.get=function(){return this._structArray.int16[this._pos2+1]},i.y.set=function(t){this._structArray.int16[this._pos2+1]=t},i.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},i.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,i),e}(Mi);on.prototype.size=6;var an=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new on(this,t)},e}(Wi);hi("SymbolLineVertexArray",an);var sn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,i),e}(Mi);sn.prototype.size=8;var ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new sn(this,t)},e}(Xi);hi("FeatureIndexArray",ln);var un=Pi([{name:"a_pos",components:2,type:"Int16"}],4).members,cn=Math.pow(2,16)-1,hn=function(t){void 0===t&&(t=[]),this.segments=t};hn.prototype.prepareSegment=function(t,e,i){var n=this.segments[this.segments.length-1];return t>cn&&M("Max vertices per segment is "+cn+": bucket requested "+t),(!n||n.vertexLength+t>cn)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n},hn.prototype.get=function(){return this.segments},hn.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var i=e[t];for(var n in i.vaos)i.vaos[n].destroy()}},hi("SegmentVector",hn);var pn=function(t,e){return 256*(t=m(Math.floor(t),0,255))+(e=m(Math.floor(e),0,255))};function fn(t){return[pn(255*t.r,255*t.g),pn(255*t.b,255*t.a)]}var dn=function(t,e,i){this.value=t,this.name=e,this.type=i,this.statistics={max:-1/0}};dn.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},dn.prototype.populatePaintArray=function(){},dn.prototype.upload=function(){},dn.prototype.destroy=function(){},dn.prototype.setUniforms=function(t,e,i,n){var r=n.constantOr(this.value),o=t.gl;"color"===this.type?o.uniform4f(e.uniforms["u_"+this.name],r.r,r.g,r.b,r.a):o.uniform1f(e.uniforms["u_"+this.name],r)};var mn=function(t,e,i){this.expression=t,this.name=e,this.type=i,this.statistics={max:-1/0};var n="color"===i?Ji:Gi;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?2:1,offset:0}],this.paintVertexArray=new n};mn.prototype.defines=function(){return[]},mn.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,n=i.length;i.reserve(t);var r=this.expression.evaluate({zoom:0},e);if("color"===this.type)for(var o=fn(r),a=n;a<t;a++)i.emplaceBack(o[0],o[1]);else{for(var s=n;s<t;s++)i.emplaceBack(r);this.statistics.max=Math.max(this.statistics.max,r)}},mn.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},mn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},mn.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0)};var yn=function(t,e,i,n,r){this.expression=t,this.name=e,this.type=i,this.useIntegerZoom=n,this.zoom=r,this.statistics={max:-1/0};var o="color"===i?Yi:Ji;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?4:2,offset:0}],this.paintVertexArray=new o};yn.prototype.defines=function(){return[]},yn.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,n=i.length;i.reserve(t);var r=this.expression.evaluate({zoom:this.zoom},e),o=this.expression.evaluate({zoom:this.zoom+1},e);if("color"===this.type)for(var a=fn(r),s=fn(o),l=n;l<t;l++)i.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var u=n;u<t;u++)i.emplaceBack(r,o);this.statistics.max=Math.max(this.statistics.max,r,o)}},yn.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},yn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},yn.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},yn.prototype.setUniforms=function(t,e,i){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(i.zoom))};var gn=function(){this.binders={},this.cacheKey="",this._buffers=[]};gn.createDynamic=function(t,e,i){var n=new gn,r=[];for(var o in t.paint._values)if(i(o)){var a=t.paint.get(o);if(a instanceof bi&&a.property.specification["property-function"]){var s=_n(o,t.type),l=a.property.specification.type,u=a.property.useIntegerZoom;"constant"===a.value.kind?(n.binders[o]=new dn(a.value,s,l),r.push("/u_"+s)):"source"===a.value.kind?(n.binders[o]=new mn(a.value,s,l),r.push("/a_"+s)):(n.binders[o]=new yn(a.value,s,l,u,e),r.push("/z_"+s))}}return n.cacheKey=r.sort().join(""),n},gn.prototype.populatePaintArrays=function(t,e){for(var i in this.binders)this.binders[i].populatePaintArray(t,e)},gn.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},gn.prototype.setUniforms=function(t,e,i,n){for(var r in this.binders){this.binders[r].setUniforms(t,e,n,i.get(r))}},gn.prototype.getPaintVertexBuffers=function(){return this._buffers},gn.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var i=[];for(var n in this.binders){var r=this.binders[n];(r instanceof mn||r instanceof yn)&&r.paintVertexBuffer&&i.push(r.paintVertexBuffer)}this._buffers=i},gn.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var vn=function(t,e,i,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,o=e;r<o.length;r+=1){var a=o[r];this.programConfigurations[a.id]=gn.createDynamic(a,i,n),this.programConfigurations[a.id].layoutAttributes=t}};function _n(t,e){return{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"}[t]||t.replace(e+"-","").replace(/-/g,"_")}vn.prototype.populatePaintArrays=function(t,e){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e)},vn.prototype.get=function(t){return this.programConfigurations[t]},vn.prototype.upload=function(t){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t)},vn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},hi("ConstantBinder",dn),hi("SourceExpressionBinder",mn),hi("CompositeExpressionBinder",yn),hi("ProgramConfiguration",gn,{omit:["_buffers"]}),hi("ProgramConfigurationSet",vn);var xn=8192;var bn,wn=(bn=16,{min:-1*Math.pow(2,bn-1),max:Math.pow(2,bn-1)-1});function Tn(t){for(var e=xn/t.extent,i=t.loadGeometry(),n=0;n<i.length;n++)for(var r=i[n],o=0;o<r.length;o++){var a=r[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<wn.min||a.x>wn.max||a.y<wn.min||a.y>wn.max)&&M("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return i}function Sn(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}var zn=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Di,this.indexArray=new Hi,this.segments=new hn,this.programConfigurations=new vn(un,t.layers,t.zoom)};zn.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Tn(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},zn.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},zn.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,un),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},zn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zn.prototype.addFeature=function(t,e){for(var i=0,n=e;i<n.length;i+=1)for(var r=0,o=n[i];r<o.length;r+=1){var a=o[r],s=a.x,l=a.y;if(!(s<0||s>=xn||l<0||l>=xn)){var u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=u.vertexLength;Sn(this.layoutVertexArray,s,l,-1,-1),Sn(this.layoutVertexArray,s,l,1,-1),Sn(this.layoutVertexArray,s,l,1,1),Sn(this.layoutVertexArray,s,l,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),u.vertexLength+=4,u.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hi("CircleBucket",zn,{omit:["layers"]});var An={multiPolygonIntersectsBufferedMultiPoint:kn,multiPolygonIntersectsMultiPolygon:En,multiPolygonIntersectsBufferedMultiLine:In,polygonIntersectsPolygon:function(t,e){for(var i=0;i<t.length;i++)if(Bn(e,t[i]))return!0;for(var n=0;n<e.length;n++)if(Bn(t,e[n]))return!0;if(Cn(t,e))return!0;return!1},distToSegmentSquared:Dn};function kn(t,e,i){for(var n=0;n<t.length;n++)for(var r=t[n],o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var l=a[s];if(Bn(r,l))return!0;if(Ln(l,r,i))return!0}return!1}function En(t,e){if(1===t.length&&1===t[0].length)return Rn(e,t[0][0]);for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(Rn(t,n[r]))return!0;for(var o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++)if(Rn(e,a[s]))return!0;for(var l=0;l<e.length;l++)if(Cn(a,e[l]))return!0}return!1}function In(t,e,i){for(var n=0;n<e.length;n++)for(var r=e[n],o=0;o<t.length;o++){var a=t[o];if(a.length>=3)for(var s=0;s<r.length;s++)if(Bn(a,r[s]))return!0;if(Mn(a,r,i))return!0}return!1}function Mn(t,e,i){if(t.length>1){if(Cn(t,e))return!0;for(var n=0;n<e.length;n++)if(Ln(e[n],t,i))return!0}for(var r=0;r<t.length;r++)if(Ln(t[r],e,i))return!0;return!1}function Cn(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var n=t[i],r=t[i+1],o=0;o<e.length-1;o++){if(Pn(n,r,e[o],e[o+1]))return!0}return!1}function Pn(t,e,i,n){return C(t,i,n)!==C(e,i,n)&&C(t,e,i)!==C(t,e,n)}function Ln(t,e,i){var n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(var r=1;r<e.length;r++){if(Dn(t,e[r-1],e[r])<n)return!0}return!1}function Dn(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distSqr(e):r>1?t.distSqr(i):t.distSqr(i.sub(e)._mult(r)._add(e))}function Rn(t,e){for(var i,n,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(i=t[a]).length-1;s<i.length;l=s++)n=i[s],r=i[l],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o);return o}function Bn(t,e){for(var i=!1,n=0,r=t.length-1;n<t.length;r=n++){var o=t[n],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}function On(t,e,i){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).binders[t].statistics.max}function Fn(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function jn(t,e,i,n,r){if(!e[0]&&!e[1])return t;var o=c.convert(e);"viewport"===i&&o._rotate(-n);for(var a=[],s=0;s<t.length;s++){for(var l=t[s],u=[],h=0;h<l.length;h++)u.push(l[h].sub(o._mult(r)));a.push(u)}return a}var Vn={paint:new ki({"circle-radius":new Si(K.paint_circle["circle-radius"]),"circle-color":new Si(K.paint_circle["circle-color"]),"circle-blur":new Si(K.paint_circle["circle-blur"]),"circle-opacity":new Si(K.paint_circle["circle-opacity"]),"circle-translate":new Ti(K.paint_circle["circle-translate"]),"circle-translate-anchor":new Ti(K.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ti(K.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ti(K.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Si(K.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Si(K.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Si(K.paint_circle["circle-stroke-opacity"])})},Nn=function(t){function e(e){t.call(this,e,Vn)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new zn(t)},e.prototype.queryRadius=function(t){var e=t;return On("circle-radius",this,e)+On("circle-stroke-width",this,e)+Fn(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){return kn(jn(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r,o),i,this.paint.get("circle-radius").evaluate(e)*o+this.paint.get("circle-stroke-width").evaluate(e)*o)},e}(Ei),Un=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(zn);function qn(t,e,i,n){var r=e.width,o=e.height;if(n){if(n.length!==r*o*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(r*o*i);return t.width=r,t.height=o,t.data=n,t}function Zn(t,e,i){var n=e.width,r=e.height;if(n!==t.width||r!==t.height){var o=qn({},{width:n,height:r},i);Gn(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,r)},i),t.width=n,t.height=r,t.data=o.data}}function Gn(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<r.height;l++)for(var u=((i.y+l)*t.width+i.x)*o,c=((n.y+l)*e.width+n.x)*o,h=0;h<r.width*o;h++)s[c+h]=a[u+h];return e}hi("HeatmapBucket",Un,{omit:["layers"]});var Wn=function(t,e){qn(this,t,1,e)};Wn.prototype.resize=function(t){Zn(this,t,1)},Wn.prototype.clone=function(){return new Wn({width:this.width,height:this.height},new Uint8Array(this.data))},Wn.copy=function(t,e,i,n,r){Gn(t,e,i,n,r,1)};var Xn=function(t,e){qn(this,t,4,e)};Xn.prototype.resize=function(t){Zn(this,t,4)},Xn.prototype.clone=function(){return new Xn({width:this.width,height:this.height},new Uint8Array(this.data))},Xn.copy=function(t,e,i,n,r){Gn(t,e,i,n,r,4)},hi("AlphaImage",Wn),hi("RGBAImage",Xn);var Hn={paint:new ki({"heatmap-radius":new Si(K.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Si(K.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ti(K.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ai(K.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ti(K.paint_heatmap["heatmap-opacity"])})},Kn=function(t){function e(e){t.call(this,e,Hn),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Un(t)},e.prototype.setPaintProperty=function(e,i,n){t.prototype.setPaintProperty.call(this,e,i,n),"heatmap-color"===e&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){for(var t=this._transitionablePaint._values["heatmap-color"].value.expression,e=new Uint8Array(1024),i=e.length,n=4;n<i;n+=4){var r=t.evaluate({heatmapDensity:n/i});e[n+0]=Math.floor(255*r.r/r.a),e[n+1]=Math.floor(255*r.g/r.a),e[n+2]=Math.floor(255*r.b/r.a),e[n+3]=Math.floor(255*r.a)}this.colorRamp=new Xn({width:256,height:1},e),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Ei),Jn={paint:new ki({"hillshade-illumination-direction":new Ti(K.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ti(K.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ti(K.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ti(K.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ti(K.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ti(K.paint_hillshade["hillshade-accent-color"])})},Yn=function(t){function e(e){t.call(this,e,Jn)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Ei),$n=Pi([{name:"a_pos",components:2,type:"Int16"}],4).members,Qn=er,tr=er;function er(t,e,i){i=i||2;var n,r,o,a,s,l,u,c=e&&e.length,h=c?e[0]*i:t.length,p=ir(t,0,h,i,!0),f=[];if(!p)return f;if(c&&(p=function(t,e,i,n){var r,o,a,s,l,u=[];for(r=0,o=e.length;r<o;r++)a=e[r]*n,s=r<o-1?e[r+1]*n:t.length,(l=ir(t,a,s,n,!1))===l.next&&(l.steiner=!0),u.push(pr(l));for(u.sort(ur),r=0;r<u.length;r++)cr(u[r],i),i=nr(i,i.next);return i}(t,e,p,i)),t.length>80*i){n=o=t[0],r=a=t[1];for(var d=i;d<h;d+=i)(s=t[d])<n&&(n=s),(l=t[d+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-r))?1/u:0}return rr(p,f,i,n,r,u),f}function ir(t,e,i,n,r){var o,a;if(r===Tr(t,e,i,n)>0)for(o=e;o<i;o+=n)a=xr(o,t[o],t[o+1],a);else for(o=i-n;o>=e;o-=n)a=xr(o,t[o],t[o+1],a);return a&&yr(a,a.next)&&(br(a),a=a.next),a}function nr(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!yr(n,n.next)&&0!==mr(n.prev,n,n.next))n=n.next;else{if(br(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function rr(t,e,i,n,r,o,a){if(t){!a&&o&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=hr(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,a,s,l,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,n=i,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(a>1)}(r)}(t,n,r,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?ar(t,n,r,o):or(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),br(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?rr(t=sr(t,e,i),e,i,n,r,o,2):2===a&&lr(t,e,i,n,r,o):rr(nr(t),e,i,n,r,o,1);break}}}function or(t){var e=t.prev,i=t,n=t.next;if(mr(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(fr(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&mr(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ar(t,e,i,n){var r=t.prev,o=t,a=t.next;if(mr(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=hr(s,l,e,i,n),p=hr(u,c,e,i,n),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&fr(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&mr(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&fr(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&mr(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&fr(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&mr(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&fr(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&mr(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function sr(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!yr(r,o)&&gr(r,n,n.next,o)&&vr(r,o)&&vr(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),br(n),br(n.next),n=t=o),n=n.next}while(n!==t);return n}function lr(t,e,i,n,r,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&dr(a,s)){var l=_r(a,s);return a=nr(a,a.next),l=nr(l,l.next),rr(a,e,i,n,r,o),void rr(l,e,i,n,r,o)}s=s.next}a=a.next}while(a!==t)}function ur(t,e){return t.x-e.x}function cr(t,e){if(e=function(t,e){var i,n=e,r=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if(a=s,s===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var l,u=i,c=i.x,h=i.y,p=1/0;n=i.next;for(;n!==u;)r>=n.x&&n.x>=c&&r!==n.x&&fr(o<h?r:a,o,c,h,o<h?a:r,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(r-n.x))<p||l===p&&n.x>i.x)&&vr(n,t)&&(i=n,p=l),n=n.next;return i}(t,e)){var i=_r(e,t);nr(i,i.next)}}function hr(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function pr(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function fr(t,e,i,n,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(i-a)*(e-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function dr(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&gr(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&vr(t,e)&&vr(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function mr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function yr(t,e){return t.x===e.x&&t.y===e.y}function gr(t,e,i,n){return!!(yr(t,e)&&yr(i,n)||yr(t,n)&&yr(i,e))||mr(t,e,i)>0!=mr(t,e,n)>0&&mr(i,n,t)>0!=mr(i,n,e)>0}function vr(t,e){return mr(t.prev,t,t.next)<0?mr(t,e,t.next)>=0&&mr(t,t.prev,e)>=0:mr(t,e,t.prev)<0||mr(t,t.next,e)<0}function _r(t,e){var i=new wr(t.i,t.x,t.y),n=new wr(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function xr(t,e,i,n){var r=new wr(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function br(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function wr(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tr(t,e,i,n){for(var r=0,o=e,a=i-n;o<i;o+=n)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}er.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,a=Math.abs(Tr(t,0,o,i));if(r)for(var s=0,l=e.length;s<l;s++){var u=e[s]*i,c=s<l-1?e[s+1]*i:t.length;a-=Math.abs(Tr(t,u,c,i))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*i,f=n[s+1]*i,d=n[s+2]*i;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},er.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i},Qn.default=tr;var Sr=function t(e,i,n,r,o){n=n||0;r=r||e.length-1;o=o||Ar;for(;r>n;){if(r-n>600){var a=r-n+1,s=i-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1),h=Math.max(n,Math.floor(i-s*u/a+c)),p=Math.min(r,Math.floor(i+(a-s)*u/a+c));t(e,i,h,p,o)}var f=e[i],d=n,m=r;for(zr(e,n,i),o(e[r],f)>0&&zr(e,n,r);d<m;){for(zr(e,d,m),d++,m--;o(e[d],f)<0;)d++;for(;o(e[m],f)>0;)m--}0===o(e[n],f)?zr(e,n,m):zr(e,++m,r),m<=i&&(n=m+1),i<=m&&(r=m-1)}};function zr(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Ar(t,e){return t<e?-1:t>e?1:0}function kr(t,e){var i=t.length;if(i<=1)return[t];for(var n,r,o=[],a=0;a<i;a++){var s=P(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),e>1)for(var l=0;l<o.length;l++)o[l].length<=e||(Sr(o[l],e,1,o[l].length-1,Er),o[l]=o[l].slice(0,e));return o}function Er(t,e){return e.area-t.area}var Ir=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Di,this.indexArray=new Hi,this.indexArray2=new Ki,this.programConfigurations=new vn($n,t.layers,t.zoom),this.segments=new hn,this.segments2=new hn};Ir.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Tn(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},Ir.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ir.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$n),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2),this.programConfigurations.upload(t)},Ir.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ir.prototype.addFeature=function(t,e){for(var i=0,n=kr(e,500);i<n.length;i+=1){for(var r=n[i],o=0,a=0,s=r;a<s.length;a+=1){o+=s[a].length}for(var l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),u=l.vertexLength,c=[],h=[],p=0,f=r;p<f.length;p+=1){var d=f[p];if(0!==d.length){d!==r[0]&&h.push(c.length/2);var m=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),y=m.vertexLength;this.layoutVertexArray.emplaceBack(d[0].x,d[0].y),this.indexArray2.emplaceBack(y+d.length-1,y),c.push(d[0].x),c.push(d[0].y);for(var g=1;g<d.length;g++)this.layoutVertexArray.emplaceBack(d[g].x,d[g].y),this.indexArray2.emplaceBack(y+g-1,y+g),c.push(d[g].x),c.push(d[g].y);m.vertexLength+=d.length,m.primitiveLength+=d.length}}for(var v=Qn(c,h),_=0;_<v.length;_+=3)this.indexArray.emplaceBack(u+v[_],u+v[_+1],u+v[_+2]);l.vertexLength+=o,l.primitiveLength+=v.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hi("FillBucket",Ir,{omit:["layers"]});var Mr={paint:new ki({"fill-antialias":new Ti(K.paint_fill["fill-antialias"]),"fill-opacity":new Si(K.paint_fill["fill-opacity"]),"fill-color":new Si(K.paint_fill["fill-color"]),"fill-outline-color":new Si(K.paint_fill["fill-outline-color"]),"fill-translate":new Ti(K.paint_fill["fill-translate"]),"fill-translate-anchor":new Ti(K.paint_fill["fill-translate-anchor"]),"fill-pattern":new zi(K.paint_fill["fill-pattern"])})},Cr=function(t){function e(e){t.call(this,e,Mr)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t),void 0===this._transitionablePaint.getValue("fill-outline-color")&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new Ir(t)},e.prototype.queryRadius=function(){return Fn(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){return En(jn(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r,o),i)},e}(Ei),Pr=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Lr=Math.pow(2,13);function Dr(t,e,i,n,r,o,a,s){t.emplaceBack(e,i,2*Math.floor(n*Lr)+a,r*Lr*2,o*Lr*2,Math.round(s))}var Rr=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Bi,this.indexArray=new Hi,this.programConfigurations=new vn(Pr,t.layers,t.zoom),this.segments=new hn};function Br(t,e){return t.x===e.x&&(t.x<0||t.x>xn)||t.y===e.y&&(t.y<0||t.y>xn)}function Or(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>xn})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>xn})}Rr.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Tn(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},Rr.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Rr.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pr),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},Rr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Rr.prototype.addFeature=function(t,e){for(var i=0,n=kr(e,500);i<n.length;i+=1){for(var r=n[i],o=0,a=0,s=r;a<s.length;a+=1){o+=s[a].length}for(var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),u=0,c=r;u<c.length;u+=1){var h=c[u];if(0!==h.length&&!Or(h))for(var p=0,f=0;f<h.length;f++){var d=h[f];if(f>=1){var m=h[f-1];if(!Br(d,m)){l.vertexLength+4>cn&&(l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=d.sub(m)._perp()._unit(),g=m.dist(d);p+g>32768&&(p=0),Dr(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,p),Dr(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,p),p+=g,Dr(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,p),Dr(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,p);var v=l.vertexLength;this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v+1,v+2,v+3),l.vertexLength+=4,l.primitiveLength+=2}}}}l.vertexLength+o>cn&&(l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var _=[],x=[],b=l.vertexLength,w=0,T=r;w<T.length;w+=1){var S=T[w];if(0!==S.length){S!==r[0]&&x.push(_.length/2);for(var z=0;z<S.length;z++){var A=S[z];Dr(this.layoutVertexArray,A.x,A.y,0,0,1,1,0),_.push(A.x),_.push(A.y)}}}for(var k=Qn(_,x),E=0;E<k.length;E+=3)this.indexArray.emplaceBack(b+k[E],b+k[E+1],b+k[E+2]);l.primitiveLength+=k.length/3,l.vertexLength+=o}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},hi("FillExtrusionBucket",Rr,{omit:["layers"]});var Fr={paint:new ki({"fill-extrusion-opacity":new Ti(K["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Si(K["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ti(K["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ti(K["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zi(K["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Si(K["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Si(K["paint_fill-extrusion"]["fill-extrusion-base"])})},jr=function(t){function e(e){t.call(this,e,Fr)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Rr(t)},e.prototype.queryRadius=function(){return Fn(this.paint.get("fill-extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){return En(jn(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),r,o),i)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null)},e}(Ei),Vr=Pi([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Nr=Ur;function Ur(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(qr,this,e)}function qr(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Zr(t){for(var e,i,n=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],n+=((i=t[a]).x-e.x)*(e.y+i.y);return n}Ur.types=["Unknown","Point","LineString","Polygon"],Ur.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,a=0,s=[];t.pos<i;){if(!r){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new c(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},Ur.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!n){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<a&&(a=r),r>s&&(s=r),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,u]},Ur.prototype.toGeoJSON=function(t,e,i){var n,r,o=this.extent*Math.pow(2,i),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=Ur.types[this.type];function c(t){for(var e=0;e<t.length;e++){var i=t[e],n=180-360*(i.y+s)/o;t[e]=[360*(i.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var a=Zr(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}i&&r.push(i);return r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)c(l[n][r])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Gr=Wr;function Wr(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Xr,this,e),this.length=this._features.length}function Xr(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){var e=null,i=t.readVarint()+t.pos;for(;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}function Hr(t,e,i){if(3===t){var n=new Gr(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}Wr.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Nr(this._pbf,e,this.extent,this._keys,this._values)};var Kr={VectorTile:function(t,e){this.layers=t.readFields(Hr,{},e)},VectorTileFeature:Nr,VectorTileLayer:Gr},Jr=Kr.VectorTileFeature.types,Yr=63,$r=Math.cos(Math.PI/180*37.5),Qr=.5,to=Math.pow(2,14)/Qr;function eo(t,e,i,n,r,o,a){t.emplaceBack(e.x,e.y,n?1:0,r?1:-1,Math.round(Yr*i.x)+128,Math.round(Yr*i.y)+128,1+(0===o?0:o<0?-1:1)|(a*Qr&63)<<2,a*Qr>>6)}var io=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Oi,this.indexArray=new Hi,this.programConfigurations=new vn(Vr,t.layers,t.zoom),this.segments=new hn};io.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=Tn(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},io.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},io.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vr),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},io.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},io.prototype.addFeature=function(t,e){for(var i=this.layers[0].layout,n=i.get("line-join").evaluate(t),r=i.get("line-cap"),o=i.get("line-miter-limit"),a=i.get("line-round-limit"),s=0,l=e;s<l.length;s+=1){var u=l[s];this.addLine(u,t,n,r,o,a)}},io.prototype.addLine=function(t,e,i,n,r,o){for(var a="Polygon"===Jr[e.type],s=t.length;s>=2&&t[s-1].equals(t[s-2]);)s--;for(var l=0;l<s-1&&t[l].equals(t[l+1]);)l++;if(!(s<(a?3:2))){"bevel"===i&&(r=1.05);var u=xn/(512*this.overscaling)*15,c=t[l],h=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);this.distance=0;var p,f,d,m=n,y=a?"butt":n,g=!0,v=void 0,_=void 0,x=void 0,b=void 0;this.e1=this.e2=this.e3=-1,a&&(p=t[s-2],b=c.sub(p)._unit()._perp());for(var w=l;w<s;w++)if(!(_=a&&w===s-1?t[l+1]:t[w+1])||!t[w].equals(_)){b&&(x=b),p&&(v=p),p=t[w],b=_?_.sub(p)._unit()._perp():x;var T=(x=x||b).add(b);0===T.x&&0===T.y||T._unit();var S=T.x*b.x+T.y*b.y,z=0!==S?1/S:1/0,A=S<$r&&v&&_;if(A&&w>l){var k=p.dist(v);if(k>2*u){var E=p.sub(p.sub(v)._mult(u/k)._round());this.distance+=E.dist(v),this.addCurrentVertex(E,this.distance,x.mult(1),0,0,!1,h),v=E}}var I=v&&_,M=I?i:_?m:y;if(I&&"round"===M&&(z<o?M="miter":z<=2&&(M="fakeround")),"miter"===M&&z>r&&(M="bevel"),"bevel"===M&&(z>2&&(M="flipbevel"),z<r&&(M="miter")),v&&(this.distance+=p.dist(v)),"miter"===M)T._mult(z),this.addCurrentVertex(p,this.distance,T,0,0,!1,h);else if("flipbevel"===M){if(z>100)T=b.clone().mult(-1);else{var C=x.x*b.y-x.y*b.x>0?-1:1,P=z*x.add(b).mag()/x.sub(b).mag();T._perp()._mult(P*C)}this.addCurrentVertex(p,this.distance,T,0,0,!1,h),this.addCurrentVertex(p,this.distance,T.mult(-1),0,0,!1,h)}else if("bevel"===M||"fakeround"===M){var L=x.x*b.y-x.y*b.x>0,D=-Math.sqrt(z*z-1);if(L?(d=0,f=D):(f=0,d=D),g||this.addCurrentVertex(p,this.distance,x,f,d,!1,h),"fakeround"===M){for(var R=Math.floor(8*(.5-(S-.5))),B=void 0,O=0;O<R;O++)B=b.mult((O+1)/(R+1))._add(x)._unit(),this.addPieSliceVertex(p,this.distance,B,L,h);this.addPieSliceVertex(p,this.distance,T,L,h);for(var F=R-1;F>=0;F--)B=x.mult((F+1)/(R+1))._add(b)._unit(),this.addPieSliceVertex(p,this.distance,B,L,h)}_&&this.addCurrentVertex(p,this.distance,b,-f,-d,!1,h)}else"butt"===M?(g||this.addCurrentVertex(p,this.distance,x,0,0,!1,h),_&&this.addCurrentVertex(p,this.distance,b,0,0,!1,h)):"square"===M?(g||(this.addCurrentVertex(p,this.distance,x,1,1,!1,h),this.e1=this.e2=-1),_&&this.addCurrentVertex(p,this.distance,b,-1,-1,!1,h)):"round"===M&&(g||(this.addCurrentVertex(p,this.distance,x,0,0,!1,h),this.addCurrentVertex(p,this.distance,x,1,1,!0,h),this.e1=this.e2=-1),_&&(this.addCurrentVertex(p,this.distance,b,-1,-1,!0,h),this.addCurrentVertex(p,this.distance,b,0,0,!1,h)));if(A&&w<s-1){var j=p.dist(_);if(j>2*u){var V=p.add(_.sub(p)._mult(u/j)._round());this.distance+=V.dist(p),this.addCurrentVertex(V,this.distance,b.mult(1),0,0,!1,h),p=V}}g=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)}},io.prototype.addCurrentVertex=function(t,e,i,n,r,o,a){var s,l=this.layoutVertexArray,u=this.indexArray;s=i.clone(),n&&s._sub(i.perp()._mult(n)),eo(l,t,s,o,!1,n,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),r&&s._sub(i.perp()._mult(r)),eo(l,t,s,o,!0,-r,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>to/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,n,r,o,a))},io.prototype.addPieSliceVertex=function(t,e,i,n,r){i=i.mult(n?-1:1);var o=this.layoutVertexArray,a=this.indexArray;eo(o,t,i,!1,n,0,e),this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(a.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3},hi("LineBucket",io,{omit:["layers"]});var no=new ki({"line-cap":new Ti(K.layout_line["line-cap"]),"line-join":new Si(K.layout_line["line-join"]),"line-miter-limit":new Ti(K.layout_line["line-miter-limit"]),"line-round-limit":new Ti(K.layout_line["line-round-limit"])}),ro={paint:new ki({"line-opacity":new Si(K.paint_line["line-opacity"]),"line-color":new Si(K.paint_line["line-color"]),"line-translate":new Ti(K.paint_line["line-translate"]),"line-translate-anchor":new Ti(K.paint_line["line-translate-anchor"]),"line-width":new Si(K.paint_line["line-width"]),"line-gap-width":new Si(K.paint_line["line-gap-width"]),"line-offset":new Si(K.paint_line["line-offset"]),"line-blur":new Si(K.paint_line["line-blur"]),"line-dasharray":new zi(K.paint_line["line-dasharray"]),"line-pattern":new zi(K.paint_line["line-pattern"])}),layout:no},oo=function(){this.first=!0};oo.prototype.update=function(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))};var ao=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oo,this.transition={})};ao.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)};var so=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new ao(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,n){return i=_({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,n)},e}(Si))(ro.paint.properties["line-width"].specification);so.useIntegerZoom=!0;var lo=function(t){function e(e){t.call(this,e,ro)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=so.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new io(t)},e.prototype.queryRadius=function(t){var e=t,i=uo(On("line-width",this,e),On("line-gap-width",this,e)),n=On("line-offset",this,e);return i/2+Math.abs(n)+Fn(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){var a=jn(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r,o),s=o/2*uo(this.paint.get("line-width").evaluate(e),this.paint.get("line-gap-width").evaluate(e)),l=this.paint.get("line-offset").evaluate(e);return l&&(i=function(t,e){for(var i=[],n=new c(0,0),r=0;r<t.length;r++){for(var o=t[r],a=[],s=0;s<o.length;s++){var l=o[s-1],u=o[s],h=o[s+1],p=0===s?n:u.sub(l)._unit()._perp(),f=s===o.length-1?n:h.sub(u)._unit()._perp(),d=p._add(f)._unit(),m=d.x*f.x+d.y*f.y;d._mult(1/m),a.push(d._mult(e)._add(u))}i.push(a)}return i}(i,l*o)),In(a,i,s)},e}(Ei);function uo(t,e){return e>0?e+2*t:t}var co,ho=Pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),po=Pi([{name:"a_projected_pos",components:3,type:"Float32"}],4),fo=(Pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Pi([{name:"a_placed",components:2,type:"Uint8"}],4)),mo=(Pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),yo=Pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),go=(Pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Pi([{type:"Float32",name:"offsetX"}]),Pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),!1),vo=null,_o=new H,xo=function(t){return vo?t({pluginBlobURL:vo,errorCallback:co}):_o.once("pluginAvailable",t),t},bo={applyArabicShaping:null,processBidirectionalText:null};function wo(t,e,i){var n=e.layout.get("text-transform").evaluate(i);return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),bo.applyArabicShaping&&(t=bo.applyArabicShaping(t)),t}var To={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function So(t){for(var e=0,i=t;e<i.length;e+=1){if(ko(i[e].charCodeAt(0)))return!0}return!1}function zo(t){for(var e=0,i=t;e<i.length;e+=1){if(!Ao(i[e].charCodeAt(0)))return!1}return!0}function Ao(t){return!To.Arabic(t)&&(!To["Arabic Supplement"](t)&&(!To["Arabic Extended-A"](t)&&(!To["Arabic Presentation Forms-A"](t)&&!To["Arabic Presentation Forms-B"](t))))}function ko(t){return 746===t||747===t||!(t<4352)&&(!!To["Bopomofo Extended"](t)||(!!To.Bopomofo(t)||(!(!To["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||(!!To["CJK Compatibility Ideographs"](t)||(!!To["CJK Compatibility"](t)||(!!To["CJK Radicals Supplement"](t)||(!!To["CJK Strokes"](t)||(!(!To["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||(!!To["CJK Unified Ideographs Extension A"](t)||(!!To["CJK Unified Ideographs"](t)||(!!To["Enclosed CJK Letters and Months"](t)||(!!To["Hangul Compatibility Jamo"](t)||(!!To["Hangul Jamo Extended-A"](t)||(!!To["Hangul Jamo Extended-B"](t)||(!!To["Hangul Jamo"](t)||(!!To["Hangul Syllables"](t)||(!!To.Hiragana(t)||(!!To["Ideographic Description Characters"](t)||(!!To.Kanbun(t)||(!!To["Kangxi Radicals"](t)||(!!To["Katakana Phonetic Extensions"](t)||(!(!To.Katakana(t)||12540===t)||(!(!To["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||(!(!To["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(!!To["Unified Canadian Aboriginal Syllabics"](t)||(!!To["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!To["Vertical Forms"](t)||(!!To["Yijing Hexagram Symbols"](t)||(!!To["Yi Syllables"](t)||!!To["Yi Radicals"](t))))))))))))))))))))))))))))))}function Eo(t){return!(ko(t)||function(t){return!!(To["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||To["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||To["Letterlike Symbols"](t)||To["Number Forms"](t)||To["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||To["Control Pictures"](t)&&9251!==t||To["Optical Character Recognition"](t)||To["Enclosed Alphanumerics"](t)||To["Geometric Shapes"](t)||To["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||To["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||To["CJK Symbols and Punctuation"](t)||To.Katakana(t)||To["Private Use Area"](t)||To["CJK Compatibility Forms"](t)||To["Small Form Variants"](t)||To["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}var Io={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Mo=function(t){function e(e,i,n,r){t.call(this,e,i),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(c);hi("Anchor",Mo);var Co={getSizeData:Po,evaluateSizeForFeature:function(t,e,i){var n=e;return"source"===t.functionType?i.lowerSize/10:"composite"===t.functionType?Ot.number(i.lowerSize/10,i.upperSize/10,n.uSizeT):n.uSize},evaluateSizeForZoom:function(t,e,i){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var n=t.propertyValue,r=t.zoomRange,o=t.sizeRange,a=Fe(n,i.specification),s=m(a.interpolationFactor(e,r.min,r.max),0,1);return{uSizeT:0,uSize:o.min+s*(o.max-o.min)}}var l=t.propertyValue,u=t.zoomRange,c=Fe(l,i.specification);return{uSizeT:m(c.interpolationFactor(e,u.min,u.max),0,1),uSize:0}}};function Po(t,e){var i=e.expression;if("constant"===i.kind)return{functionType:"constant",layoutSize:i.evaluate({zoom:t+1})};if("source"===i.kind)return{functionType:"source"};for(var n=i.zoomStops,r=0;r<n.length&&n[r]<=t;)r++;for(var o=r=Math.max(0,r-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var a={min:n[r],max:n[o]};return"composite"===i.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:i.evaluate({zoom:t+1}),zoomRange:a,sizeRange:{min:i.evaluate({zoom:a.min}),max:i.evaluate({zoom:a.max})},propertyValue:e.value}}var Lo=Kr.VectorTileFeature.types,Do=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ro(t,e,i,n,r,o,a,s){t.emplaceBack(e,i,Math.round(64*n),Math.round(64*r),o,a,s?s[0]:0,s?s[1]:0)}function Bo(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}var Oo=function(t){this.layoutVertexArray=new Fi,this.indexArray=new Hi,this.programConfigurations=t,this.segments=new hn,this.dynamicLayoutVertexArray=new ji,this.opacityVertexArray=new Vi,this.placedSymbolArray=new en};Oo.prototype.upload=function(t,e){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ho.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.programConfigurations.upload(t),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,po.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Do,!0),this.opacityVertexBuffer.itemSize=1},Oo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},hi("SymbolBuffers",Oo);var Fo=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new hn,this.collisionVertexArray=new qi};Fo.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,fo.members,!0)},Fo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},hi("CollisionBuffers",Fo);var jo=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Po(this.zoom,e["text-size"]),this.iconSizeData=Po(this.zoom,e["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")};jo.prototype.createArrays=function(){this.text=new Oo(new vn(ho.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Oo(new vn(ho.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Fo(Ui,mo.members,Ki),this.collisionCircle=new Fo(Ui,yo.members,Hi),this.glyphOffsetArray=new rn,this.lineVertexArray=new an},jo.prototype.populate=function(t,e){var i=this.layers[0],n=i.layout,r=n.get("text-font"),o=n.get("text-field"),a=n.get("icon-image"),s=("constant"!==o.value.kind||o.value.value.length>0)&&("constant"!==r.value.kind||r.value.value.length>0),l="constant"!==a.value.kind||a.value.value&&a.value.value.length>0;if(this.features=[],s||l){for(var u=e.iconDependencies,c=e.glyphDependencies,h={zoom:this.zoom},p=0,f=t;p<f.length;p+=1){var d=f[p],m=d.feature,y=d.index,g=d.sourceLayerIndex;if(i._featureFilter(h,m)){var v=void 0;s&&(v=wo(v=i.getValueAndResolveTokens("text-field",m),i,m));var _=void 0;if(l&&(_=i.getValueAndResolveTokens("icon-image",m)),v||_){var x={text:v,icon:_,index:y,sourceLayerIndex:g,geometry:Tn(m),properties:m.properties,type:Lo[m.type]};if(void 0!==m.id&&(x.id=m.id),this.features.push(x),_&&(u[_]=!0),v)for(var b=r.evaluate(m).join(","),w=c[b]=c[b]||{},T="map"===n.get("text-rotation-alignment")&&"line"===n.get("symbol-placement"),S=So(v),z=0;z<v.length;z++)if(w[v.charCodeAt(z)]=!0,T&&S){var A=Io[v.charAt(z)];A&&(w[A.charCodeAt(0)]=!0)}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},i={},n=[],r=0;function o(e){n.push(t[e]),r++}function a(t,e,r){var o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function s(t,i,r){var o=e[i];return delete e[i],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.text;if(p){var f=l(p,h),d=l(p,h,!0);if(f in i&&d in e&&i[f]!==e[d]){var m=s(f,d,h),y=a(f,d,n[m].geometry);delete e[f],delete i[d],i[l(p,n[y].geometry,!0)]=y,n[m].geometry=null}else f in i?a(f,d,h):d in e?s(f,d,h):(o(u),e[f]=r-1,i[d]=r-1)}else o(u)}return n.filter(function(t){return t.geometry})}(this.features))}},jo.prototype.isEmpty=function(){return 0===this.symbolInstances.length},jo.prototype.upload=function(t){this.text.upload(t,this.sortFeaturesByY),this.icon.upload(t,this.sortFeaturesByY),this.collisionBox.upload(t),this.collisionCircle.upload(t)},jo.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},jo.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},s>0&&(r+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},jo.prototype.addSymbols=function(t,e,i,n,r,o,a,s,l,u){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),d=this.glyphOffsetArray.length,m=f.vertexLength,y=0,g=e;y<g.length;y+=1){var v=g[y],_=v.tl,x=v.tr,b=v.bl,w=v.br,T=v.tex,S=f.vertexLength,z=v.glyphOffset[1];Ro(h,s.x,s.y,_.x,z+_.y,T.x,T.y,i),Ro(h,s.x,s.y,x.x,z+x.y,T.x+T.w,T.y,i),Ro(h,s.x,s.y,b.x,z+b.y,T.x,T.y+T.h,i),Ro(h,s.x,s.y,w.x,z+w.y,T.x+T.w,T.y+T.h,i),Bo(p,s,0),c.emplaceBack(S,S+1,S+2),c.emplaceBack(S+1,S+2,S+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(v.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,m,l,u,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o)},jo.prototype._addCollisionDebugVertex=function(t,e,i,n,r){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,n.x,n.y,Math.round(r.x),Math.round(r.y))},jo.prototype.addCollisionDebugVertices=function(t,e,i,n,r,o,a,s){var l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,h=r.layoutVertexArray,p=r.collisionVertexArray;if(this._addCollisionDebugVertex(h,p,o,a.anchor,new c(t,e)),this._addCollisionDebugVertex(h,p,o,a.anchor,new c(i,e)),this._addCollisionDebugVertex(h,p,o,a.anchor,new c(i,n)),this._addCollisionDebugVertex(h,p,o,a.anchor,new c(t,n)),l.vertexLength+=4,s){var f=r.indexArray;f.emplaceBack(u,u+1,u+2),f.emplaceBack(u,u+2,u+3),l.primitiveLength+=2}else{var d=r.indexArray;d.emplaceBack(u,u+1),d.emplaceBack(u+1,u+2),d.emplaceBack(u+2,u+3),d.emplaceBack(u+3,u),l.primitiveLength+=4}},jo.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var i=e[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var n=0;n<2;n++){var r=i[0===n?"textCollisionFeature":"iconCollisionFeature"];if(r)for(var o=r.boxStartIndex;o<r.boxEndIndex;o++){var a=this.collisionBoxArray.get(o),s=a.x1,l=a.y1,u=a.x2,c=a.y2,h=a.radius>0;this.addCollisionDebugVertices(s,l,u,c,h?this.collisionCircle:this.collisionBox,a.anchorPoint,i,h)}}}},jo.prototype.deserializeCollisionBoxes=function(t,e,i,n,r){for(var o={},a=e;a<i;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY};break}o.textCircles||(o.textCircles=[]);o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var l=n;l<r;l++){var u=t.get(l);if(0===u.radius){o.iconBox={x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,anchorPointX:u.anchorPointX,anchorPointY:u.anchorPointY};break}}return o},jo.prototype.hasTextData=function(){return this.text.segments.get().length>0},jo.prototype.hasIconData=function(){return this.icon.segments.get().length>0},jo.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},jo.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},jo.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var i=[],n=0;n<this.symbolInstances.length;n++)i.push(n);var r=Math.sin(t),o=Math.cos(t);i.sort(function(t,i){var n=e.symbolInstances[t],a=e.symbolInstances[i];return(r*n.anchor.x+o*n.anchor.y|0)-(r*a.anchor.x+o*a.anchor.y|0)||a.featureIndex-n.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear();for(var a=0,s=i;a<s.length;a+=1){for(var l=s[a],u=0,c=e.symbolInstances[l].placedTextSymbolIndices;u<c.length;u+=1)for(var h=c[u],p=e.text.placedSymbolArray.get(h),f=p.vertexStartIndex+4*p.numGlyphs,d=p.vertexStartIndex;d<f;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var m=e.icon.placedSymbolArray.get(l);if(m.numGlyphs){var y=m.vertexStartIndex;e.icon.indexArray.emplaceBack(y,y+1,y+2),e.icon.indexArray.emplaceBack(y+1,y+2,y+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},hi("SymbolBucket",jo,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),jo.MAX_GLYPHS=65535,jo.addDynamicAttributes=Bo;var Vo=new ki({"symbol-placement":new Ti(K.layout_symbol["symbol-placement"]),"symbol-spacing":new Ti(K.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ti(K.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new Ti(K.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ti(K.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ti(K.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ti(K.layout_symbol["icon-rotation-alignment"]),"icon-size":new Si(K.layout_symbol["icon-size"]),"icon-text-fit":new Ti(K.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ti(K.layout_symbol["icon-text-fit-padding"]),"icon-image":new Si(K.layout_symbol["icon-image"]),"icon-rotate":new Si(K.layout_symbol["icon-rotate"]),"icon-padding":new Ti(K.layout_symbol["icon-padding"]),"icon-keep-upright":new Ti(K.layout_symbol["icon-keep-upright"]),"icon-offset":new Si(K.layout_symbol["icon-offset"]),"icon-anchor":new Si(K.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ti(K.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ti(K.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ti(K.layout_symbol["text-rotation-alignment"]),"text-field":new Si(K.layout_symbol["text-field"]),"text-font":new Si(K.layout_symbol["text-font"]),"text-size":new Si(K.layout_symbol["text-size"]),"text-max-width":new Si(K.layout_symbol["text-max-width"]),"text-line-height":new Ti(K.layout_symbol["text-line-height"]),"text-letter-spacing":new Si(K.layout_symbol["text-letter-spacing"]),"text-justify":new Si(K.layout_symbol["text-justify"]),"text-anchor":new Si(K.layout_symbol["text-anchor"]),"text-max-angle":new Ti(K.layout_symbol["text-max-angle"]),"text-rotate":new Si(K.layout_symbol["text-rotate"]),"text-padding":new Ti(K.layout_symbol["text-padding"]),"text-keep-upright":new Ti(K.layout_symbol["text-keep-upright"]),"text-transform":new Si(K.layout_symbol["text-transform"]),"text-offset":new Si(K.layout_symbol["text-offset"]),"text-allow-overlap":new Ti(K.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ti(K.layout_symbol["text-ignore-placement"]),"text-optional":new Ti(K.layout_symbol["text-optional"])}),No={paint:new ki({"icon-opacity":new Si(K.paint_symbol["icon-opacity"]),"icon-color":new Si(K.paint_symbol["icon-color"]),"icon-halo-color":new Si(K.paint_symbol["icon-halo-color"]),"icon-halo-width":new Si(K.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Si(K.paint_symbol["icon-halo-blur"]),"icon-translate":new Ti(K.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ti(K.paint_symbol["icon-translate-anchor"]),"text-opacity":new Si(K.paint_symbol["text-opacity"]),"text-color":new Si(K.paint_symbol["text-color"]),"text-halo-color":new Si(K.paint_symbol["text-halo-color"]),"text-halo-width":new Si(K.paint_symbol["text-halo-width"]),"text-halo-blur":new Si(K.paint_symbol["text-halo-blur"]),"text-translate":new Ti(K.paint_symbol["text-translate"]),"text-translate-anchor":new Ti(K.paint_symbol["text-translate-anchor"])}),layout:Vo},Uo=function(t){function e(e){t.call(this,e,No)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var i,n=this.layout.get(t).evaluate(e),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||Pe(r.value)?n:(i=e.properties,n.replace(/{([^{}]+)}/g,function(t,e){return e in i?String(i[e]):""}))},e.prototype.createBucket=function(t){return new jo(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Ei),qo={paint:new ki({"background-color":new Ti(K.paint_background["background-color"]),"background-pattern":new zi(K.paint_background["background-pattern"]),"background-opacity":new Ti(K.paint_background["background-opacity"])})},Zo=function(t){function e(e){t.call(this,e,qo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ei),Go={paint:new ki({"raster-opacity":new Ti(K.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ti(K.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ti(K.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ti(K.paint_raster["raster-brightness-max"]),"raster-saturation":new Ti(K.paint_raster["raster-saturation"]),"raster-contrast":new Ti(K.paint_raster["raster-contrast"]),"raster-fade-duration":new Ti(K.paint_raster["raster-fade-duration"])})},Wo={circle:Nn,heatmap:Kn,hillshade:Yn,fill:Cr,"fill-extrusion":jr,line:lo,symbol:Uo,background:Zo,raster:function(t){function e(e){t.call(this,e,Go)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ei)};function Xo(t){return new Wo[t.type](t)}var Ho={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null},Ko="See https://www.mapbox.com/api-documentation/#access-tokens";function Jo(t,e){var i=ra(Ho.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"/"!==i.path&&(t.path=""+i.path+t.path),!Ho.REQUIRE_ACCESS_TOKEN)return oa(t);if(!(e=e||Ho.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+Ko);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+Ko);return t.params.push("access_token="+e),oa(t)}function Yo(t){return 0===t.indexOf("mapbox:")}var $o=function(t,e){if(!Yo(t))return t;var i=ra(t);return i.path="/fonts/v1"+i.path,Jo(i,e)},Qo=function(t,e){if(!Yo(t))return t;var i=ra(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),Jo(i,e)},ta=function(t,e,i,n){var r=ra(t);return Yo(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+i,Jo(r,n)):(r.path+=""+e+i,oa(r))},ea=/(\.(png|jpg)\d*)(?=$)/,ia=function(t,e,i){if(!e||!Yo(e))return t;var n=ra(t),r=o.devicePixelRatio>=2||512===i?"@2x":"",a=o.supportsWebp?".webp":"$1";return n.path=n.path.replace(ea,""+r+a),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(Ho.ACCESS_TOKEN||""))}(n.params),oa(n)};var na=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ra(t){var e=t.match(na);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function oa(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var aa=t(function(t,e){t.exports=function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,r,o,a=[],s=0;s<t.length;s++)if(i=t[s].w||t[s].width,n=t[s].h||t[s].height,r=t[s].id,i&&n){if(!(o=this.packOne(i,n,r)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}return this.shrink(),a},t.prototype.packOne=function(t,i,n){var r,o,a,s,l,u,c,h,p={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof n||"number"==typeof n){if(r=this.getBin(n))return this.ref(r),r;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(i===(r=this.freebins[s]).maxh&&t===r.maxw)return this.allocFreebin(s,t,i,n);i>r.maxh||t>r.maxw||i<=r.maxh&&t<=r.maxw&&(a=r.maxw*r.maxh-t*i)<p.waste&&(p.waste=a,p.freebin=s)}for(s=0;s<this.shelves.length;s++)if(f+=(o=this.shelves[s]).h,!(t>o.free)){if(i===o.h)return this.allocShelf(s,t,i,n);i>o.h||i<o.h&&(a=(o.h-i)*t)<p.waste&&(p.freebin=-1,p.waste=a,p.shelf=s)}return-1!==p.freebin?this.allocFreebin(p.freebin,t,i,n):-1!==p.shelf?this.allocShelf(p.shelf,t,i,n):i<=this.h-f&&t<=this.w?(o=new e(f,this.w,i),this.allocShelf(this.shelves.push(o)-1,t,i,n)):this.autoResize?(l=u=this.h,((c=h=this.w)<=l||t>c)&&(h=2*Math.max(t,c)),(l<c||i>l)&&(u=2*Math.max(i,l)),this.resize(h,u),this.packOne(t,i,n)):null},t.prototype.allocFreebin=function(t,e,i,n){var r=this.freebins.splice(t,1)[0];return r.id=n,r.w=e,r.h=i,r.refcount=0,this.bins[n]=r,this.ref(r),r},t.prototype.allocShelf=function(t,e,i,n){var r=this.shelves[t].alloc(e,i,n);return this.bins[n]=r,this.ref(r),r},t.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var n=this.shelves[i];e+=n.h,t=Math.max(n.w-n.free,t)}this.resize(t,e)}},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},e.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new function(t,e,i,n,r,o,a){this.id=t,this.x=e,this.y=i,this.w=n,this.h=r,this.maxw=o||n,this.maxh=a||r,this.refcount=0}(i,n,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t}()}),sa=1;function la(t,e){var i=e.pixelRatio,n={x:t.x+sa,y:t.y+sa,w:t.w-2*sa,h:t.h-2*sa};return{pixelRatio:i,textureRect:n,tl:[n.x,n.y],br:[n.x+n.w,n.y+n.h],displaySize:[n.w/i,n.h/i]}}var ua=self.HTMLImageElement,ca=self.HTMLCanvasElement,ha=self.HTMLVideoElement,pa=self.ImageData,fa=function(t,e,i,n){this.context=t;var r=e.width,o=e.height;this.size=[r,o],this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)};fa.prototype.update=function(t,e){var i=t.width,n=t.height;this.size=[i,n];var r=this.context,o=r.gl;o.bindTexture(o.TEXTURE_2D,this.texture),r.pixelStoreUnpack.set(1),this.format===o.RGBA&&!1!==e&&r.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof ua||t instanceof ca||t instanceof ha||t instanceof pa?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,t):o.texImage2D(o.TEXTURE_2D,0,this.format,i,n,0,this.format,o.UNSIGNED_BYTE,t.data)},fa.prototype.bind=function(t,e,i){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},fa.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var da=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new aa(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new Xn({width:64,height:64}),this.dirty=!0};da.prototype.isLoaded=function(){return this.loaded},da.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var n=i[e],r=n.ids,o=n.callback;this._notify(r,o)}this.requestors=[]}},da.prototype.getImage=function(t){return this.images[t]},da.prototype.addImage=function(t,e){this.images[t]=e},da.prototype.removeImage=function(t){delete this.images[t];var e=this.patterns[t];e&&(this.shelfPack.unref(e.bin),delete this.patterns[t])},da.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var n=0,r=t;n<r.length;n+=1){var o=r[n];this.images[o]||(i=!1)}this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})},da.prototype._notify=function(t,e){for(var i={},n=0,r=t;n<r.length;n+=1){var o=r[n],a=this.images[o];a&&(i[o]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf})}e(null,i)},da.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},da.prototype.getPattern=function(t){var e=this.patterns[t];if(e)return e.position;var i=this.getImage(t);if(!i)return null;var n=i.data.width+2,r=i.data.height+2,o=this.shelfPack.packOne(n,r);if(!o)return null;this.atlasImage.resize(this.getPixelSize());var a=i.data,s=this.atlasImage,l=o.x+1,u=o.y+1,c=a.width,h=a.height;Xn.copy(a,s,{x:0,y:0},{x:l,y:u},{width:c,height:h}),Xn.copy(a,s,{x:0,y:h-1},{x:l,y:u-1},{width:c,height:1}),Xn.copy(a,s,{x:0,y:0},{x:l,y:u+h},{width:c,height:1}),Xn.copy(a,s,{x:c-1,y:0},{x:l-1,y:u},{width:1,height:h}),Xn.copy(a,s,{x:0,y:0},{x:l+c,y:u},{width:1,height:h}),this.dirty=!0;var p=la(o,i);return this.patterns[t]={bin:o,position:p},p},da.prototype.bind=function(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new fa(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)};var ma=function(t,e,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,p=i?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},ya=function(t,e,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;t[i+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;t[i+f]=255&a,f+=d,a/=256,u-=8);t[i+f-d]|=128*m},ga=va;function va(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}va.Varint=0,va.Fixed64=1,va.Bytes=2,va.Fixed32=5;function _a(t){return t.type===va.Bytes?t.readVarint()+t.pos:t.pos+1}function xa(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function ba(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function wa(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Ta(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Sa(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function za(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Aa(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ka(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Ea(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Ia(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Ma(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Ca(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Pa(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function La(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}va.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ca(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=La(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ca(this.buf,this.pos)+4294967296*Ca(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Ca(this.buf,this.pos)+4294967296*La(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ma(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ma(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(r=o[i.pos++],n=(112&r)>>4,r<128)return xa(t,n,e);if(r=o[i.pos++],n|=(127&r)<<3,r<128)return xa(t,n,e);if(r=o[i.pos++],n|=(127&r)<<10,r<128)return xa(t,n,e);if(r=o[i.pos++],n|=(127&r)<<17,r<128)return xa(t,n,e);if(r=o[i.pos++],n|=(127&r)<<24,r<128)return xa(t,n,e);if(r=o[i.pos++],n|=(1&r)<<31,r<128)return xa(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){var n="",r=e;for(;r<i;){var o,a,s,l=t[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c>i)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=t[r+1],a=t[r+2],s=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),r+=c}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=_a(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=_a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===va.Varint)for(;this.buf[this.pos++]>127;);else if(e===va.Bytes)this.pos=this.readVarint()+this.pos;else if(e===va.Fixed32)this.pos+=4;else{if(e!==va.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Pa(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Pa(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Pa(this.buf,-1&t,this.pos),Pa(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Pa(this.buf,-1&t,this.pos),Pa(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&ba(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ya(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ya(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&ba(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,va.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,wa,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Ta,e)},writePackedBoolean:function(t,e){this.writeMessage(t,Aa,e)},writePackedFloat:function(t,e){this.writeMessage(t,Sa,e)},writePackedDouble:function(t,e){this.writeMessage(t,za,e)},writePackedFixed32:function(t,e){this.writeMessage(t,ka,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Ea,e)},writePackedFixed64:function(t,e){this.writeMessage(t,Ia,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Ma,e)},writeBytesField:function(t,e){this.writeTag(t,va.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,va.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,va.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,va.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,va.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,va.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,va.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,va.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,va.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,va.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Da=3;function Ra(t,e,i){1===t&&i.readMessage(Ba,e)}function Ba(t,e,i){if(3===t){var n=i.readMessage(Oa,{}),r=n.id,o=n.bitmap,a=n.width,s=n.height,l=n.left,u=n.top,c=n.advance;e.push({id:r,bitmap:new Wn({width:a+2*Da,height:s+2*Da},o),metrics:{width:a,height:s,left:l,top:u,advance:c}})}}function Oa(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}var Fa=Da;function ja(t,e,i,n,r){var o=256*e,a=o+255,s=n($o(i).replace("{fontstack}",t).replace("{range}",o+"-"+a),V.Glyphs);Z(s,function(t,e){if(t)r(t);else if(e){for(var i={},n=0,o=(s=e.data,new ga(s).readFields(Ra,[]));n<o.length;n+=1){var a=o[n];i[a.id]=a}r(null,i)}var s})}var Va=Ua,Na=1e20;function Ua(t,e,i,n,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=i||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function qa(t,e,i,n,r,o,a){for(var s=0;s<e;s++){for(var l=0;l<i;l++)n[l]=t[l*e+s];for(Za(n,r,o,a,i),l=0;l<i;l++)t[l*e+s]=r[l]}for(l=0;l<i;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(Za(n,r,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(r[s])}}function Za(t,e,i,n,r){i[0]=0,n[0]=-Na,n[1]=+Na;for(var o=1,a=0;o<r;o++){for(var s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);s<=n[a];)a--,s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);i[++a]=o,n[a]=s,n[a+1]=+Na}for(o=0,a=0;o<r;o++){for(;n[a+1]<o;)a++;e[o]=(o-i[a])*(o-i[a])+t[i[a]]}}Ua.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var r=e.data[4*n+3]/255;this.gridOuter[n]=1===r?0:0===r?Na:Math.pow(Math.max(0,.5-r),2),this.gridInner[n]=1===r?Na:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(qa(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),qa(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++){var o=this.gridOuter[n]-this.gridInner[n];i[n]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return i};var Ga=function(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={}};Ga.prototype.setURL=function(t){this.url=t},Ga.prototype.getGlyphs=function(t,e){var i=this,n=[];for(var r in t)for(var o=0,a=t[r];o<a.length;o+=1){var s=a[o];n.push({stack:r,id:s})}g(n,function(t,e){var n=t.stack,r=t.id,o=i.entries[n];o||(o=i.entries[n]={glyphs:{},requests:{}});var a=o.glyphs[r];if(void 0===a)if(a=i._tinySDF(o,n,r))e(null,{stack:n,id:r,glyph:a});else{var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var l=o.requests[s];l||(l=o.requests[s]=[],ja(n,s,i.url,i.requestTransform,function(t,e){if(e)for(var i in e)o.glyphs[+i]=e[+i];for(var n=0,r=l;n<r.length;n+=1){(0,r[n])(t,e)}delete o.requests[s]})),l.push(function(t,i){t?e(t):i&&e(null,{stack:n,id:r,glyph:i[r]||null})})}}else e(null,{stack:n,id:r,glyph:a})},function(t,i){if(t)e(t);else if(i){for(var n={},r=0,o=i;r<o.length;r+=1){var a=o[r],s=a.stack,l=a.id,u=a.glyph;(n[s]||(n[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}e(null,n)}})},Ga.prototype._tinySDF=function(t,e,i){var n=this.localIdeographFontFamily;if(n&&(To["CJK Unified Ideographs"](i)||To["Hangul Syllables"](i))){var r=t.tinySDF;if(!r){var o="400";/bold/i.test(e)?o="900":/medium/i.test(e)?o="500":/light/i.test(e)&&(o="200"),r=t.tinySDF=new Va(24,3,8,.25,n,o)}return{id:i,bitmap:new Wn({width:30,height:30},r.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}};var Wa=function(){this.specification=K.light.position};Wa.prototype.possiblyEvaluate=function(t,e){return i=t.expression.evaluate(e),n=i[0],r=i[1],o=i[2],r+=90,r*=Math.PI/180,o*=Math.PI/180,{x:n*Math.cos(r)*Math.sin(o),y:n*Math.sin(r)*Math.sin(o),z:n*Math.cos(o)};var i,n,r,o},Wa.prototype.interpolate=function(t,e,i){return{x:Ot.number(t.x,e.x,i),y:Ot.number(t.y,e.y,i),z:Ot.number(t.z,e.z,i)}};var Xa=new ki({anchor:new Ti(K.light.anchor),position:new Wa,color:new Ti(K.light.color),intensity:new Ti(K.light.intensity)}),Ha=function(t){function e(e){t.call(this),this._transitionable=new gi(Xa),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLight=function(){return this._transitionable.serialize()},e.prototype.setLight=function(t){if(!this._validate(ii.light,t))for(var e in t){var i=t[e];S(e,"-transition")?this._transitionable.setTransition(e.slice(0,-"-transition".length),i):this._transitionable.setValue(e,i)}},e.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},e.prototype.hasTransition=function(){return this._transitioning.hasTransition()},e.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},e.prototype._validate=function(t,e){return oi(this,t.call(ii,_({value:e,style:{glyphs:!0,sprite:!0},styleSpec:K})))},e}(H),Ka=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};Ka.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},Ka.prototype.addDash=function(t,e){var i=e?7:0,n=2*i+1;if(this.nextRow+n>this.height)return M("LineAtlas out of space"),null;for(var r=0,o=0;o<t.length;o++)r+=t[o];for(var a=this.width/r,s=a/2,l=t.length%2==1,u=-i;u<=i;u++)for(var c=this.nextRow+i+u,h=this.width*c,p=l?-t[t.length-1]:0,f=t[0],d=1,m=0;m<this.width;m++){for(;f<m/a;)p=f,f+=t[d],l&&d===t.length-1&&(f+=t[0]),d++;var y=Math.abs(m-p*a),g=Math.abs(m-f*a),v=Math.min(y,g),_=d%2==1,x=void 0;if(e){var b=i?u/i*(s+1):0;if(_){var w=s-Math.abs(b);x=Math.sqrt(v*v+w*w)}else x=s-Math.sqrt(v*v+b*b)}else x=(_?1:-1)*v;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,x+128))}var T={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:r};return this.nextRow+=n,this.dirty=!0,T},Ka.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var Ja=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.callbackID=0,T(["receive"],this),this.target.addEventListener("message",this.receive,!1)};Ja.prototype.send=function(t,e,i,n){var r=i?this.mapId+":"+this.callbackID++:null;i&&(this.callbacks[r]=i);var o=[];this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:t,id:String(r),data:fi(e,o)},o)},Ja.prototype.receive=function(t){var e,i=this,n=t.data,r=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var o=function(t,e){var n=[];i.target.postMessage({sourceMapId:i.mapId,type:"<response>",id:String(r),error:t?String(t):null,data:fi(e,n)},n)};if("<response>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&n.error?e(new Error(n.error)):e&&e(null,di(n.data));else if(void 0!==n.id&&this.parent[n.type])this.parent[n.type](n.sourceMapId,di(n.data),o);else if(void 0!==n.id&&this.parent.getWorkerSource){var a=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,a[0],a[1])[a[2]](di(n.data),o)}else this.parent[n.type](di(n.data))}},Ja.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var Ya=function(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=w();for(var i=this.workerPool.acquire(this.id),n=0;n<i.length;n++){var r=i[n],o=new Ja(r,e,this.id);o.name="Worker "+n,this.actors.push(o)}};function $a(t,e,i){var n=function(t,e){if(t)return i(t);if(e){var n=x(e,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);e.vector_layers&&(n.vectorLayers=e.vector_layers,n.vectorLayerIds=n.vectorLayers.map(function(t){return t.id})),i(null,n)}};t.url?q(e(Qo(t.url),V.Source),n):o.frame(function(){return n(null,t)})}Ya.prototype.broadcast=function(t,e,i){i=i||function(){},g(this.actors,function(i,n){i.send(t,e,n)},i)},Ya.prototype.send=function(t,e,i,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i),n},Ya.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)};var Qa=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Qa.prototype.wrap=function(){return new Qa(y(this.lng,-180,180),this.lat)},Qa.prototype.toArray=function(){return[this.lng,this.lat]},Qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Qa.prototype.toBounds=function(t){var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new ts(new Qa(this.lng-i,this.lat-e),new Qa(this.lng+i,this.lat+e))},Qa.convert=function(t){if(t instanceof Qa)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Qa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Qa(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ts=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};ts.prototype.setNorthEast=function(t){return this._ne=t instanceof Qa?new Qa(t.lng,t.lat):Qa.convert(t),this},ts.prototype.setSouthWest=function(t){return this._sw=t instanceof Qa?new Qa(t.lng,t.lat):Qa.convert(t),this},ts.prototype.extend=function(t){var e,i,n=this._sw,r=this._ne;if(t instanceof Qa)e=t,i=t;else{if(!(t instanceof ts))return Array.isArray(t)?t.every(Array.isArray)?this.extend(ts.convert(t)):this.extend(Qa.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return n||r?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new Qa(e.lng,e.lat),this._ne=new Qa(i.lng,i.lat)),this},ts.prototype.getCenter=function(){return new Qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ts.prototype.getSouthWest=function(){return this._sw},ts.prototype.getNorthEast=function(){return this._ne},ts.prototype.getNorthWest=function(){return new Qa(this.getWest(),this.getNorth())},ts.prototype.getSouthEast=function(){return new Qa(this.getEast(),this.getSouth())},ts.prototype.getWest=function(){return this._sw.lng},ts.prototype.getSouth=function(){return this._sw.lat},ts.prototype.getEast=function(){return this._ne.lng},ts.prototype.getNorth=function(){return this._ne.lat},ts.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ts.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ts.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ts.convert=function(t){return!t||t instanceof ts?t:new ts(t)};var es=function(t,e,i){this.bounds=ts.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24};es.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},es.prototype.contains=function(t){var e=Math.floor(this.lngX(this.bounds.getWest(),t.z)),i=Math.floor(this.latY(this.bounds.getNorth(),t.z)),n=Math.ceil(this.lngX(this.bounds.getEast(),t.z)),r=Math.ceil(this.latY(this.bounds.getSouth(),t.z));return t.x>=e&&t.x<n&&t.y>=i&&t.y<r},es.prototype.lngX=function(t,e){return(t+180)*(Math.pow(2,e)/360)},es.prototype.latY=function(t,e){var i=m(Math.sin(Math.PI/180*t),-.9999,.9999),n=Math.pow(2,e)/(2*Math.PI);return Math.pow(2,e-1)+.5*Math.log((1+i)/(1-i))*-n};var is,ns=function(t){function e(e,i,n,r){if(t.call(this),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,_(this,x(i,["url","scheme","tileSize"])),this._options=_({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),$a(this._options,this.map._transformRequest,function(e,i){e?t.fire("error",e):i&&(_(t,i),i.bounds&&(t.tileBounds=new es(i.bounds,t.minzoom,t.maxzoom)),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.serialize=function(){return _({},this._options)},e.prototype.loadTile=function(t,e){var i=t.tileID.overscaleFactor(),n=ia(t.tileID.canonical.url(this.tiles,this.scheme),this.url),r={request:this.map._transformRequest(n,V.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*i,type:this.type,source:this.id,pixelRatio:o.devicePixelRatio,overscaling:i,showCollisionBoxes:this.map.showCollisionBoxes};function a(i,n){return t.aborted?e(null):i?e(i):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",r,a.bind(this)):"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,a.bind(this),t.workerID)},e.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},e.prototype.hasTransition=function(){return!1},e}(H),rs=function(t){function e(e,i,n,r){t.call(this),this.id=e,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_({},i),_(this,x(i,["url","scheme","tileSize"]))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),$a(this._options,this.map._transformRequest,function(e,i){e?t.fire("error",e):i&&(_(t,i),i.bounds&&(t.tileBounds=new es(i.bounds,t.minzoom,t.maxzoom)),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.serialize=function(){return _({},this._options)},e.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},e.prototype.loadTile=function(t,e){var i=this,n=ia(t.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);t.request=G(this.map._transformRequest(n,V.Tile),function(n,r){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(n)t.state="errored",e(n);else if(r){i.map._refreshExpiredTiles&&t.setExpiryData(r),delete r.cacheControl,delete r.expires;var o=i.map.painter.context,a=o.gl;t.texture=i.map.painter.getTileTexture(r.width),t.texture?(t.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,r)):(t.texture=new fa(o,r,a.RGBA),t.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),a.generateMipmap(a.TEXTURE_2D),t.state="loaded",e(null)}})},e.prototype.abortTile=function(t,e){t.request&&(t.request.abort(),delete t.request),e()},e.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},e.prototype.hasTransition=function(){return!1},e}(H),os=t(function(t,e){!function(t){function e(t,e,n){e=Math.pow(2,n)-e-1;var r=i(256*t,256*e,n),o=i(256*(t+1),256*(e+1),n);return r[0]+","+r[1]+","+o[0]+","+o[1]}function i(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i),r=t*n-2*Math.PI*6378137/2,o=e*n-2*Math.PI*6378137/2;return[r,o]}t.getURL=function(t,i,n,r,o,a){return a=a||{},t+"?"+["bbox="+e(n,r,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}),as=(is=os)&&is.__esModule&&Object.prototype.hasOwnProperty.call(is,"default")?is.default:is,ss=function(t,e,i){this.z=t,this.x=e,this.y=i,this.key=cs(0,t,e,i)};ss.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},ss.prototype.url=function(t,e){var i=as.getTileBBox(this.x,this.y,this.z),n=function(t,e,i){for(var n,r="",o=t;o>0;o--)r+=(e&(n=1<<o-1)?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)};var ls=function(t,e){this.wrap=t,this.canonical=e,this.key=cs(t,e.z,e.x,e.y)},us=function(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new ss(i,+n,+r),this.key=cs(e,t,n,r)};function cs(t,e,i,n){(t*=2)<0&&(t=-1*t-1);var r=1<<e;return 32*(r*r*t+r*n+i)+e}us.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new us(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},us.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},us.prototype.children=function(t){if(this.overscaledZ>=t)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new us(e,this.wrap,e,i,n),new us(e,this.wrap,e,i+1,n),new us(e,this.wrap,e,i,n+1),new us(e,this.wrap,e,i+1,n+1)]},us.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},us.prototype.wrapped=function(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},us.prototype.toUnwrapped=function(){return new ls(this.wrap,this.canonical)},us.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},us.prototype.toCoordinate=function(){return new u(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},hi("CanonicalTileID",ss),hi("OverscaledTileID",us,{omit:["posMatrix"]});var hs=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=_({},i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds}},e.prototype.loadTile=function(t,e){var i=ia(t.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);t.request=G(this.map._transformRequest(i,V.Tile),function(i,n){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(i)t.state="errored",e(i);else if(n){this.map._refreshExpiredTiles&&t.setExpiryData(n),delete n.cacheControl,delete n.expires;var r=o.getImageData(n),a={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:r};t.workerID&&"expired"!==t.state||(t.workerID=this.dispatcher.send("loadDEMTile",a,function(i,n){i&&(t.state="errored",e(i));n&&(t.dem=n,t.needsHillshadePrepare=!0,t.state="loaded",e(null))}.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)},e.prototype._getNeighboringTiles=function(t){var e=t.canonical,i=Math.pow(2,e.z),n=(e.x-1+i)%i,r=0===e.x?t.wrap-1:t.wrap,o=(e.x+1+i)%i,a=e.x+1===i?t.wrap+1:t.wrap,s={};return s[new us(t.overscaledZ,r,e.z,n,e.y).key]={backfilled:!1},s[new us(t.overscaledZ,a,e.z,o,e.y).key]={backfilled:!1},e.y>0&&(s[new us(t.overscaledZ,r,e.z,n,e.y-1).key]={backfilled:!1},s[new us(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},s[new us(t.overscaledZ,a,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<i&&(s[new us(t.overscaledZ,r,e.z,n,e.y+1).key]={backfilled:!1},s[new us(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},s[new us(t.overscaledZ,a,e.z,o,e.y+1).key]={backfilled:!1}),s},e.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},e}(rs),ps=function(t){function e(e,i,n,r){t.call(this),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=n,this.setEventedParent(r),this._data=i.data,this._options=_({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type);var o=xn/this.tileSize;this.workerOptions=_({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:xn,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:xn,radius:(i.clusterRadius||50)*o,log:!1}},i.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){if(e)t.fire("error",{error:e});else{var i={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(i.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire("data",i)}})},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){if(t)return e.fire("error",{error:t});var i={dataType:"source",sourceDataType:"content"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire("data",i)}),this},e.prototype._updateWorkerData=function(t){var e,i,n=this,r=_({},this.workerOptions),o=this._data;"string"==typeof o?(r.request=this.map._transformRequest((e=o,(i=self.document.createElement("a")).href=e,i.href),V.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(o),this.workerID=this.dispatcher.send(this.type+"."+r.source+".loadData",r,function(e,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.dispatcher.send(n.type+"."+r.source+".coalesce",null,null,n.workerID),t(e))},this.workerID)},e.prototype.loadTile=function(t,e){var i=this,n=void 0===t.workerID||"expired"===t.state?"loadTile":"reloadTile",r={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.devicePixelRatio,overscaling:t.tileID.overscaleFactor(),showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send(n,r,function(r,o){return t.unloadVectorData(),t.aborted?e(null):r?e(r):(t.loadVectorData(o,i.map.painter,"reloadTile"===n),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},e.prototype.serialize=function(){return _({},this._options,{type:this.type,data:this._data})},e.prototype.hasTransition=function(){return!1},e}(H);var fs=Pi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ds=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};ds.prototype.bind=function(t,e,i,n,r,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,i,n,r,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind())},ds.prototype.freshBind=function(t,e,i,n,r,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=i;p<f.length;p+=1){f[p].enableAttributes(c,t)}o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(var d=0,m=i;d<m.length;d+=1){var y=m[d];y.bind(),y.setVertexAttribPointers(c,t,r)}o&&(o.bind(),o.setVertexAttribPointers(c,t,r)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,r)),u.currentNumAttributes=l},ds.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ms=function(t){function e(e,i,n,r){t.call(this),this.id=e,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(r),this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,G(this.map._transformRequest(this.url,V.Image),function(e,i){e?t.fire("error",{error:e}):i&&(t.image=o.getImageData(i),t._finishLoading())})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,i=t.map(function(t){return e.transform.locationCoordinate(Qa.convert(t)).zoomTo(0)}),n=this.centerCoord=function(t){for(var e=1/0,i=1/0,n=-1/0,r=-1/0,o=0;o<t.length;o++)e=Math.min(e,t[o].column),i=Math.min(i,t[o].row),n=Math.max(n,t[o].column),r=Math.max(r,t[o].row);var a=n-e,s=r-i,l=Math.max(a,s),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2));return new u((e+n)/2,(i+r)/2,0).zoomTo(c)}(i);n.column=Math.floor(n.column),n.row=Math.floor(n.row),this.tileID=new ss(n.zoom,n.column,n.row),this.minzoom=this.maxzoom=n.zoom;var r=i.map(function(t){var e=t.zoomTo(n.zoom);return new c(Math.round((e.column-n.column)*xn),Math.round((e.row-n.row)*xn))});return this._boundsArray=new Ri,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,xn,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,xn),this._boundsArray.emplaceBack(r[2].x,r[2].y,xn,xn),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},e.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,fs.members)),this.boundsVAO||(this.boundsVAO=new ds),this.texture||(this.texture=new fa(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},e.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return!1},e}(H),ys=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.roundZoom=!0,this.type="video",this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,function(t,e){var i,n,r=self.document.createElement("video");r.onloadstart=function(){e(null,r)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");i=t[o],n=void 0,(n=self.document.createElement("a")).href=i,(n.protocol!==self.document.location.protocol||n.host!==self.document.location.host)&&(r.crossOrigin="Anonymous"),a.src=t[o],r.appendChild(a)}}(e.urls,function(e,i){e?t.fire("error",{error:e}):i&&(t.video=i,t.video.loop=!0,t.video.addEventListener("playing",function(){t.map._rerender()}),t.map&&t.video.play(),t._finishLoading())})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,fs.members)),this.boundsVAO||(this.boundsVAO=new ds),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new fa(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return this.video&&!this.video.paused},e}(ms),gs=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.options=i,this.animate=void 0===i.animate||i.animate}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){this.canvas=this.canvas||self.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero.")):(this.play=function(){this._playing=!0,this.map._rerender()},this.pause=function(){this._playing=!1},this._finishLoading())},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},e.prototype.onRemove=function(){this.pause()},e.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,i=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,fs.members)),this.boundsVAO||(this.boundsVAO=new ds),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.canvas)):(this.texture=new fa(e,this.canvas,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[n];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},e.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return this._playing},e.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},e}(ms),vs={vector:ns,raster:rs,"raster-dem":hs,geojson:ps,video:ys,image:ms,canvas:gs},_s=function(t,e,i,n){var r=new vs[e.type](t,e,i,n);if(r.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+r.id);return T(["load","abort","unload","serialize","prepare"],r),r};function xs(t,e,i,n,r,o,a){var s=t.tilesIn(i);s.sort(bs);for(var l=[],u=0,c=s;u<c.length;u+=1){var h=c[u];l.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,h.queryGeometry,h.scale,n,o,t.id,a)})}return function(t){for(var e={},i={},n=0,r=t;n<r.length;n+=1){var o=r[n],a=o.queryResults,s=o.wrappedTileID,l=i[s]=i[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],f=0,d=c;f<d.length;f+=1){var m=d[f];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m.feature))}}return e}(l)}function bs(t,e){var i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}var ws=function(t,e){var i={};if(!e)return i;for(var n=0,r=t;n<r.length;n+=1){var o=r[n],a=o.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==a.length){o.layers=a;for(var s=0,l=a;s<l.length;s+=1){i[l[s].id]=o}}}return i},Ts=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}};Ts.prototype.encode=function(t){return this._stringToNumber[t]},Ts.prototype.decode=function(t){return this._numberToString[t]};var Ss=function(t,e,i,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},zs={geometry:{configurable:!0}};zs.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},zs.geometry.set=function(t){this._geometry=t},Ss.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Ss.prototype,zs);var As=function(t,e,i,n){this.tileID=t,this.overscaling=e,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=i||new ai(xn,16,0),this.featureIndexArray=n||new ln};function ks(t,e){return e-t}As.prototype.insert=function(t,e,i,n,r){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);for(var a=0;a<e.length;a++){for(var s=e[a],l=[1/0,1/0,-1/0,-1/0],u=0;u<s.length;u++){var c=s[u];l[0]=Math.min(l[0],c.x),l[1]=Math.min(l[1],c.y),l[2]=Math.max(l[2],c.x),l[3]=Math.max(l[3],c.y)}this.grid.insert(o,l[0],l[1],l[2],l[3])}},As.prototype.query=function(t,e){this.vtLayers||(this.vtLayers=new Kr.VectorTile(new ga(this.rawTileData)).layers,this.sourceLayerCoder=new Ts(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));for(var i={},n=t.params||{},r=xn/t.tileSize/t.scale,o=Ge(n.filter),a=t.queryGeometry,s=t.additionalRadius*r,l=1/0,u=1/0,c=-1/0,h=-1/0,p=0;p<a.length;p++)for(var f=a[p],d=0;d<f.length;d++){var m=f[d];l=Math.min(l,m.x),u=Math.min(u,m.y),c=Math.max(c,m.x),h=Math.max(h,m.y)}var y=this.grid.query(l-s,u-s,c+s,h+s);y.sort(ks),this.filterMatching(i,y,this.featureIndexArray,a,o,n.layers,e,t.bearing,r);var g=t.collisionIndex?t.collisionIndex.queryRenderedSymbols(a,this.tileID,xn/t.tileSize,t.collisionBoxArray,t.sourceID,t.bucketInstanceIds):[];return g.sort(),this.filterMatching(i,g,t.collisionBoxArray,a,o,n.layers,e,t.bearing,r),i},As.prototype.filterMatching=function(t,e,i,n,r,o,a,s,l){for(var u,c=0;c<e.length;c++){var h=e[c];if(h!==u){u=h;var p=i.get(h),f=this.bucketLayerIDs[p.bucketIndex];if(!o||E(o,f)){var d=this.sourceLayerCoder.decode(p.sourceLayerIndex),m=this.vtLayers[d].feature(p.featureIndex);if(r({zoom:this.tileID.overscaledZ},m))for(var y=null,g=0;g<f.length;g++){var v=f[g];if(!(o&&o.indexOf(v)<0)){var _=a[v];if(_&&("symbol"===_.type||(y||(y=Tn(m)),_.queryIntersectsFeature(n,m,y,this.z,s,l)))){var x=new Ss(m,this.z,this.x,this.y);x.layer=_.serialize();var b=t[v];void 0===b&&(b=t[v]=[]),b.push({featureIndex:h,feature:x})}}}}}}},As.prototype.hasLayer=function(t){for(var e=0,i=this.bucketLayerIDs;e<i.length;e+=1)for(var n=0,r=i[e];n<r.length;n+=1){if(t===r[n])return!0}return!1},hi("FeatureIndex",As,{omit:["rawTileData","sourceLayerCoder","collisionIndex"]});var Es=function(t,e,i){var n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};Es.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Es.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Es.prototype.insertCircle=function(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)},Es.prototype._insertBoxCell=function(t,e,i,n,r,o){this.boxCells[r].push(o)},Es.prototype._insertCircleCell=function(t,e,i,n,r,o){this.circleCells[r].push(o)},Es.prototype._query=function(t,e,i,n,r){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n)o=Array.prototype.slice.call(this.boxKeys).concat(this.circleKeys);else{var a={hitTest:r,seenUids:{box:{},circle:{}}};this._forEachCell(t,e,i,n,this._queryCell,o,a)}return r?o.length>0:o},Es.prototype._queryCircle=function(t,e,i,n){var r=t-i,o=t+i,a=e-i,s=e+i;if(o<0||r>this.width||s<0||a>this.height)return!n&&[];var l=[],u={hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(r,a,o,s,this._queryCellCircle,l,u),n?l.length>0:l},Es.prototype.query=function(t,e,i,n){return this._query(t,e,i,n,!1)},Es.prototype.hitTest=function(t,e,i,n){return this._query(t,e,i,n,!0)},Es.prototype.hitTestCircle=function(t,e,i){return this._queryCircle(t,e,i,!0)},Es.prototype._queryCell=function(t,e,i,n,r,o,a){var s=a.seenUids,l=this.boxCells[r];if(null!==l)for(var u=this.bboxes,c=0,h=l;c<h.length;c+=1){var p=h[c];if(!s.box[p]){s.box[p]=!0;var f=4*p;if(t<=u[f+2]&&e<=u[f+3]&&i>=u[f+0]&&n>=u[f+1]){if(a.hitTest)return o.push(!0),!0;o.push(this.boxKeys[p])}}}var d=this.circleCells[r];if(null!==d)for(var m=this.circles,y=0,g=d;y<g.length;y+=1){var v=g[y];if(!s.circle[v]){s.circle[v]=!0;var _=3*v;if(this._circleAndRectCollide(m[_],m[_+1],m[_+2],t,e,i,n)){if(a.hitTest)return o.push(!0),!0;o.push(this.circleKeys[v])}}}},Es.prototype._queryCellCircle=function(t,e,i,n,r,o,a){var s=a.circle,l=a.seenUids,u=this.boxCells[r];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var f=p[h];if(!l.box[f]){l.box[f]=!0;var d=4*f;if(this._circleAndRectCollide(s.x,s.y,s.radius,c[d+0],c[d+1],c[d+2],c[d+3]))return o.push(!0),!0}}var m=this.circleCells[r];if(null!==m)for(var y=this.circles,g=0,v=m;g<v.length;g+=1){var _=v[g];if(!l.circle[_]){l.circle[_]=!0;var x=3*_;if(this._circlesCollide(y[x],y[x+1],y[x+2],s.x,s.y,s.radius))return o.push(!0),!0}}},Es.prototype._forEachCell=function(t,e,i,n,r,o,a){for(var s=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),c=this._convertToYCellCoord(n),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.xCellCount*p+h;if(r.call(this,t,e,i,n,f,o,a))return}},Es.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Es.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Es.prototype._circlesCollide=function(t,e,i,n,r,o){var a=n-t,s=r-e,l=i+o;return l*l>a*a+s*s},Es.prototype._circleAndRectCollide=function(t,e,i,n,r,o,a){var s=(o-n)/2,l=Math.abs(t-(n+s));if(l>s+i)return!1;var u=(a-r)/2,c=Math.abs(e-(r+u));if(c>u+i)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=i*i};var Is=t(function(t,e){var i;t.exports=((i=new Float32Array(3))[0]=0,i[1]=0,i[2]=0,function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}(),{vec3:{transformMat3:function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t}},vec4:{transformMat4:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*s,t[1]=r*l+a*s,t[2]=n*-s+o*l,t[3]=r*-s+a*l,t},scale:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1];return t[0]=n*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,i){var n,r,o,a,s,l,u,c,h,p,f,d,m=i[0],y=i[1],g=i[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*g+e[12],t[13]=r*m+l*y+p*g+e[13],t[14]=o*m+u*y+f*g+e[14],t[15]=a*m+c*y+d*g+e[15]),t},scale:function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],g=e[14],v=e[15],_=i[0],x=i[1],b=i[2],w=i[3];return t[0]=_*n+x*s+b*h+w*m,t[1]=_*r+x*l+b*p+w*y,t[2]=_*o+x*u+b*f+w*g,t[3]=_*a+x*c+b*d+w*v,_=i[4],x=i[5],b=i[6],w=i[7],t[4]=_*n+x*s+b*h+w*m,t[5]=_*r+x*l+b*p+w*y,t[6]=_*o+x*u+b*f+w*g,t[7]=_*a+x*c+b*d+w*v,_=i[8],x=i[9],b=i[10],w=i[11],t[8]=_*n+x*s+b*h+w*m,t[9]=_*r+x*l+b*p+w*y,t[10]=_*o+x*u+b*f+w*g,t[11]=_*a+x*c+b*d+w*v,_=i[12],x=i[13],b=i[14],w=i[15],t[12]=_*n+x*s+b*h+w*m,t[13]=_*r+x*l+b*p+w*y,t[14]=_*o+x*u+b*f+w*g,t[15]=_*a+x*c+b*d+w*v,t},perspective:function(t,e,i,n,r){var o=1/Math.tan(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t},rotateX:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=a*r+c*n,t[6]=s*r+h*n,t[7]=l*r+p*n,t[8]=u*r-o*n,t[9]=c*r-a*n,t[10]=h*r-s*n,t[11]=p*r-l*n,t},rotateZ:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=a*r+c*n,t[2]=s*r+h*n,t[3]=l*r+p*n,t[4]=u*r-o*n,t[5]=c*r-a*n,t[6]=h*r-s*n,t[7]=p*r-l*n,t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],g=e[15],v=i*s-n*a,_=i*l-r*a,x=i*u-o*a,b=n*l-r*s,w=n*u-o*s,T=r*u-o*l,S=c*m-h*d,z=c*y-p*d,A=c*g-f*d,k=h*y-p*m,E=h*g-f*m,I=p*g-f*y,M=v*I-_*E+x*k+b*A-w*z+T*S;return M?(M=1/M,t[0]=(s*I-l*E+u*k)*M,t[1]=(r*E-n*I-o*k)*M,t[2]=(m*T-y*w+g*b)*M,t[3]=(p*w-h*T-f*b)*M,t[4]=(l*A-a*I-u*z)*M,t[5]=(i*I-r*A+o*z)*M,t[6]=(y*x-d*T-g*_)*M,t[7]=(c*T-p*x+f*_)*M,t[8]=(a*E-s*A+u*S)*M,t[9]=(n*A-i*E-o*S)*M,t[10]=(d*w-m*x+g*v)*M,t[11]=(h*x-c*w-f*v)*M,t[12]=(s*z-a*k-l*S)*M,t[13]=(i*k-n*z+r*S)*M,t[14]=(m*_-d*b-y*v)*M,t[15]=(c*b-h*_+p*v)*M,t):null},ortho:function(t,e,i,n,r,o,a){var s=1/(e-i),l=1/(n-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(a+o)*u,t[15]=1,t}}})}),Ms=(Is.vec3,Is.vec4),Cs=(Is.mat2,Is.mat3,Is.mat4),Ps={horizontal:1,vertical:2,horizontalOnly:3};function Ls(t,e,i,n,r,o,a,s,l,u){var c=t.trim();u===Ps.vertical&&(c=function(t){for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;n&&Eo(n)&&!Io[t[i+1]]||r&&Eo(r)&&!Io[t[i-1]]||!Io[t[i]]?e+=t[i]:e+=Io[t[i]]}return e}(c));var h=[],p={positionedGlyphs:h,text:c,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:u},f=bo.processBidirectionalText;return function(t,e,i,n,r,o,a,s,l){for(var u=0,c=-17,h=0,p=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,d=0,m=i;d<m.length;d+=1){var y=m[d];if((y=y.trim()).length){for(var g=p.length,v=0;v<y.length;v++){var _=y.charCodeAt(v),x=e[_];x&&(ko(_)&&a!==Ps.horizontal?(p.push({glyph:_,x:u,y:0,vertical:!0}),u+=l+s):(p.push({glyph:_,x:u,y:c,vertical:!1}),u+=x.metrics.advance+s))}if(p.length!==g){var b=u-s;h=Math.max(b,h),Ns(p,e,g,p.length-1,f)}u=0,c+=n}else c+=n}var w=Vs(r),T=w.horizontalAlign,S=w.verticalAlign;!function(t,e,i,n,r,o,a){for(var s=(e-i)*r,l=(-n*a+.5)*o,u=0;u<t.length;u++)t[u].x+=s,t[u].y+=l}(p,f,T,S,h,n,i.length);var z=i.length*n;t.top+=-S*z,t.bottom=t.top+z,t.left+=-T*h,t.right=t.left+h}(p,e,f?f(c,js(c,a,i,e)):function(t,e){for(var i=[],n=0,r=0,o=e;r<o.length;r+=1){var a=o[r];i.push(t.substring(n,a)),n=a}return n<t.length&&i.push(t.substring(n,t.length)),i}(c,js(c,a,i,e)),n,r,o,u,a,l),!!h.length&&p}var Ds={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rs={};function Bs(t,e,i,n){var r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function Os(t,e){var i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Fs(t,e,i,n,r,o){for(var a=null,s=Bs(e,i,r,o),l=0,u=n;l<u.length;l+=1){var c=u[l],h=Bs(e-c.x,i,r,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function js(t,e,i,n){if(!i)return[];if(!t)return[];for(var r,o=[],a=function(t,e,i,n){for(var r=0,o=0;o<t.length;o++){var a=n[t.charCodeAt(o)];a&&(r+=a.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/i))}(t,e,i,n),s=0,l=0;l<t.length;l++){var u=t.charCodeAt(l),c=n[u];c&&!Ds[u]&&(s+=c.metrics.advance+e),l<t.length-1&&(Rs[u]||!((r=u)<11904)&&(To["Bopomofo Extended"](r)||To.Bopomofo(r)||To["CJK Compatibility Forms"](r)||To["CJK Compatibility Ideographs"](r)||To["CJK Compatibility"](r)||To["CJK Radicals Supplement"](r)||To["CJK Strokes"](r)||To["CJK Symbols and Punctuation"](r)||To["CJK Unified Ideographs Extension A"](r)||To["CJK Unified Ideographs"](r)||To["Enclosed CJK Letters and Months"](r)||To["Halfwidth and Fullwidth Forms"](r)||To.Hiragana(r)||To["Ideographic Description Characters"](r)||To["Kangxi Radicals"](r)||To["Katakana Phonetic Extensions"](r)||To.Katakana(r)||To["Vertical Forms"](r)||To["Yi Radicals"](r)||To["Yi Syllables"](r)))&&o.push(Fs(l+1,s,a,o,Os(u,t.charCodeAt(l+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Fs(t.length,s,a,o,0,!0))}function Vs(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Ns(t,e,i,n,r){if(r){var o=e[t[n].glyph];if(o)for(var a=o.metrics.advance,s=(t[n].x+a)*r,l=i;l<=n;l++)t[l].x-=s}}function Us(t,e,i){var n=Vs(i),r=n.horizontalAlign,o=n.verticalAlign,a=e[0],s=e[1],l=a-t.displaySize[0]*r,u=l+t.displaySize[0],c=s-t.displaySize[1]*o;return{image:t,top:c,bottom:c+t.displaySize[1],left:l,right:u}}Rs[10]=!0,Rs[32]=!0,Rs[38]=!0,Rs[40]=!0,Rs[41]=!0,Rs[43]=!0,Rs[45]=!0,Rs[47]=!0,Rs[173]=!0,Rs[183]=!0,Rs[8203]=!0,Rs[8208]=!0,Rs[8211]=!0,Rs[8231]=!0;var qs=No.layout,Zs={updateLineLabels:function(t,e,i,n,r,o,a,s){var l=n?t.textSizeData:t.iconSizeData,u=Co.evaluateSizeForZoom(l,i.transform.zoom,qs.properties[n?"text-size":"icon-size"]),h=[256/i.width*2+1,256/i.height*2+1],p=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;p.clear();for(var f=t.lineVertexArray,d=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,m=i.transform.width/i.transform.height,y=!1,g=0;g<d.length;g++){var v=d.get(g);if(v.hidden||v.writingMode===Ps.vertical&&!y)Qs(v.numGlyphs,p);else{y=!1;var _=[v.anchorX,v.anchorY,0,1];if(Ms.transformMat4(_,_,e),Ws(_,h)){var x=_[3],b=.5+x/i.transform.cameraToCenterDistance*.5,w=Co.evaluateSizeForFeature(l,u,v),T=a?w*b:w/b,S=new c(v.anchorX,v.anchorY),z=Gs(S,r).point,A={},k=Ks(v,T,!1,s,e,r,o,t.glyphOffsetArray,f,p,z,S,A,m);y=k.useVertical,(k.notEnoughRoom||y||k.needsFlipping&&Ks(v,T,!0,s,e,r,o,t.glyphOffsetArray,f,p,z,S,A,m).notEnoughRoom)&&Qs(v.numGlyphs,p)}else Qs(v.numGlyphs,p)}}n?t.text.dynamicLayoutVertexBuffer.updateData(p):t.icon.dynamicLayoutVertexBuffer.updateData(p)},getLabelPlaneMatrix:function(t,e,i,n,r){var o=Cs.identity(new Float32Array(16));e?(Cs.identity(o),Cs.scale(o,o,[1/r,1/r,1]),i||Cs.rotateZ(o,o,n.angle)):(Cs.scale(o,o,[n.width/2,-n.height/2,1]),Cs.translate(o,o,[1,-1,0]),Cs.multiply(o,o,t));return o},getGlCoordMatrix:function(t,e,i,n,r){var o=Cs.identity(new Float32Array(16));e?(Cs.multiply(o,o,t),Cs.scale(o,o,[r,r,1]),i||Cs.rotateZ(o,o,-n.angle)):(Cs.scale(o,o,[1,-1,1]),Cs.translate(o,o,[-1,-1,0]),Cs.scale(o,o,[2/n.width,2/n.height,1]));return o},project:Gs,placeFirstAndLastGlyph:Xs,xyTransformMat4:tl};function Gs(t,e){var i=[t.x,t.y,0,1];tl(i,i,e);var n=i[3];return{point:new c(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function Ws(t,e){var i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function Xs(t,e,i,n,r,o,a,s,l,u,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(p-1),g=Ys(t*m,i,n,r,o,a,s.segment,f,d,l,u,c,h);if(!g)return null;var v=Ys(t*y,i,n,r,o,a,s.segment,f,d,l,u,c,h);return v?{first:g,last:v}:null}function Hs(t,e,i,n){if(t===Ps.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*n)return{useVertical:!0};return(t===Ps.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function Ks(t,e,i,n,r,o,a,s,l,u,h,p,f,d){var m,y=e/24,g=t.lineOffsetX*e,v=t.lineOffsetY*e;if(t.numGlyphs>1){var _=t.glyphStartIndex+t.numGlyphs,x=t.lineStartIndex,b=t.lineStartIndex+t.lineLength,w=Xs(y,s,g,v,i,h,p,t,l,o,f,!1);if(!w)return{notEnoughRoom:!0};var T=Gs(w.first.point,a).point,S=Gs(w.last.point,a).point;if(n&&!i){var z=Hs(t.writingMode,T,S,d);if(z)return z}m=[w.first];for(var A=t.glyphStartIndex+1;A<_-1;A++)m.push(Ys(y*s.getoffsetX(A),g,v,i,h,p,t.segment,x,b,l,o,f,!1));m.push(w.last)}else{if(n&&!i){var k=Gs(p,r).point,E=t.lineStartIndex+t.segment+1,I=new c(l.getx(E),l.gety(E)),M=Gs(I,r),C=M.signedDistanceFromCamera>0?M.point:Js(p,I,k,1,r),P=Hs(t.writingMode,k,C,d);if(P)return P}var L=Ys(y*s.getoffsetX(t.glyphStartIndex),g,v,i,h,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,o,f,!1);if(!L)return{notEnoughRoom:!0};m=[L]}for(var D=0,R=m;D<R.length;D+=1){var B=R[D];Bo(u,B.point,B.angle)}return{}}function Js(t,e,i,n,r){var o=Gs(t.add(t.sub(e)._unit()),r).point,a=i.sub(o);return i.add(a._mult(n/a.mag()))}function Ys(t,e,i,n,r,o,a,s,l,u,h,p,f){var d=n?t-e:t+e,m=d>0?1:-1,y=0;n&&(m*=-1,y=Math.PI),m<0&&(y+=Math.PI);for(var g=m>0?s+a:s+a+1,v=g,_=r,x=r,b=0,w=0,T=Math.abs(d);b+w<=T;){if((g+=m)<s||g>=l)return null;if(x=_,void 0===(_=p[g])){var S=new c(u.getx(g),u.gety(g)),z=Gs(S,h);if(z.signedDistanceFromCamera>0)_=p[g]=z.point;else{var A=g-m;_=Js(0===b?o:new c(u.getx(A),u.gety(A)),S,x,T-b+1,h)}}b+=w,w=x.dist(_)}var k=(T-b)/w,E=_.sub(x),I=E.mult(k)._add(x);return I._add(E._unit()._perp()._mult(i*m)),{point:I,angle:y+Math.atan2(_.y-x.y,_.x-x.x),tileDistance:f?{prevTileDistance:g-m===v?0:u.gettileUnitDistanceFromAnchor(g-m),lastSegmentViewportDistance:T-b}:null}}var $s=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qs(t,e){for(var i=0;i<t;i++){var n=e.length;e.resize(n+4),e.float32.set($s,3*n)}}function tl(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}Is.mat4;var el=function(t,e,i){void 0===e&&(e=new Es(t.width+200,t.height+200,25)),void 0===i&&(i=new Es(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100};function il(t,e,i){t[e+4]=i?1:0}el.prototype.placeCollisionBox=function(t,e,i,n){var r=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),o=i*r.perspectiveRatio,a=t.x1*o+r.point.x,s=t.y1*o+r.point.y,l=t.x2*o+r.point.x,u=t.y2*o+r.point.y;return!e&&this.grid.hitTest(a,s,l,u)?{box:[],offscreen:!1}:{box:[a,s,l,u],offscreen:this.isOffscreen(a,s,l,u)}},el.prototype.approximateTileDistance=function(t,e,i,n,r){var o=r?1:n/this.pitchfactor,a=t.lastSegmentViewportDistance*i;return t.prevTileDistance+a+(o-1)*a*Math.abs(Math.sin(e))},el.prototype.placeCollisionCircles=function(t,e,i,n,r,o,a,s,l,u,h,p,f){var d=[],m=this.projectAnchor(u,o.anchorX,o.anchorY),y=l/24,g=o.lineOffsetX*l,v=o.lineOffsetY*l,_=new c(o.anchorX,o.anchorY),x=Zs.project(_,h).point,b=Zs.placeFirstAndLastGlyph(y,s,g,v,!1,x,_,o,a,h,{},!0),w=!1,T=!0,S=m.perspectiveRatio*n,z=1/(n*i),A=0,k=0;b&&(A=this.approximateTileDistance(b.first.tileDistance,b.first.angle,z,m.cameraDistance,f),k=this.approximateTileDistance(b.last.tileDistance,b.last.angle,z,m.cameraDistance,f));for(var E=0;E<t.length;E+=5){var I=t[E],M=t[E+1],C=t[E+2],P=t[E+3];if(!b||P<-A||P>k)il(t,E,!1);else{var L=this.projectPoint(u,I,M),D=C*S;if(d.length>0){var R=L.x-d[d.length-4],B=L.y-d[d.length-3];if(D*D*2>R*R+B*B)if(E+8<t.length){var O=t[E+8];if(O>-A&&O<k){il(t,E,!1);continue}}}var F=E/5;if(d.push(L.x,L.y,D,F),il(t,E,!0),T=T&&this.isOffscreen(L.x-D,L.y-D,L.x+D,L.y+D),!e&&this.grid.hitTestCircle(L.x,L.y,D)){if(!p)return{circles:[],offscreen:!1};w=!0}}}return{circles:w?[]:d,offscreen:T}},el.prototype.queryRenderedSymbols=function(t,e,i,n,r,o){var a={},s=[];if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return s;for(var l=this.transform.calculatePosMatrix(e.toUnwrapped()),u=[],h=1/0,p=1/0,f=-1/0,d=-1/0,m=0;m<t.length;m++)for(var y=t[m],g=0;g<y.length;g++){var v=this.projectPoint(l,y[g].x,y[g].y);h=Math.min(h,v.x),p=Math.min(p,v.y),f=Math.max(f,v.x),d=Math.max(d,v.y),u.push(v)}for(var _=e.key,x=[],b=this.grid.query(h,p,f,d),w=0;w<b.length;w++)b[w].sourceID===r&&b[w].tileID===_&&o[b[w].bucketInstanceId]&&x.push(b[w].boxIndex);for(var T=this.ignoredGrid.query(h,p,f,d),S=0;S<T.length;S++)T[S].sourceID===r&&T[S].tileID===_&&o[T[S].bucketInstanceId]&&x.push(T[S].boxIndex);for(var z=0;z<x.length;z++){var A=n.get(x[z]),k=A.sourceLayerIndex,E=A.featureIndex,I=A.bucketIndex;if(void 0===a[k]&&(a[k]={}),void 0===a[k][E]&&(a[k][E]={}),!a[k][E][I]){var M=this.projectAndGetPerspectiveRatio(l,A.anchorPointX,A.anchorPointY),C=i*M.perspectiveRatio,P=A.x1*C+M.point.x,L=A.y1*C+M.point.y,D=A.x2*C+M.point.x,R=A.y2*C+M.point.y,B=[new c(P,L),new c(D,L),new c(D,R),new c(P,R)];An.polygonIntersectsPolygon(u,B)&&(a[k][E][I]=!0,s.push(x[z]))}}return s},el.prototype.insertCollisionBox=function(t,e,i,n,r,o){var a={tileID:i,sourceID:n,bucketInstanceId:r,boxIndex:o};(e?this.ignoredGrid:this.grid).insert(a,t[0],t[1],t[2],t[3])},el.prototype.insertCollisionCircles=function(t,e,i,n,r,o){for(var a=e?this.ignoredGrid:this.grid,s=0;s<t.length;s+=4){var l={tileID:i,sourceID:n,bucketInstanceId:r,boxIndex:o+t[s+3]};a.insertCircle(l,t[s],t[s+1],t[s+2])}},el.prototype.projectAnchor=function(t,e,i){var n=[e,i,0,1];return Zs.xyTransformMat4(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},el.prototype.projectPoint=function(t,e,i){var n=[e,i,0,1];return Zs.xyTransformMat4(n,n,t),new c((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100)},el.prototype.projectAndGetPerspectiveRatio=function(t,e,i){var n=[e,i,0,1];return Zs.xyTransformMat4(n,n,t),{point:new c((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},el.prototype.isOffscreen=function(t,e,i,n){return i<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary};var nl=function(t,e){this.tileID=t,this.uid=w(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading"};nl.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<o.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},nl.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},nl.prototype.loadVectorData=function(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=t.collisionBoxArray,this.featureIndex=t.featureIndex,this.featureIndex.rawTileData=this.rawTileData,this.buckets=ws(t.buckets,e.style),i)for(var n in this.buckets){var r=this.buckets[n];r instanceof jo&&(r.justReloaded=!0)}t.iconAtlasImage&&(this.iconAtlasImage=t.iconAtlasImage),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Qi},nl.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.collisionBoxArray=null,this.featureIndex=null,this.state="unloaded"},nl.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},nl.prototype.getBucket=function(t){return this.buckets[t.id]},nl.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploaded||(i.upload(t),i.uploaded=!0)}var n=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new fa(t,this.iconAtlasImage,n.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fa(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},nl.prototype.queryRenderedFeatures=function(t,e,i,n,r,o,a){if(!this.featureIndex||!this.collisionBoxArray)return{};var s=0,l={};for(var u in t){var c=this.getBucket(t[u]);c&&(s=Math.max(s,t[u].queryRadius(c)),c instanceof jo&&void 0!==c.bucketInstanceId&&(l[c.bucketInstanceId]=!0))}return this.featureIndex.query({queryGeometry:e,scale:i,tileSize:this.tileSize,bearing:r,params:n,additionalRadius:s,collisionBoxArray:this.collisionBoxArray,sourceID:o,collisionIndex:a,bucketInstanceIds:l},t)},nl.prototype.querySourceFeatures=function(t,e){if(this.rawTileData){this.vtLayers||(this.vtLayers=new Kr.VectorTile(new ga(this.rawTileData)).layers);var i=e?e.sourceLayer:"",n=this.vtLayers._geojsonTileLayer||this.vtLayers[i];if(n)for(var r=Ge(e&&e.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},a=0;a<n.length;a++){var s=n.feature(a);if(r({zoom:this.tileID.overscaledZ},s)){var l=new Ss(s,o.z,o.x,o.y);l.tile=o,t.push(l)}}}},nl.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},nl.prototype.setMask=function(t,e){if(!p(this.mask,t)&&(this.mask=t,this.clearMask(),!p(t,{0:!0}))){var i=new Ri,n=new Hi;this.segments=new hn,this.segments.prepareSegment(0,i,n);for(var r=Object.keys(t),o=0;o<r.length;o++){var a=t[r[o]],s=xn>>a.z,l=new c(a.x*s,a.y*s),u=new c(l.x+s,l.y+s),h=this.segments.prepareSegment(4,i,n);i.emplaceBack(l.x,l.y,l.x,l.y),i.emplaceBack(u.x,l.y,u.x,l.y),i.emplaceBack(l.x,u.y,l.x,u.y),i.emplaceBack(u.x,u.y,u.x,u.y);var f=h.vertexLength;n.emplaceBack(f,f+1,f+2),n.emplaceBack(f+1,f+2,f+3),h.vertexLength+=4,h.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(i,fs.members),this.maskedIndexBuffer=e.createIndexBuffer(n)}},nl.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},nl.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,i,n,r){var o=n||r;return e[i]=!o||o.toLowerCase(),""}),e["max-age"]){var i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),r=!1;if(this.expirationTime>n)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},nl.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)};var rl=function(t,e){this.max=t,this.onRemove=e,this.reset()};rl.prototype.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},rl.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},rl.prototype.has=function(t){return t in this.data},rl.prototype.keys=function(){return this.order},rl.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},rl.prototype.get=function(t){return this.has(t)?this.data[t]:null},rl.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},rl.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this};var ol=function(t,e,i){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};ol.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null)},ol.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ol.prototype.updateData=function(t){var e=this.context.gl;this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},ol.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var al={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},sl=function(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};sl.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},sl.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},sl.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],r=e.attributes[n.name];void 0!==r&&t.enableVertexAttribArray(r)}},sl.prototype.setVertexAttribPointers=function(t,e,i){for(var n=0;n<this.attributes.length;n++){var r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[al[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}},sl.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var ll=function(t){this.context=t,this.current=ft.transparent};ll.prototype.get=function(){return this.current},ll.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t)};var ul=function(t){this.context=t,this.current=1};ul.prototype.get=function(){return this.current},ul.prototype.set=function(t){this.current!==t&&(this.context.gl.clearDepth(t),this.current=t)};var cl=function(t){this.context=t,this.current=0};cl.prototype.get=function(){return this.current},cl.prototype.set=function(t){this.current!==t&&(this.context.gl.clearStencil(t),this.current=t)};var hl=function(t){this.context=t,this.current=[!0,!0,!0,!0]};hl.prototype.get=function(){return this.current},hl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t)};var pl=function(t){this.context=t,this.current=!0};pl.prototype.get=function(){return this.current},pl.prototype.set=function(t){this.current!==t&&(this.context.gl.depthMask(t),this.current=t)};var fl=function(t){this.context=t,this.current=255};fl.prototype.get=function(){return this.current},fl.prototype.set=function(t){this.current!==t&&(this.context.gl.stencilMask(t),this.current=t)};var dl=function(t){this.context=t,this.current={func:t.gl.ALWAYS,ref:0,mask:255}};dl.prototype.get=function(){return this.current},dl.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t)};var ml=function(t){this.context=t;var e=this.context.gl;this.current=[e.KEEP,e.KEEP,e.KEEP]};ml.prototype.get=function(){return this.current},ml.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t)};var yl=function(t){this.context=t,this.current=!1};yl.prototype.get=function(){return this.current},yl.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t}};var gl=function(t){this.context=t,this.current=[0,1]};gl.prototype.get=function(){return this.current},gl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.depthRange(t[0],t[1]),this.current=t)};var vl=function(t){this.context=t,this.current=!1};vl.prototype.get=function(){return this.current},vl.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t}};var _l=function(t){this.context=t,this.current=t.gl.LESS};_l.prototype.get=function(){return this.current},_l.prototype.set=function(t){this.current!==t&&(this.context.gl.depthFunc(t),this.current=t)};var xl=function(t){this.context=t,this.current=!1};xl.prototype.get=function(){return this.current},xl.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t}};var bl=function(t){this.context=t;var e=this.context.gl;this.current=[e.ONE,e.ZERO]};bl.prototype.get=function(){return this.current},bl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.blendFunc(t[0],t[1]),this.current=t)};var wl=function(t){this.context=t,this.current=ft.transparent};wl.prototype.get=function(){return this.current},wl.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t)};var Tl=function(t){this.context=t,this.current=null};Tl.prototype.get=function(){return this.current},Tl.prototype.set=function(t){this.current!==t&&(this.context.gl.useProgram(t),this.current=t)};var Sl=function(t){this.context=t,this.current=1};Sl.prototype.get=function(){return this.current},Sl.prototype.set=function(t){var e=this.context.lineWidthRange,i=m(t,e[0],e[1]);this.current!==i&&(this.context.gl.lineWidth(i),this.current=t)};var zl=function(t){this.context=t,this.current=t.gl.TEXTURE0};zl.prototype.get=function(){return this.current},zl.prototype.set=function(t){this.current!==t&&(this.context.gl.activeTexture(t),this.current=t)};var Al=function(t){this.context=t;var e=this.context.gl;this.current=[0,0,e.drawingBufferWidth,e.drawingBufferHeight]};Al.prototype.get=function(){return this.current},Al.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t)};var kl=function(t){this.context=t,this.current=null};kl.prototype.get=function(){return this.current},kl.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t}};var El=function(t){this.context=t,this.current=null};El.prototype.get=function(){return this.current},El.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t}};var Il=function(t){this.context=t,this.current=null};Il.prototype.get=function(){return this.current},Il.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t}};var Ml=function(t){this.context=t,this.current=null};Ml.prototype.get=function(){return this.current},Ml.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t}};var Cl=function(t){this.context=t,this.current=null};Cl.prototype.get=function(){return this.current},Cl.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t};var Pl=function(t){this.context=t,this.current=null};Pl.prototype.get=function(){return this.current},Pl.prototype.set=function(t){this.current!==t&&this.context.extVertexArrayObject&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t)};var Ll=function(t){this.context=t,this.current=4};Ll.prototype.get=function(){return this.current},Ll.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t}};var Dl=function(t){this.context=t,this.current=!1};Dl.prototype.get=function(){return this.current},Dl.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t}};var Rl=function(t,e){this.context=t,this.current=null,this.parent=e};Rl.prototype.get=function(){return this.current};var Bl=function(t){function e(e,i){t.call(this,e,i),this.dirty=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e.prototype.setDirty=function(){this.dirty=!0},e}(Rl),Ol=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t}},e}(Rl),Fl=function(t,e,i){this.context=t,this.width=e,this.height=i;var n=t.gl,r=this.framebuffer=n.createFramebuffer();this.colorAttachment=new Bl(t,r),this.depthAttachment=new Ol(t,r)};Fl.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i),t.deleteFramebuffer(this.framebuffer)};var jl=function(t,e,i){this.func=t,this.mask=e,this.range=i};jl.ReadOnly=!1,jl.ReadWrite=!0,jl.disabled=new jl(519,jl.ReadOnly,[0,1]);var Vl=function(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o};Vl.disabled=new Vl({func:519,mask:0},0,0,7680,7680,7680);var Nl=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i};Nl.Replace=[1,0],Nl.disabled=new Nl(Nl.Replace,ft.transparent,[!1,!1,!1,!1]),Nl.unblended=new Nl(Nl.Replace,ft.transparent,[!0,!0,!0,!0]),Nl.alphaBlended=new Nl([1,771],ft.transparent,[!0,!0,!0,!0]);var Ul=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.clearColor=new ll(this),this.clearDepth=new ul(this),this.clearStencil=new cl(this),this.colorMask=new hl(this),this.depthMask=new pl(this),this.stencilMask=new fl(this),this.stencilFunc=new dl(this),this.stencilOp=new ml(this),this.stencilTest=new yl(this),this.depthRange=new gl(this),this.depthTest=new vl(this),this.depthFunc=new _l(this),this.blend=new xl(this),this.blendFunc=new bl(this),this.blendColor=new wl(this),this.program=new Tl(this),this.lineWidth=new Sl(this),this.activeTexture=new zl(this),this.viewport=new Al(this),this.bindFramebuffer=new kl(this),this.bindRenderbuffer=new El(this),this.bindTexture=new Il(this),this.bindVertexBuffer=new Ml(this),this.bindElementBuffer=new Cl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pl(this),this.pixelStoreUnpack=new Ll(this),this.pixelStoreUnpackPremultiplyAlpha=new Dl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};Ul.prototype.createIndexBuffer=function(t,e){return new ol(this,t,e)},Ul.prototype.createVertexBuffer=function(t,e,i){return new sl(this,t,e,i)},Ul.prototype.createRenderbuffer=function(t,e,i){var n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r},Ul.prototype.createFramebuffer=function(t,e){return new Fl(this,t,e)},Ul.prototype.clear=function(t){var e=t.color,i=t.depth,n=this.gl,r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(r|=n.DEPTH_BUFFER_BIT,this.clearDepth.set(i),this.depthMask.set(!0)),n.clear(r)},Ul.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Ul.prototype.setStencilMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Ul.prototype.setColorMode=function(t){p(t.blendFunction,Nl.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)};var ql=function(t){function e(e,i,n){var r=this;t.call(this),this.id=e,this.dispatcher=n,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(r._sourceLoaded=!0),r._sourceLoaded&&!r._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(r.reload(),r.transform&&r.update(r.transform))}),this.on("error",function(){r._sourceErrored=!0}),this._source=_s(e,i,n,this),this._tiles={},this._cache=new rl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},e.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},e.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._tiles)this._tiles[e].upload(t)},e.prototype.getIds=function(){var t=this;return Object.keys(this._tiles).map(Number).sort(function(e,i){var n=t._tiles[e].tileID,r=t._tiles[i].tileID,o=new c(n.canonical.x,n.canonical.y).rotate(t.transform.angle),a=new c(r.canonical.x,r.canonical.y).rotate(t.transform.angle);return n.overscaledZ-r.overscaledZ||a.y-o.y||a.x-o.x})},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0,{});return!!e&&this._isIdRenderable(e.tileID.key)},e.prototype._isIdRenderable=function(t){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._resetCache(),this._tiles)this._reloadTile(t,"reloading")},e.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))},e.prototype._tileLoaded=function(t,e,i,n){if(n)return t.state="errored",void(404!==n.status?this._source.fire("error",{tile:t,error:n}):this.update(this.transform));t.timeAdded=o.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._source.fire("data",{dataType:"source",tile:t,coord:t.tileID}),this.map&&(this.map.painter.tileExtentVAO.vao=null)},e.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),i=0;i<e.length;i++){var n=e[i];if(t.neighboringTiles&&t.neighboringTiles[n]){var r=this.getTileByID(n);o(t,r),o(r,t)}}function o(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},e.prototype.getTile=function(t){return this.getTileByID(t.key)},e.prototype.getTileByID=function(t){return this._tiles[t]},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype._findLoadedChildren=function(t,e,i){var n=!1;for(var r in this._tiles){var o=this._tiles[r];if(!(i[r]||!o.hasData()||o.tileID.overscaledZ<=t.overscaledZ||o.tileID.overscaledZ>e)){var a=Math.pow(2,o.tileID.canonical.z-t.canonical.z);if(Math.floor(o.tileID.canonical.x/a)===t.canonical.x&&Math.floor(o.tileID.canonical.y/a)===t.canonical.y)for(i[r]=o.tileID,n=!0;o&&o.tileID.overscaledZ-1>t.overscaledZ;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);if(!s)break;(o=this._tiles[s.key])&&o.hasData()&&(delete i[r],i[s.key]=s)}}}return n},e.prototype.findLoadedParent=function(t,e,i){for(var n=t.overscaledZ-1;n>=e;n--){var r=t.scaledTo(n);if(!r)return;var o=String(r.key),a=this._tiles[o];if(a&&a.hasData())return i[o]=r,a;if(this._cache.has(o))return i[o]=r,this._cache.get(o)}},e.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),i=Math.floor(5*e),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(n)},e.prototype.update=function(t){var i=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(t),this._coveredTiles={},this.used?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new us(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter(function(t){return i._source.hasTile(t)}))):n=[];var r,a=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),s=Math.max(a-e.maxOverzooming,this._source.minzoom),l=Math.max(a+e.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(n,a),c={};if(Gl(this._source.type))for(var h=Object.keys(u),p=0;p<h.length;p++){var f=h[p],d=u[f],m=i._tiles[f];if(m&&(void 0===m.fadeEndTime||m.fadeEndTime>=o.now())){i._findLoadedChildren(d,l,u)&&(u[f]=d);var y=i.findLoadedParent(d,s,c);y&&i._addTile(y.tileID)}}for(r in c)u[r]||(i._coveredTiles[r]=!0);for(r in c)u[r]=c[r];for(var g=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i}(this._tiles,u),v=0;v<g.length;v++)i._removeTile(g[v])}},e.prototype._updateRetainedTiles=function(t,i){for(var n={},r={},o=Math.max(i-e.maxOverzooming,this._source.minzoom),a=Math.max(i+e.maxUnderzooming,this._source.minzoom),s=0;s<t.length;s++){var l=t[s],u=this._addTile(l),c=!1;if(u.hasData())n[l.key]=l;else{c=u.wasRequested(),n[l.key]=l;var h=!0;if(i+1>this._source.maxzoom){var p=l.children(this._source.maxzoom)[0],f=this.getTile(p);f&&f.hasData()?n[p.key]=p:h=!1}else{this._findLoadedChildren(l,a,n);for(var d=l.children(this._source.maxzoom),m=0;m<d.length;m++)if(!n[d[m].key]){h=!1;break}}if(!h)for(var y=l.overscaledZ-1;y>=o;--y){var g=l.scaledTo(y);if(r[g.key])break;if(r[g.key]=!0,!(u=this.getTile(g))&&c&&(u=this._addTile(g)),u&&(n[g.key]=g,c=u.wasRequested(),u.hasData()))break}}}return n},e.prototype._addTile=function(t){var e=this._tiles[t.key];if(e)return e;(e=this._cache.getAndRemove(t.key))&&this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e));var i=Boolean(e);return i||(e=new nl(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire("dataloading",{tile:e,coord:e.tileID,dataType:"source"}),e):null},e.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){i._reloadTile(t,"expired"),delete i._timers[t]},n))},e.prototype._setCacheInvalidationTimer=function(t,e){var i=this;t in this._cacheTimers&&(clearTimeout(this._cacheTimers[t]),delete this._cacheTimers[t]);var n=e.getExpiryTimeout();n&&(this._cacheTimers[t]=setTimeout(function(){i._cache.remove(t),delete i._cacheTimers[t]},n))},e.prototype._removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),!(e.uses>0)))if(e.hasData()){e.tileID=e.tileID.wrapped();var i=e.tileID.key;this._cache.add(i,e),this._setCacheInvalidationTimer(i,e)}else e.aborted=!0,this._abortTile(e),this._unloadTile(e)},e.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._resetCache()},e.prototype._resetCache=function(){for(var t in this._cacheTimers)clearTimeout(this._cacheTimers[t]);this._cacheTimers={},this._cache.reset()},e.prototype.tilesIn=function(t){for(var e=[],i=this.getIds(),n=1/0,r=1/0,o=-1/0,a=-1/0,s=t[0].zoom,l=0;l<t.length;l++){var c=t[l];n=Math.min(n,c.column),r=Math.min(r,c.row),o=Math.max(o,c.column),a=Math.max(a,c.row)}for(var h=0;h<i.length;h++){var p=this._tiles[i[h]],f=p.tileID,d=[Zl(f,new u(n,r,s)),Zl(f,new u(o,a,s))];if(d[0].x<xn&&d[0].y<xn&&d[1].x>=0&&d[1].y>=0){for(var m=[],y=0;y<t.length;y++)m.push(Zl(f,t[y]));e.push({tile:p,tileID:f,queryGeometry:[m],scale:Math.pow(2,this.transform.zoom-p.tileID.overscaledZ)})}}return e},e.prototype.getVisibleCoordinates=function(){for(var t=this,e=this.getRenderableIds().map(function(e){return t._tiles[e].tileID}),i=0,n=e;i<n.length;i+=1){var r=n[i];r.posMatrix=t.transform.calculatePosMatrix(r.toUnwrapped())}return e},e.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Gl(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=o.now())return!0}return!1},e}(H);function Zl(t,e){var i=e.zoomTo(t.canonical.z);return new c((i.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*xn,(i.row-t.canonical.y)*xn)}function Gl(t){return"raster"===t||"image"===t||"video"===t}function Wl(){return new self.Worker(ef.workerUrl)}ql.maxOverzooming=10,ql.maxUnderzooming=3;var Xl,Hl=function(){this.active={}};Hl.prototype.acquire=function(t){if(!this.workers){var e=ef.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new Wl)}return this.active[t]=!0,this.workers.slice()},Hl.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var Kl=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jl(t,e){var i={};for(var n in t)"ref"!==n&&(i[n]=t[n]);return Kl.forEach(function(t){t in e&&(i[t]=e[t])}),i}function Yl(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Jl(t[n],e[t[n].ref]));return t}var $l={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ql(t,e,i){i.push({command:$l.addSource,args:[t,e[t]]})}function tu(t,e,i){e.push({command:$l.removeSource,args:[t]}),i[t]=!0}function eu(t,e,i,n){tu(t,i,n),Ql(t,e,i)}function iu(t,e,i){var n;for(n in t[i])if(t[i].hasOwnProperty(n)&&"data"!==n&&!p(t[i][n],e[i][n]))return!1;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!p(t[i][n],e[i][n]))return!1;return!0}function nu(t,e,i,n,r,o){var a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(p(t[a],e[a])||i.push({command:o,args:[n,a,e[a],r]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(p(t[a],e[a])||i.push({command:o,args:[n,a,e[a],r]}))}function ru(t){return t.id}function ou(t,e){return t[e.id]=e,t}function au(t,e){if(!t)return[{command:$l.setStyle,args:[e]}];var i=[];try{if(!p(t.version,e.version))return[{command:$l.setStyle,args:[e]}];p(t.center,e.center)||i.push({command:$l.setCenter,args:[e.center]}),p(t.zoom,e.zoom)||i.push({command:$l.setZoom,args:[e.zoom]}),p(t.bearing,e.bearing)||i.push({command:$l.setBearing,args:[e.bearing]}),p(t.pitch,e.pitch)||i.push({command:$l.setPitch,args:[e.pitch]}),p(t.sprite,e.sprite)||i.push({command:$l.setSprite,args:[e.sprite]}),p(t.glyphs,e.glyphs)||i.push({command:$l.setGlyphs,args:[e.glyphs]}),p(t.transition,e.transition)||i.push({command:$l.setTransition,args:[e.transition]}),p(t.light,e.light)||i.push({command:$l.setLight,args:[e.light]});var n={},r=[];!function(t,e,i,n){var r;for(r in e=e||{},t=t||{})t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||tu(r,i,n));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?p(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&iu(t,e,r)?i.push({command:$l.setGeoJSONSourceData,args:[r,e[r].data]}):eu(r,e,i,n)):Ql(r,e,i))}(t.sources,e.sources,r,n);var o=[];t.layers&&t.layers.forEach(function(t){n[t.source]?i.push({command:$l.removeLayer,args:[t.id]}):o.push(t)}),i=i.concat(r),function(t,e,i){e=e||[];var n,r,o,a,s,l,u,c=(t=t||[]).map(ru),h=e.map(ru),f=t.reduce(ou,{}),d=e.reduce(ou,{}),m=c.slice(),y=Object.create(null);for(n=0,r=0;n<c.length;n++)o=c[n],d.hasOwnProperty(o)?r++:(i.push({command:$l.removeLayer,args:[o]}),m.splice(m.indexOf(o,r),1));for(n=0,r=0;n<h.length;n++)o=h[h.length-1-n],m[m.length-1-n]!==o&&(f.hasOwnProperty(o)?(i.push({command:$l.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-r),1)):r++,l=m[m.length-n],i.push({command:$l.addLayer,args:[d[o],l]}),m.splice(m.length-n,0,o),y[o]=!0);for(n=0;n<h.length;n++)if(a=f[o=h[n]],s=d[o],!y[o]&&!p(a,s))if(p(a.source,s.source)&&p(a["source-layer"],s["source-layer"])&&p(a.type,s.type)){for(u in nu(a.layout,s.layout,i,o,null,$l.setLayoutProperty),nu(a.paint,s.paint,i,o,null,$l.setPaintProperty),p(a.filter,s.filter)||i.push({command:$l.setFilter,args:[o,s.filter]}),p(a.minzoom,s.minzoom)&&p(a.maxzoom,s.maxzoom)||i.push({command:$l.setLayerZoomRange,args:[o,s.minzoom,s.maxzoom]}),a)a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?nu(a[u],s[u],i,o,u.slice(6),$l.setPaintProperty):p(a[u],s[u])||i.push({command:$l.setLayerProperty,args:[o,u,s[u]]}));for(u in s)s.hasOwnProperty(u)&&!a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?nu(a[u],s[u],i,o,u.slice(6),$l.setPaintProperty):p(a[u],s[u])||i.push({command:$l.setLayerProperty,args:[o,u,s[u]]}))}else i.push({command:$l.removeLayer,args:[o]}),l=m[m.lastIndexOf(o)+1],i.push({command:$l.addLayer,args:[s,l]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:$l.setStyle,args:[e]}]}return i}function su(t,e,i){return e*(xn/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}var lu=No.layout,uu=function(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i};uu.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var cu=function(t,e,i,n,r){this.text=new uu(t?t.text:null,e,i,r),this.icon=new uu(t?t.icon:null,e,n,r)};cu.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var hu=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},pu=function(t,e){this.transform=t.clone(),this.collisionIndex=new el(this.transform),this.recentUntil=-1/0,this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=e};function fu(t,e,i){t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0)}pu.prototype.placeLayerTile=function(t,e,i,n){var r=e.getBucket(t);if(r){var o=r.layers[0].layout,a=Math.pow(2,this.transform.zoom-e.tileID.overscaledZ),s=e.tileSize/xn,l=this.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u=Zs.getLabelPlaneMatrix(l,"map"===o.get("text-pitch-alignment"),"map"===o.get("text-rotation-alignment"),this.transform,su(e,1,this.transform.zoom)),c=Zs.getLabelPlaneMatrix(l,"map"===o.get("icon-pitch-alignment"),"map"===o.get("icon-rotation-alignment"),this.transform,su(e,1,this.transform.zoom));this.placeLayerBucket(r,l,u,c,a,s,i,n,e.collisionBoxArray,e.tileID.key,t.source)}},pu.prototype.placeLayerBucket=function(t,e,i,n,r,o,a,s,l,u,c){for(var h=t.layers[0].layout,p=Co.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,lu.properties["text-size"]),f=!t.hasTextData()||h.get("text-optional"),d=!t.hasIconData()||h.get("icon-optional"),m=0,y=t.symbolInstances;m<y.length;m+=1){var g=y[m];if(!s[g.crossTileID]){var v=!1,_=!1,x=!0,b=null,w=null,T=null;g.collisionArrays||(g.collisionArrays=t.deserializeCollisionBoxes(l,g.textBoxStartIndex,g.textBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex)),g.collisionArrays.textBox&&(v=(b=this.collisionIndex.placeCollisionBox(g.collisionArrays.textBox,h.get("text-allow-overlap"),o,e)).box.length>0,x=x&&b.offscreen);var S=g.collisionArrays.textCircles;if(S){var z=t.text.placedSymbolArray.get(g.placedTextSymbolIndices[0]),A=Co.evaluateSizeForFeature(t.textSizeData,p,z);w=this.collisionIndex.placeCollisionCircles(S,h.get("text-allow-overlap"),r,o,g.key,z,t.lineVertexArray,t.glyphOffsetArray,A,e,i,a,"map"===h.get("text-pitch-alignment")),v=h.get("text-allow-overlap")||w.circles.length>0,x=x&&w.offscreen}g.collisionArrays.iconBox&&(_=(T=this.collisionIndex.placeCollisionBox(g.collisionArrays.iconBox,h.get("icon-allow-overlap"),o,e)).box.length>0,x=x&&T.offscreen),f||d?d?f||(_=_&&v):v=_&&v:_=v=_&&v,v&&b&&this.collisionIndex.insertCollisionBox(b.box,h.get("text-ignore-placement"),u,c,t.bucketInstanceId,g.textBoxStartIndex),_&&T&&this.collisionIndex.insertCollisionBox(T.box,h.get("icon-ignore-placement"),u,c,t.bucketInstanceId,g.iconBoxStartIndex),v&&w&&this.collisionIndex.insertCollisionCircles(w.circles,h.get("text-ignore-placement"),u,c,t.bucketInstanceId,g.textBoxStartIndex),this.placements[g.crossTileID]=new hu(v,_,x||t.justReloaded),s[g.crossTileID]=!0}}t.justReloaded=!1},pu.prototype.commit=function(t,e){this.commitTime=e;var i=!1,n=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,r=t?t.opacities:{};for(var o in this.placements){var a=this.placements[o],s=r[o];s?(this.opacities[o]=new cu(s,n,a.text,a.icon),i=i||a.text!==s.text.placed||a.icon!==s.icon.placed):(this.opacities[o]=new cu(null,n,a.text,a.icon,a.skipFade),i=i||a.text||a.icon)}for(var l in r){var u=r[l];if(!this.opacities[l]){var c=new cu(u,n,!1,!1);c.isHidden()||(this.opacities[l]=c,i=i||u.text.placed||u.icon.placed)}}return i},pu.prototype.updateLayerOpacities=function(t,e){for(var i={},n=0,r=e;n<r.length;n+=1){var o=r[n],a=o.getBucket(t);a&&this.updateBucketOpacities(a,i,o.collisionBoxArray)}},pu.prototype.updateBucketOpacities=function(t,e,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var n=t.layers[0].layout,r=new cu(null,0,n.get("text-allow-overlap"),n.get("icon-allow-overlap"),!0),o=0;o<t.symbolInstances.length;o++){var a=t.symbolInstances[o],s=e[a.crossTileID],l=this.opacities[a.crossTileID];l?s&&(l=r):(l=r,this.opacities[a.crossTileID]=l),e[a.crossTileID]=!0;var u=a.numGlyphVertices>0||a.numVerticalGlyphVertices>0,c=a.numIconVertices>0;if(u){for(var h=bu(l.text),p=(a.numGlyphVertices+a.numVerticalGlyphVertices)/4,f=0;f<p;f++)t.text.opacityVertexArray.emplaceBack(h);for(var d=0,m=a.placedTextSymbolIndices;d<m.length;d+=1){var y=m[d];t.text.placedSymbolArray.get(y).hidden=l.text.isHidden()}}if(c){for(var g=bu(l.icon),v=0;v<a.numIconVertices/4;v++)t.icon.opacityVertexArray.emplaceBack(g);t.icon.placedSymbolArray.get(o).hidden=l.icon.isHidden()}a.collisionArrays||(a.collisionArrays=t.deserializeCollisionBoxes(i,a.textBoxStartIndex,a.textBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex));var _=a.collisionArrays;if(_){_.textBox&&t.hasCollisionBoxData()&&fu(t.collisionBox.collisionVertexArray,l.text.placed,!1),_.iconBox&&t.hasCollisionBoxData()&&fu(t.collisionBox.collisionVertexArray,l.icon.placed,!1);var x=_.textCircles;if(x&&t.hasCollisionCircleData())for(var b=0;b<x.length;b+=5){var w=s||0===x[b+4];fu(t.collisionCircle.collisionVertexArray,l.text.placed,w)}}}t.sortFeatures(this.transform.angle),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray)},pu.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},pu.prototype.hasTransitions=function(t){return this.symbolFadeChange(t)<1||this.stale},pu.prototype.stillRecent=function(t){return this.recentUntil>t},pu.prototype.setRecent=function(t,e){this.stale=e,this.recentUntil=t+this.fadeDuration},pu.prototype.setStale=function(){this.stale=!0};var du=Math.pow(2,25),mu=Math.pow(2,24),yu=Math.pow(2,17),gu=Math.pow(2,16),vu=Math.pow(2,9),_u=Math.pow(2,8),xu=Math.pow(2,1);function bu(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*du+e*mu+i*yu+e*gu+i*vu+e*_u+i*xu+e}var wu=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};wu.prototype.continuePlacement=function(t,e,i,n,r){for(;this._currentTileIndex<t.length;){var o=t[this._currentTileIndex];if(e.placeLayerTile(n,o,i,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};var Tu=function(t,e,i,n,r){this.placement=new pu(t,r),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1};Tu.prototype.isDone=function(){return this._done},Tu.prototype.continuePlacement=function(t,e,i){for(var n=this,r=o.now(),a=function(){var t=o.now()-r;return!n._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=e[t[n._currentPlacementIndex]],l=n.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(n._inProgressLayer||(n._inProgressLayer=new wu),n._inProgressLayer.continuePlacement(i[s.source],n.placement,n._showCollisionBoxes,s,a))return;delete n._inProgressLayer}n._currentPlacementIndex--}this._done=!0};var Su=512/xn/2,zu=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var n=0,r=e;n<r.length;n+=1){var o=r[n],a=o.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:o.crossTileID,coord:this.getScaledCoordinates(o,t)})}};zu.prototype.getScaledCoordinates=function(t,e){var i=e.canonical.z-this.tileID.canonical.z,n=Su/Math.pow(2,i),r=t.anchor;return{x:Math.floor((e.canonical.x*xn+r.x)*n),y:Math.floor((e.canonical.y*xn+r.y)*n)}},zu.prototype.findMatches=function(t,e,i){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0,o=t;r<o.length;r+=1){var a=o[r];if(!a.crossTileID){var s=this.indexedSymbolInstances[a.key];if(s)for(var l=this.getScaledCoordinates(a,e),u=0,c=s;u<c.length;u+=1){var h=c[u];if(Math.abs(h.coord.x-l.x)<=n&&Math.abs(h.coord.y-l.y)<=n&&!i[h.crossTileID]){i[h.crossTileID]=!0,a.crossTileID=h.crossTileID;break}}}}};var Au=function(){this.maxCrossTileID=0};Au.prototype.generate=function(){return++this.maxCrossTileID};var ku=function(){this.indexes={},this.usedCrossTileIDs={}};ku.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0,r=e.symbolInstances;n<r.length;n+=1){r[n].crossTileID=0}this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var o=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var s=this.indexes[a];if(Number(a)>t.overscaledZ)for(var l in s){var u=s[l];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,o)}else{var c=s[t.scaledTo(Number(a)).key];c&&c.findMatches(e.symbolInstances,t,o)}}for(var h=0,p=e.symbolInstances;h<p.length;h+=1){var f=p[h];f.crossTileID||(f.crossTileID=i.generate(),o[f.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new zu(t,e.symbolInstances,e.bucketInstanceId),!0},ku.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var n=0,r=e.indexedSymbolInstances[i];n<r.length;n+=1){var o=r[n];delete this.usedCrossTileIDs[t][o.crossTileID]}},ku.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var n=this.indexes[i];for(var r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e};var Eu=function(){this.layerIndexes={},this.crossTileIDs=new Au,this.maxBucketInstanceId=0};Eu.prototype.addLayer=function(t,e){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new ku);for(var n=!1,r={},o=0,a=e;o<a.length;o+=1){var s=a[o],l=s.getBucket(t);l&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(s.tileID,l,this.crossTileIDs)&&(n=!0),r[l.bucketInstanceId]=!0)}return i.removeStaleBuckets(r)&&(n=!0),n},Eu.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[i]||delete this.layerIndexes[i]};var Iu=x($l,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Mu=x($l,["setCenter","setZoom","setBearing","setPitch"]),Cu=function(t){function e(e,i){var n=this;void 0===i&&(i={}),t.call(this),this.map=e,this.dispatcher=new Ya((Xl||(Xl=new Hl),Xl),this),this.imageManager=new da,this.glyphManager=new Ga(e._transformRequest,i.localIdeographFontFamily),this.lineAtlas=new Ka(256,512),this.crossTileSymbolIndex=new Eu,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new oo,this._loaded=!1,this._resetUpdates();var r=this;this._rtlTextPluginCallback=xo(function(t){for(var e in r.dispatcher.broadcast("loadRTLTextPlugin",t.pluginBlobURL,t.errorCallback),r.sourceCaches)r.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=n.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var r in n._layers){var o=n._layers[r];o.source===i.id&&n._validateLayer(o)}}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.loadURL=function(t,e){var i=this;void 0===e&&(e={}),this.fire("dataloading",{dataType:"style"});var n="boolean"==typeof e.validate?e.validate:!Yo(t);t=function(t,e){if(!Yo(t))return t;var i=ra(t);return i.path="/styles/v1"+i.path,Jo(i,e)}(t,e.accessToken);var r=this.map._transformRequest(t,V.Style);q(r,function(t,e){t?i.fire("error",{error:t}):e&&i._load(e,n)})},e.prototype.loadJSON=function(t,e){var i=this;void 0===e&&(e={}),this.fire("dataloading",{dataType:"style"}),o.frame(function(){i._load(t,!1!==e.validate)})},e.prototype._load=function(t,e){var i=this;if(!e||!ii.emitErrors(this,ii(t))){for(var n in this._loaded=!0,this.stylesheet=t,t.sources)i.addSource(n,t.sources[n],{validate:!1});t.sprite?function(t,e,i){var n,r,a,s=o.devicePixelRatio>1?"@2x":"";function l(){if(a)i(a);else if(n&&r){var t=o.getImageData(r),e={};for(var s in n){var l=n[s],u=l.width,c=l.height,h=l.x,p=l.y,f=l.sdf,d=l.pixelRatio,m=new Xn({width:u,height:c});Xn.copy(t,m,{x:h,y:p},{x:0,y:0},{width:u,height:c}),e[s]={data:m,pixelRatio:d,sdf:f}}i(null,e)}}q(e(ta(t,s,".json"),V.SpriteJSON),function(t,e){a||(a=t,n=e,l())}),G(e(ta(t,s,".png"),V.SpriteImage),function(t,e){a||(a=t,r=e,l())})}(t.sprite,this.map._transformRequest,function(t,e){if(t)i.fire("error",t);else if(e)for(var n in e)i.imageManager.addImage(n,e[n]);i.imageManager.setLoaded(!0),i.fire("data",{dataType:"style"})}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var r=Yl(this.stylesheet.layers);this._order=r.map(function(t){return t.id}),this._layers={};for(var a=0,s=r;a<s.length;a+=1){var l=s[a];(l=Xo(l)).setEventedParent(i,{layer:{id:l.id}}),i._layers[l.id]=l}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ha(this.stylesheet.light),this.fire("data",{dataType:"style"}),this.fire("style.load")}},e.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(e){var i=t.sourceLayer;if(i){var n=e.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire("error",{error:new Error('Source layer "'+i+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')})}}},e.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},e.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},e.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},e.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},e.prototype.update=function(t){if(this._loaded){if(this._changed){var e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var n in(e.length||i.length)&&this._updateWorkerLayers(e,i),this._updatedSources){var r=this._updatedSources[n];"reload"===r?this._reloadSource(n):"clear"===r&&this._clearSource(n)}for(var o in this._updatedPaintProps)this._layers[o].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates(),this.fire("data",{dataType:"style"})}for(var a in this.sourceCaches)this.sourceCaches[a].used=!1;for(var s=0,l=this._order;s<l.length;s+=1){var u=l[s],c=this._layers[u];c.recalculate(t),!c.isHidden(t.zoom)&&c.source&&(this.sourceCaches[c.source].used=!0)}this.light.recalculate(t),this.z=t.zoom}},e.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},e.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},e.prototype.setState=function(t){var e=this;if(this._checkLoaded(),ii.emitErrors(this,ii(t)))return!1;(t=k(t)).layers=Yl(t.layers);var i=au(this.serialize(),t).filter(function(t){return!(t.command in Mu)});if(0===i.length)return!1;var n=i.filter(function(t){return!(t.command in Iu)});if(n.length>0)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},e.prototype.addImage=function(t,e){if(this.getImage(t))return this.fire("error",{error:new Error("An image with this name already exists.")});this.imageManager.addImage(t,e),this.fire("data",{dataType:"style"})},e.prototype.getImage=function(t){return this.imageManager.getImage(t)},e.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire("error",{error:new Error("No image with this name exists.")});this.imageManager.removeImage(t),this.fire("data",{dataType:"style"})},e.prototype.addSource=function(t,e,i){var n=this;if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e).join(", ")+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(e.type)>=0)||!this._validate(ii.source,"sources."+t,e,null,i)){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);var r=this.sourceCaches[t]=new ql(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:n.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},e.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var e in this._layers)if(this._layers[e].source===t)return this.fire("error",{error:new Error('Source "'+t+'" cannot be removed while layer "'+e+'" is using it.')});var i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire("data",{sourceDataType:"metadata",dataType:"source",sourceId:t}),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},e.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},e.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},e.prototype.addLayer=function(t,e,i){this._checkLoaded();var n=t.id;if("object"==typeof t.source&&(this.addSource(n,t.source),t=_(t=k(t),{source:n})),!this._validate(ii.layer,"layers."+n,t,{arrayIndex:-1},i)){var r=Xo(t);this._validateLayer(r),r.setEventedParent(this,{layer:{id:n}});var o=e?this._order.indexOf(e):this._order.length;if(e&&-1===o)this.fire("error",{error:new Error('Layer with id "'+e+'" does not exist on this map.')});else{if(this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=r,this._removedLayers[n]&&r.source){var a=this._removedLayers[n];delete this._removedLayers[n],a.type!==r.type?this._updatedSources[r.source]="clear":(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause())}this._updateLayer(r)}}},e.prototype.moveLayer=function(t,e){if(this._checkLoaded(),this._changed=!0,this._layers[t]){var i=this._order.indexOf(t);this._order.splice(i,1);var n=e?this._order.indexOf(e):this._order.length;e&&-1===n?this.fire("error",{error:new Error('Layer with id "'+e+'" does not exist on this map.')}):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")})},e.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")})},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.setLayerZoomRange=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);n?n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n)):this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},e.prototype.setFilter=function(t,e){this._checkLoaded();var i=this.getLayer(t);if(i){if(!p(i.filter,e))return null==e?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(ii.filter,"layers."+i.id+".filter",e)||(i.filter=k(e),this._updateLayer(i)))}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},e.prototype.getFilter=function(t){return k(this.getLayer(t).filter)},e.prototype.setLayoutProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);n?p(n.getLayoutProperty(e),i)||(n.setLayoutProperty(e,i),this._updateLayer(n)):this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},e.prototype.setPaintProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);if(n){if(!p(n.getPaintProperty(e),i)){var r=n._transitionablePaint._values[e].value.isDataDriven();n.setPaintProperty(e,i),(n._transitionablePaint._values[e].value.isDataDriven()||r)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[t]=!0}}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},e.prototype.getTransition=function(){return _({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},e.prototype.serialize=function(){var t=this;return A({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:z(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(e){return t._layers[e].serialize()})},function(t){return void 0!==t})},e.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},e.prototype._flattenRenderedFeatures=function(t){for(var e=[],i=this._order.length-1;i>=0;i--)for(var n=this._order[i],r=0,o=t;r<o.length;r+=1){var a=o[r][n];if(a)for(var s=0,l=a;s<l.length;s+=1){var u=l[s];e.push(u)}}return e},e.prototype.queryRenderedFeatures=function(t,e,i,n){e&&e.filter&&this._validate(ii.filter,"queryRenderedFeatures.filter",e.filter);var r={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire("error",{error:"parameters.layers must be an Array."}),[];for(var o=0,a=e.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire("error",{error:"The layer '"+s+"' does not exist in the map's style and cannot be queried for features."}),[];r[l.source]=!0}}var u=[];for(var c in this.sourceCaches)if(!e.layers||r[c]){var h=xs(this.sourceCaches[c],this._layers,t,e,0,n,this.collisionIndex);u.push(h)}return this._flattenRenderedFeatures(u)},e.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(ii.filter,"querySourceFeatures.filter",e.filter);var i=this.sourceCaches[t];return i?function(t,e){for(var i=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],r={},o=0;o<i.length;o++){var a=i[o],s=a.tileID.canonical.key;r[s]||(r[s]=!0,a.querySourceFeatures(n,e))}return n}(i,e):[]},e.prototype.addSourceType=function(t,e,i){return function(t){return vs[t]}(t)?i(new Error('A source type called "'+t+'" already exists.')):(function(t,e){vs[t]=e}(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},e.prototype.getLight=function(){return this.light.getLight()},e.prototype.setLight=function(t){this._checkLoaded();var e=this.light.getLight(),i=!1;for(var n in t)if(!p(t[n],e[n])){i=!0;break}if(i){var r={now:o.now(),transition:_({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t),this.light.updateTransitions(r)}},e.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&oi(this,t.call(ii,_({key:e,style:this.serialize(),value:i,styleSpec:K},n)))},e.prototype._remove=function(){for(var t in _o.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove()},e.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},e.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},e.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},e.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},e.prototype._updatePlacement=function(t,e,i){for(var n=!1,r=!1,a={},s=0,l=this._order;s<l.length;s+=1){var u=l[s],c=this._layers[u];if("symbol"===c.type){if(!a[c.source]){var h=this.sourceCaches[c.source];a[c.source]=h.getRenderableIds().map(function(t){return h.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(c,a[c.source]);n=n||p}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var f=this._layerOrderChanged;if((f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now()))&&(this.pauseablePlacement=new Tu(t,this._order,f,e,i),this._layerOrderChanged=!1),this.pauseablePlacement.isDone())this.placement.setStale();else{if(this.pauseablePlacement.continuePlacement(this._order,this._layers,a),this.pauseablePlacement.isDone()){var d=this.pauseablePlacement.placement;r=d.commit(this.placement,o.now()),(!this.placement||r||n)&&(this.placement=d,this.collisionIndex=this.placement.collisionIndex),this.placement.setRecent(o.now(),d.stale)}n&&this.pauseablePlacement.placement.setStale()}if(r||n)for(var m=0,y=this._order;m<y.length;m+=1){var g=y[m],v=this._layers[g];"symbol"===v.type&&this.placement.updateLayerOpacities(v,a[v.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())},e.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i)},e.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)},e}(H),Pu=Pi([{name:"a_pos",type:"Int16",components:2}]),Lu={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n// Unpack a pair of values that have been packed into a single float.\n// The packed values are assumed to be 8-bit unsigned integers, and are\n// packed like so:\n// packedValue = floor(input[0]) * 256 + input[1],\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue = int(packedValue);\n    int v0 = packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity = int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\n\n// To minimize the number of attributes needed, we encode a 4-component\n// color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},background:{fragmentSource:"uniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main() {\n    gl_FragColor = u_color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},backgroundPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\nuniform float u_opacity;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},circle:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main(void) {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center = floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position = circle_center;\n        if (u_scale_with_map) {\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\n    } else {\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\n}\n"},clippingMask:{fragmentSource:"void main() {\n    gl_FragColor = vec4(1.0);\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},heatmap:{fragmentSource:"#pragma mapbox: define highp float weight\n\nuniform highp float u_intensity;\nvarying vec2 v_extrude;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main() {\n    #pragma mapbox: initialize highp float weight\n\n    // Kernel density estimation with a Gaussian kernel of size 5x5\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = weight * u_intensity * GAUSS_COEF * exp(d);\n\n    gl_FragColor = vec4(val, 1.0, 1.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\n\nuniform mat4 u_matrix;\nuniform float u_extrude_scale;\nuniform float u_opacity;\nuniform float u_intensity;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_extrude;\n\n// Effective \"0\" in the kernel density texture to adjust the kernel size to;\n// this empirically chosen number minimizes artifacts on overlapping kernels\n// for typical heatmap cases (assuming clustered source)\nconst highp float ZERO = 1.0 / 255.0 / 16.0;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main(void) {\n    #pragma mapbox: initialize highp float weight\n    #pragma mapbox: initialize mediump float radius\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 unscaled_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // This 'extrude' comes in ranging from [-1, -1], to [1, 1].  We'll use\n    // it to produce the vertices of a square mesh framing the point feature\n    // we're adding to the kernel density texture.  We'll also pass it as\n    // a varying, so that the fragment shader can determine the distance of\n    // each fragment from the point feature.\n    // Before we do so, we need to scale it up sufficiently so that the\n    // kernel falls effectively to zero at the edge of the mesh.\n    // That is, we want to know S such that\n    // weight * u_intensity * GAUSS_COEF * exp(-0.5 * 3.0^2 * S^2) == ZERO\n    // Which solves to:\n    // S = sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\n    float S = sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\n\n    // Pass the varying in units of radius\n    v_extrude = S * unscaled_extrude;\n\n    // Scale by radius and the zoom-based scale factor to produce actual\n    // mesh position\n    vec2 extrude = v_extrude * radius * u_extrude_scale;\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec4 pos = vec4(floor(a_pos * 0.5) + extrude, 0, 1);\n\n    gl_Position = u_matrix * pos;\n}\n"},heatmapTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform sampler2D u_color_ramp;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    float t = texture2D(u_image, v_pos).r;\n    vec4 color = texture2D(u_color_ramp, vec2(t, 0.5));\n    gl_FragColor = color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},collisionBox:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        gl_FragColor *= .1;\n    }\n}",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position.xy += a_extrude * u_extrude_scale * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n}\n"},collisionCircle:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    vec4 color = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        color = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        color *= .2;\n    }\n\n    float extrude_scale_length = length(v_extrude_scale);\n    float extrude_length = length(v_extrude) * extrude_scale_length;\n    float stroke_width = 15.0 * extrude_scale_length;\n    float radius = v_radius * extrude_scale_length;\n\n    float distance_to_edge = abs(extrude_length - radius);\n    float opacity_t = smoothstep(-stroke_width, 0.0, -distance_to_edge);\n\n    gl_FragColor = opacity_t * color;\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\n\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n\n    highp float padding_factor = 1.2; // Pad the vertices slightly to make room for anti-alias blur\n    gl_Position.xy += a_extrude * u_extrude_scale * padding_factor * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n    v_radius = abs(a_extrude.y); // We don't pitch the circles, so both units of the extrusion vector are equal in magnitude to the radius\n\n    v_extrude = a_extrude * padding_factor;\n    v_extrude_scale = u_extrude_scale * u_camera_to_center_distance * collision_perspective_ratio;\n}\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    vec3 normal = a_normal_ed.xyz;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec3 normal = a_normal_ed.xyz;\n    float edgedistance = a_normal_ed.w;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = normal.x == 1.0 && normal.y == 0.0 && normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},hillshadePrepare:{fragmentSource:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D u_image;\nvarying vec2 v_pos;\nuniform vec2 u_dimension;\nuniform float u_zoom;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_image, coord) * 255.0;\n    return (data.r + data.g * 256.0 + data.b * 256.0 * 256.0) / 4.0;\n}\n\nvoid main() {\n    vec2 epsilon = 1.0 / u_dimension;\n\n    // queried pixels:\n    // +-----------+\n    // |   |   |   |\n    // | a | b | c |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | d | e | f |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | g | h | i |\n    // |   |   |   |\n    // +-----------+\n\n    float a = getElevation(v_pos + vec2(-epsilon.x, -epsilon.y), 0.0);\n    float b = getElevation(v_pos + vec2(0, -epsilon.y), 0.0);\n    float c = getElevation(v_pos + vec2(epsilon.x, -epsilon.y), 0.0);\n    float d = getElevation(v_pos + vec2(-epsilon.x, 0), 0.0);\n    float e = getElevation(v_pos, 0.0);\n    float f = getElevation(v_pos + vec2(epsilon.x, 0), 0.0);\n    float g = getElevation(v_pos + vec2(-epsilon.x, epsilon.y), 0.0);\n    float h = getElevation(v_pos + vec2(0, epsilon.y), 0.0);\n    float i = getElevation(v_pos + vec2(epsilon.x, epsilon.y), 0.0);\n\n    // here we divide the x and y slopes by 8 * pixel size\n    // where pixel size (aka meters/pixel) is:\n    // circumference of the world / (pixels per tile * number of tiles)\n    // which is equivalent to: 8 * 40075016.6855785 / (512 * pow(2, u_zoom))\n    // which can be reduced to: pow(2, 19.25619978527 - u_zoom)\n    // we want to vertically exaggerate the hillshading though, because otherwise\n    // it is barely noticeable at low zooms. to do this, we multiply this by some\n    // scale factor pow(2, (u_zoom - 14) * a) where a is an arbitrary value and 14 is the\n    // maxzoom of the tile source. here we use a=0.3 which works out to the\n    // expression below. see nickidlugash's awesome breakdown for more info\n    // https://github.com/mapbox/mapbox-gl-js/pull/5286#discussion_r148419556\n    float exaggeration = u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\n\n    vec2 deriv = vec2(\n        (c + f + f + i) - (a + d + d + g),\n        (g + h + h + i) - (a + b + b + c)\n    ) /  pow(2.0, (u_zoom - 14.0) * exaggeration + 19.2562 - u_zoom);\n\n    gl_FragColor = clamp(vec4(\n        deriv.x / 2.0 + 0.5,\n        deriv.y / 2.0 + 0.5,\n        1.0,\n        1.0), 0.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (a_texture_pos / 8192.0) / 2.0 + 0.25;\n}\n"},hillshade:{fragmentSource:"uniform sampler2D u_image;\nvarying vec2 v_pos;\n\nuniform vec2 u_latrange;\nuniform vec2 u_light;\nuniform vec4 u_shadow;\nuniform vec4 u_highlight;\nuniform vec4 u_accent;\n\n#define PI 3.141592653589793\n\nvoid main() {\n    vec4 pixel = texture2D(u_image, v_pos);\n\n    vec2 deriv = ((pixel.rg * 2.0) - 1.0);\n\n    // We divide the slope by a scale factor based on the cosin of the pixel's approximate latitude\n    // to account for mercator projection distortion. see #4807 for details\n    float scaleFactor = cos(radians((u_latrange[0] - u_latrange[1]) * (1.0 - v_pos.y) + u_latrange[1]));\n    // We also multiply the slope by an arbitrary z-factor of 1.25\n    float slope = atan(1.25 * length(deriv) / scaleFactor);\n    float aspect = deriv.x != 0.0 ? atan(deriv.y, -deriv.x) : PI / 2.0 * (deriv.y > 0.0 ? 1.0 : -1.0);\n\n    float intensity = u_light.x;\n    // We add PI to make this property match the global light object, which adds PI/2 to the light's azimuthal\n    // position property to account for 0deg corresponding to north/the top of the viewport in the style spec\n    // and the original shader was written to accept (-illuminationDirection - 90) as the azimuthal.\n    float azimuth = u_light.y + PI;\n\n    // We scale the slope exponentially based on intensity, using a calculation similar to\n    // the exponential interpolation function in the style spec:\n    // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/expression/definitions/interpolate.js#L217-L228\n    // so that higher intensity values create more opaque hillshading.\n    float base = 1.875 - intensity * 1.75;\n    float maxValue = 0.5 * PI;\n    float scaledSlope = intensity != 0.5 ? ((pow(base, slope) - 1.0) / (pow(base, maxValue) - 1.0)) * maxValue : slope;\n\n    // The accent color is calculated with the cosine of the slope while the shade color is calculated with the sine\n    // so that the accent color's rate of change eases in while the shade color's eases out.\n    float accent = cos(scaledSlope);\n    // We multiply both the accent and shade color by a clamped intensity value\n    // so that intensities >= 0.5 do not additionally affect the color values\n    // while intensity values < 0.5 make the overall color more transparent.\n    vec4 accent_color = (1.0 - accent) * u_accent * clamp(intensity * 2.0, 0.0, 1.0);\n    float shade = abs(mod((aspect + azimuth) / PI + 0.5, 2.0) - 1.0);\n    vec4 shade_color = mix(u_shadow, u_highlight, shade) * sin(scaledSlope) * clamp(intensity * 2.0, 0.0, 1.0);\n    gl_FragColor = accent_color * (1.0 - shade_color.a) + shade_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = a_texture_pos / 8192.0;\n}\n"},line:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    if (color0.a > 0.0) {\n        color0.rgb = color0.rgb / color0.a;\n    }\n    if (color1.a > 0.0) {\n        color1.rgb = color1.rgb / color1.a;\n    }\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\n\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    lowp float alpha = opacity * v_fade_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform float u_fade_change;\n\n#pragma mapbox: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 tex = v_data0.xy;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n    float fade_opacity = v_data1[2];\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n    gl_FragColor = color * (alpha * opacity * fade_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform float u_fade_change;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n\n    v_data0 = vec2(tex.x, tex.y);\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\n}\n"}},Du=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,Ru=function(t){var e=Lu[t],i={};e.fragmentSource=e.fragmentSource.replace(Du,function(t,e,n,r,o){return i[o]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+n+" "+r+" "+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(Du,function(t,e,n,r,o){var a="float"===r?"vec2":"vec4";return i[o]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\nvarying "+n+" "+r+" "+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+a+"(a_"+o+", a_"+o+"_t);\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\n#else\nuniform "+n+" "+r+" u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+n+" "+r+" "+o+" = unpack_mix_"+a+"(a_"+o+", a_"+o+"_t);\n#else\n    "+n+" "+r+" "+o+" = u_"+o+";\n#endif\n"})};for(var Bu in Lu)Ru(Bu);var Ou=Lu,Fu=function(t,e,i,n){var r=t.gl;this.program=r.createProgram();var a=i.defines().concat("#define DEVICE_PIXEL_RATIO "+o.devicePixelRatio.toFixed(1));n&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(Ou.prelude.fragmentSource,e.fragmentSource).join("\n"),l=a.concat(Ou.prelude.vertexSource,e.vertexSource).join("\n"),u=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(u,s),r.compileShader(u),r.attachShader(this.program,u);var c=r.createShader(r.VERTEX_SHADER);r.shaderSource(c,l),r.compileShader(c),r.attachShader(this.program,c);for(var h=i.layoutAttributes||[],p=0;p<h.length;p++)r.bindAttribLocation(this.program,p,h[p].name);r.linkProgram(this.program),this.numAttributes=r.getProgramParameter(this.program,r.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var f=0;f<this.numAttributes;f++){var d=r.getActiveAttrib(this.program,f);d&&(this.attributes[d.name]=r.getAttribLocation(this.program,d.name))}for(var m=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS),y=0;y<m;y++){var g=r.getActiveUniform(this.program,y);g&&(this.uniforms[g.name]=r.getUniformLocation(this.program,g.name))}};function ju(t,e,i,n,r){for(var o=0;o<i.length;o++){var a=i[o];if(n.isLessThan(a.tileID))break;if(e.key===a.tileID.key)return;if(a.tileID.isChildOf(e)){for(var s=e.children(1/0),l=0;l<s.length;l++){ju(t,s[l],i.slice(o),n,r)}return}}var u=e.overscaledZ-t.overscaledZ,c=new ss(u,e.canonical.x-(t.canonical.x<<u),e.canonical.y-(t.canonical.y<<u));r[c.key]=r[c.key]||c}function Vu(t,e,i,n,r){var o=t.context,a=o.gl,s=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox");o.setDepthMode(jl.disabled),o.setStencilMode(Vl.disabled),o.setColorMode(t.colorModeForRenderPass());for(var l=0;l<n.length;l++){var u=n[l],c=e.getTile(u),h=c.getBucket(i);if(h){var p=r?h.collisionCircle:h.collisionBox;if(p){a.uniformMatrix4fv(s.uniforms.u_matrix,!1,u.posMatrix),r||o.lineWidth.set(1),a.uniform1f(s.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var f=su(c,1,t.transform.zoom),d=Math.pow(2,t.transform.zoom-c.tileID.overscaledZ);a.uniform1f(s.uniforms.u_pixels_to_tile_units,f),a.uniform2f(s.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(f*d),t.transform.pixelsToGLUnits[1]/(f*d)),s.draw(o,r?a.TRIANGLES:a.LINES,i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,p.collisionVertexBuffer,null)}}}}Fu.prototype.draw=function(t,e,i,n,r,o,a,s,l){for(var u,c=t.gl,h=(u={},u[c.LINES]=2,u[c.TRIANGLES]=3,u)[e],p=0,f=o.get();p<f.length;p+=1){var d=f[p],m=d.vaos||(d.vaos={});(m[i]||(m[i]=new ds)).bind(t,this,n,a?a.getPaintVertexBuffers():[],r,d.vertexOffset,s,l),c.drawElements(e,d.primitiveLength*h,c.UNSIGNED_SHORT,d.primitiveOffset*h*2)}};var Nu=Cs.identity(new Float32Array(16)),Uu=No.layout;function qu(t,e,i,n,r,o,a,s,l,u){var c,h=t.context,p=h.gl,f=t.transform,d="map"===s,m="map"===l,y=d&&"line"===i.layout.get("symbol-placement"),g=d&&!m&&!y,v=m;h.setDepthMode(v?t.depthModeForSublayer(0,jl.ReadOnly):jl.disabled);for(var _=0,x=n;_<x.length;_+=1){var b=x[_],w=e.getTile(b),T=w.getBucket(i);if(T){var S=r?T.text:T.icon;if(S&&S.segments.get().length){var z=S.programConfigurations.get(i.id),A=r||T.sdfIcons,k=r?T.textSizeData:T.iconSizeData;if(c||(c=t.useProgram(A?"symbolSDF":"symbolIcon",z),z.setUniforms(t.context,c,i.paint,{zoom:t.transform.zoom}),Zu(c,t,i,r,g,m,k)),h.activeTexture.set(p.TEXTURE0),p.uniform1i(c.uniforms.u_texture,0),r)w.glyphAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.uniform2fv(c.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var E=1!==i.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,I=m||0!==f.pitch;w.iconAtlasTexture.bind(A||t.options.rotating||t.options.zooming||E||I?p.LINEAR:p.NEAREST,p.CLAMP_TO_EDGE),p.uniform2fv(c.uniforms.u_texsize,w.iconAtlasTexture.size)}p.uniformMatrix4fv(c.uniforms.u_matrix,!1,t.translatePosMatrix(b.posMatrix,w,o,a));var M=su(w,1,t.transform.zoom),C=Zs.getLabelPlaneMatrix(b.posMatrix,m,d,t.transform,M),P=Zs.getGlCoordMatrix(b.posMatrix,m,d,t.transform,M);p.uniformMatrix4fv(c.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(P,w,o,a,!0)),y?(p.uniformMatrix4fv(c.uniforms.u_label_plane_matrix,!1,Nu),Zs.updateLineLabels(T,b.posMatrix,t,r,C,P,m,u)):p.uniformMatrix4fv(c.uniforms.u_label_plane_matrix,!1,C),p.uniform1f(c.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),Gu(c,z,t,i,w,S,r,A,m)}}}}function Zu(t,e,i,n,r,o,a){var s=e.context.gl,l=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,o?1:0),s.uniform1f(t.uniforms.u_is_text,n?1:0),s.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var u="constant"===a.functionType||"source"===a.functionType,c="constant"===a.functionType||"camera"===a.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,u?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,c?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var h=Co.evaluateSizeForZoom(a,l.zoom,Uu.properties[n?"text-size":"icon-size"]);void 0!==h.uSizeT&&s.uniform1f(t.uniforms.u_size_t,h.uSizeT),void 0!==h.uSize&&s.uniform1f(t.uniforms.u_size,h.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),s.uniform1i(t.uniforms.u_rotate_symbol,r?1:0)}function Gu(t,e,i,n,r,o,a,s,l){var u=i.context,c=u.gl,h=i.transform;if(s){var p=0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),f=l?Math.cos(h._pitch)*h.cameraToCenterDistance:1;c.uniform1f(t.uniforms.u_gamma_scale,f),p&&(c.uniform1f(t.uniforms.u_is_halo,1),Wu(o,n,u,t)),c.uniform1f(t.uniforms.u_is_halo,0)}Wu(o,n,u,t)}function Wu(t,e,i,n){n.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Xu(t,e,i,n,r,a,s,l,u){var c,h,p,f,d=e.context,m=d.gl,y=r.paint.get("line-dasharray"),g=r.paint.get("line-pattern");if(l||u){var v=1/su(i,1,e.transform.tileZoom);if(y){c=e.lineAtlas.getDash(y.from,"round"===r.layout.get("line-cap")),h=e.lineAtlas.getDash(y.to,"round"===r.layout.get("line-cap"));var _=c.width*y.fromScale,x=h.width*y.toScale;m.uniform2f(t.uniforms.u_patternscale_a,v/_,-c.height/2),m.uniform2f(t.uniforms.u_patternscale_b,v/x,-h.height/2),m.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(_,x)*o.devicePixelRatio)/2)}else if(g){if(p=e.imageManager.getPattern(g.from),f=e.imageManager.getPattern(g.to),!p||!f)return;m.uniform2f(t.uniforms.u_pattern_size_a,p.displaySize[0]*g.fromScale/v,f.displaySize[1]),m.uniform2f(t.uniforms.u_pattern_size_b,f.displaySize[0]*g.toScale/v,f.displaySize[1]);var b=e.imageManager.getPixelSize(),w=b.width,T=b.height;m.uniform2fv(t.uniforms.u_texsize,[w,T])}m.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}l&&(y?(m.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(d),m.uniform1f(t.uniforms.u_tex_y_a,c.y),m.uniform1f(t.uniforms.u_tex_y_b,h.y),m.uniform1f(t.uniforms.u_mix,y.t)):g&&(m.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(m.TEXTURE0),e.imageManager.bind(d),m.uniform2fv(t.uniforms.u_pattern_tl_a,p.tl),m.uniform2fv(t.uniforms.u_pattern_br_a,p.br),m.uniform2fv(t.uniforms.u_pattern_tl_b,f.tl),m.uniform2fv(t.uniforms.u_pattern_br_b,f.br),m.uniform1f(t.uniforms.u_fade,g.t))),d.setStencilMode(e.stencilModeForClipping(a));var S=e.translatePosMatrix(a.posMatrix,i,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"));m.uniformMatrix4fv(t.uniforms.u_matrix,!1,S),m.uniform1f(t.uniforms.u_ratio,1/su(i,1,e.transform.zoom)),t.draw(d,m.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,s)}var Hu=function(t,e){if(!t)return!1;var i=e.imageManager.getPattern(t.from),n=e.imageManager.getPattern(t.to);return!i||!n},Ku=function(t,e,i){var n=e.context,r=n.gl,o=e.imageManager.getPattern(t.from),a=e.imageManager.getPattern(t.to);r.uniform1i(i.uniforms.u_image,0),r.uniform2fv(i.uniforms.u_pattern_tl_a,o.tl),r.uniform2fv(i.uniforms.u_pattern_br_a,o.br),r.uniform2fv(i.uniforms.u_pattern_tl_b,a.tl),r.uniform2fv(i.uniforms.u_pattern_br_b,a.br);var s=e.imageManager.getPixelSize(),l=s.width,u=s.height;r.uniform2fv(i.uniforms.u_texsize,[l,u]),r.uniform1f(i.uniforms.u_mix,t.t),r.uniform2fv(i.uniforms.u_pattern_size_a,o.displaySize),r.uniform2fv(i.uniforms.u_pattern_size_b,a.displaySize),r.uniform1f(i.uniforms.u_scale_a,t.fromScale),r.uniform1f(i.uniforms.u_scale_b,t.toScale),n.activeTexture.set(r.TEXTURE0),e.imageManager.bind(e.context)},Ju=function(t,e,i){var n=e.context.gl;n.uniform1f(i.uniforms.u_tile_units_to_pixels,1/su(t,1,e.transform.tileZoom));var r=Math.pow(2,t.tileID.overscaledZ),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,a=o*(t.tileID.canonical.x+t.tileID.wrap*r),s=o*t.tileID.canonical.y;n.uniform2f(i.uniforms.u_pixel_coord_upper,a>>16,s>>16),n.uniform2f(i.uniforms.u_pixel_coord_lower,65535&a,65535&s)};function Yu(t,e,i,n,r){if(!Hu(i.paint.get("fill-pattern"),t))for(var o=!0,a=0,s=n;a<s.length;a+=1){var l=s[a],u=e.getTile(l),c=u.getBucket(i);c&&(t.context.setStencilMode(t.stencilModeForClipping(l)),r(t,e,i,u,l,c,o),o=!1)}}function $u(t,e,i,n,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(i.id);tc("fill",i.paint.get("fill-pattern"),t,l,i,n,r,a).draw(t.context,s.TRIANGLES,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,l)}function Qu(t,e,i,n,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(i.id),u=tc("fillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),t,l,i,n,r,a);s.uniform2f(u.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),u.draw(t.context,s.LINES,i.id,o.layoutVertexBuffer,o.indexBuffer2,o.segments2,l)}function tc(t,e,i,n,r,o,a,s){var l,u=i.context.program.get();return e?(l=i.useProgram(t+"Pattern",n),(s||l.program!==u)&&(n.setUniforms(i.context,l,r.paint,{zoom:i.transform.zoom}),Ku(e,i,l)),Ju(o,i,l)):(l=i.useProgram(t,n),(s||l.program!==u)&&n.setUniforms(i.context,l,r.paint,{zoom:i.transform.zoom})),i.context.gl.uniformMatrix4fv(l.uniforms.u_matrix,!1,i.translatePosMatrix(a.posMatrix,o,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"))),l}var ec=Is.mat3,ic=Is.mat4,nc=Is.vec3;function rc(t,e,i,n,r,o,a){var s=t.context,l=s.gl,u=i.paint.get("fill-extrusion-pattern"),c=t.context.program.get(),h=o.programConfigurations.get(i.id),p=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",h);if((a||p.program!==c)&&h.setUniforms(s,p,i.paint,{zoom:t.transform.zoom}),u){if(Hu(u,t))return;Ku(u,t,p),Ju(n,t,p),l.uniform1f(p.uniforms.u_height_factor,-Math.pow(2,r.overscaledZ)/n.tileSize/8)}t.context.gl.uniformMatrix4fv(p.uniforms.u_matrix,!1,t.translatePosMatrix(r.posMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor"))),function(t,e){var i=e.context.gl,n=e.style.light,r=n.properties.get("position"),o=[r.x,r.y,r.z],a=ec.create();"viewport"===n.properties.get("anchor")&&ec.fromRotation(a,-e.transform.angle);nc.transformMat3(o,o,a);var s=n.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,o),i.uniform1f(t.uniforms.u_lightintensity,n.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b)}(p,t),p.draw(s,l.TRIANGLES,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,h)}function oc(t,e,i){var n=t.context,r=n.gl,o=e.fbo;if(o){var a=t.useProgram("hillshade"),s=t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),!0);!function(t,e,i){var n=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(n-=e.transform.angle),e.context.gl.uniform2f(t.uniforms.u_light,i.paint.get("hillshade-exaggeration"),n)}(a,t,i);var l=function(t,e){var i=e.toCoordinate(),n=new u(i.column,i.row+1,i.zoom);return[t.transform.coordinateLocation(i).lat,t.transform.coordinateLocation(n).lat]}(t,e.tileID);n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,s),r.uniform2fv(a.uniforms.u_latrange,l),r.uniform1i(a.uniforms.u_image,0);var c=i.paint.get("hillshade-shadow-color");r.uniform4f(a.uniforms.u_shadow,c.r,c.g,c.b,c.a);var h=i.paint.get("hillshade-highlight-color");r.uniform4f(a.uniforms.u_highlight,h.r,h.g,h.b,h.a);var p=i.paint.get("hillshade-accent-color");if(r.uniform4f(a.uniforms.u_accent,p.r,p.g,p.b,p.a),e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments)a.draw(n,r.TRIANGLES,i.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments);else{var f=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(n,a,f,[]),r.drawArrays(r.TRIANGLE_STRIP,0,f.length)}}}function ac(t,e){var i=t.context,n=i.gl;if(e.dem&&e.dem.level){var r=e.dem.level.dim,o=e.dem.getPixels();if(i.activeTexture.set(n.TEXTURE1),i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(e.tileSize),e.demTexture){var a=e.demTexture;a.update(o,!1),a.bind(n.NEAREST,n.CLAMP_TO_EDGE)}else e.demTexture=new fa(i,o,n.RGBA,!1),e.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE);i.activeTexture.set(n.TEXTURE0);var s=e.fbo;if(!s){var l=new fa(i,{width:r,height:r,data:null},n.RGBA);l.bind(n.LINEAR,n.CLAMP_TO_EDGE),(s=e.fbo=i.createFramebuffer(r,r)).colorAttachment.set(l.texture)}i.bindFramebuffer.set(s.framebuffer),i.viewport.set([0,0,r,r]);var u=Cs.create();Cs.ortho(u,0,xn,-xn,0,0,1),Cs.translate(u,u,[0,-xn,0]);var c=t.useProgram("hillshadePrepare");n.uniformMatrix4fv(c.uniforms.u_matrix,!1,u),n.uniform1f(c.uniforms.u_zoom,e.tileID.overscaledZ),n.uniform2fv(c.uniforms.u_dimension,[2*r,2*r]),n.uniform1i(c.uniforms.u_image,1);var h=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(i,c,h,[]),n.drawArrays(n.TRIANGLE_STRIP,0,h.length),e.needsHillshadePrepare=!1}}function sc(t,e,i,n,r){var a=n.paint.get("raster-fade-duration");if(a>0){var s=o.now(),l=(s-t.timeAdded)/a,u=e?(s-e.timeAdded)/a:-1,c=i.getSource(),h=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!e||Math.abs(e.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),f=p&&t.refreshedUponExpiration?1:m(p?l:1-u,0,1);return t.refreshedUponExpiration&&l>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function lc(t,e,i){var n=t.context,r=n.gl;n.lineWidth.set(1*o.devicePixelRatio);var a=i.posMatrix,s=t.useProgram("debug");n.setDepthMode(jl.disabled),n.setStencilMode(Vl.disabled),n.setColorMode(t.colorModeForRenderPass()),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),r.uniform4f(s.uniforms.u_color,1,0,0,1),t.debugVAO.bind(n,s,t.debugBuffer,[]),r.drawArrays(r.LINE_STRIP,0,t.debugBuffer.length);for(var l=function(t,e,i,n){n=n||1;var r,o,a,s,l,u,c,h,p=[];for(r=0,o=t.length;r<o;r++)if(l=uc[t[r]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)-1===l[1][a]&&-1===l[1][a+1]?h=null:(u=e+l[1][a]*n,c=i-l[1][a+1]*n,h&&p.push(h.x,h.y,u,c),h={x:u,y:c});e+=l[0]*n}return p}(i.toString(),50,200,5),u=new Di,c=0;c<l.length;c+=2)u.emplaceBack(l[c],l[c+1]);var h=n.createVertexBuffer(u,Pu.members);(new ds).bind(n,s,h,[]),r.uniform4f(s.uniforms.u_color,1,1,1,1);for(var p=e.getTile(i).tileSize,f=xn/(Math.pow(2,t.transform.zoom-i.overscaledZ)*p),d=[[-1,-1],[-1,1],[1,-1],[1,1]],m=0;m<d.length;m++){var y=d[m];r.uniformMatrix4fv(s.uniforms.u_matrix,!1,Cs.translate([],a,[f*y[0],f*y[1],0])),r.drawArrays(r.LINES,0,h.length)}r.uniform4f(s.uniforms.u_color,0,0,0,1),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),r.drawArrays(r.LINES,0,h.length)}var uc={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};var cc={symbol:function(t,e,i,n){if("translucent"===t.renderPass){var r=t.context;r.setStencilMode(Vl.disabled),r.setColorMode(t.colorModeForRenderPass()),0!==i.paint.get("icon-opacity").constantOr(1)&&qu(t,e,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&qu(t,e,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&function(t,e,i,n){Vu(t,e,i,n,!1),Vu(t,e,i,n,!0)}(t,e,i,n)}},circle:function(t,e,i,n){if("translucent"===t.renderPass){var r=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=t.context,l=s.gl;s.setDepthMode(t.depthModeForSublayer(0,jl.ReadOnly)),s.setStencilMode(Vl.disabled),s.setColorMode(t.colorModeForRenderPass());for(var u=!0,c=0;c<n.length;c++){var h=n[c],p=e.getTile(h),f=p.getBucket(i);if(f){var d=t.context.program.get(),m=f.programConfigurations.get(i.id),y=t.useProgram("circle",m);if((u||y.program!==d)&&(m.setUniforms(s,y,i.paint,{zoom:t.transform.zoom}),u=!1),l.uniform1f(y.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),l.uniform1i(y.uniforms.u_scale_with_map,"map"===i.paint.get("circle-pitch-scale")?1:0),"map"===i.paint.get("circle-pitch-alignment")){l.uniform1i(y.uniforms.u_pitch_with_map,1);var g=su(p,1,t.transform.zoom);l.uniform2f(y.uniforms.u_extrude_scale,g,g)}else l.uniform1i(y.uniforms.u_pitch_with_map,0),l.uniform2fv(y.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);l.uniformMatrix4fv(y.uniforms.u_matrix,!1,t.translatePosMatrix(h.posMatrix,p,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor"))),y.draw(s,l.TRIANGLES,i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,m)}}}}},heatmap:function(t,e,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var r=t.context,o=r.gl;r.setDepthMode(t.depthModeForSublayer(0,jl.ReadOnly)),r.setStencilMode(Vl.disabled),function(t,e,i){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=i.heatmapFbo;if(r)n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,i,n,r){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,i.width/4,i.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),r.colorAttachment.set(n),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,i,n,r))}(t,e,o,r)}}(r,t,i),r.clear({color:ft.transparent}),r.setColorMode(new Nl([o.ONE,o.ONE],ft.transparent,[!0,!0,!0,!0]));for(var a=!0,s=0;s<n.length;s++){var l=n[s];if(!e.hasRenderableParent(l)){var u=e.getTile(l),c=u.getBucket(i);if(c){var h=t.context.program.get(),p=c.programConfigurations.get(i.id),f=t.useProgram("heatmap",p),d=t.transform.zoom;(a||f.program!==h)&&(p.setUniforms(t.context,f,i.paint,{zoom:d}),a=!1),o.uniform1f(f.uniforms.u_extrude_scale,su(u,1,d)),o.uniform1f(f.uniforms.u_intensity,i.paint.get("heatmap-intensity")),o.uniformMatrix4fv(f.uniforms.u_matrix,!1,l.posMatrix),f.draw(r,o.TRIANGLES,i.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,p)}}}r.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){var i=t.context,n=i.gl,r=e.heatmapFbo;if(r){i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);var o=e.colorRampTexture;o||(o=e.colorRampTexture=new fa(i,e.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),i.setDepthMode(jl.disabled);var a=t.useProgram("heatmapTexture"),s=e.paint.get("heatmap-opacity");n.uniform1f(a.uniforms.u_opacity,s),n.uniform1i(a.uniforms.u_image,0),n.uniform1i(a.uniforms.u_color_ramp,1);var l=Cs.create();Cs.ortho(l,0,t.width,t.height,0,0,1),n.uniformMatrix4fv(a.uniforms.u_matrix,!1,l),n.uniform2f(a.uniforms.u_world,n.drawingBufferWidth,n.drawingBufferHeight),t.viewportVAO.bind(t.context,a,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}(t,i))},line:function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("line-opacity").constantOr(1)){var r=t.context;r.setDepthMode(t.depthModeForSublayer(0,jl.ReadOnly)),r.setColorMode(t.colorModeForRenderPass());for(var o,a=i.paint.get("line-dasharray")?"lineSDF":i.paint.get("line-pattern")?"linePattern":"line",s=!0,l=0,u=n;l<u.length;l+=1){var c=u[l],h=e.getTile(c),p=h.getBucket(i);if(p){var f=p.programConfigurations.get(i.id),d=t.context.program.get(),m=t.useProgram(a,f),y=s||m.program!==d,g=o!==h.tileID.overscaledZ;y&&f.setUniforms(t.context,m,i.paint,{zoom:t.transform.zoom}),Xu(m,t,h,p,i,c,f,y,g),o=h.tileID.overscaledZ,s=!1}}}},fill:function(t,e,i,n){var r=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=t.context;a.setColorMode(t.colorModeForRenderPass());var s=i.paint.get("fill-pattern")||1!==r.constantOr(ft.transparent).a||1!==o.constantOr(0)?"translucent":"opaque";t.renderPass===s&&(a.setDepthMode(t.depthModeForSublayer(1,"opaque"===t.renderPass?jl.ReadWrite:jl.ReadOnly)),Yu(t,e,i,n,$u)),"translucent"===t.renderPass&&i.paint.get("fill-antialias")&&(a.lineWidth.set(2),a.setDepthMode(t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,jl.ReadOnly)),Yu(t,e,i,n,Qu))}},"fill-extrusion":function(t,e,i,n){if(0!==i.paint.get("fill-extrusion-opacity"))if("offscreen"===t.renderPass){!function(t,e){var i=t.context,n=i.gl,r=e.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!r){var o=new fa(i,{width:t.width,height:t.height,data:null},n.RGBA);o.bind(n.LINEAR,n.CLAMP_TO_EDGE),(r=e.viewportFrame=i.createFramebuffer(t.width,t.height)).colorAttachment.set(o.texture)}i.bindFramebuffer.set(r.framebuffer),r.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(i.clear({depth:1}),t.depthRboNeedsClear=!1),i.clear({color:ft.transparent}),i.setStencilMode(Vl.disabled),i.setDepthMode(new jl(n.LEQUAL,jl.ReadWrite,[0,1])),i.setColorMode(t.colorModeForRenderPass())}(t,i);for(var r=!0,o=0,a=n;o<a.length;o+=1){var s=a[o],l=e.getTile(s),u=l.getBucket(i);u&&(rc(t,0,i,l,s,u,r),r=!1)}}else"translucent"===t.renderPass&&function(t,e){var i=e.viewportFrame;if(i){var n=t.context,r=n.gl,o=t.useProgram("extrusionTexture");n.setStencilMode(Vl.disabled),n.setDepthMode(jl.disabled),n.setColorMode(t.colorModeForRenderPass()),n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),r.uniform1f(o.uniforms.u_opacity,e.paint.get("fill-extrusion-opacity")),r.uniform1i(o.uniforms.u_image,0);var a=ic.create();ic.ortho(a,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(o.uniforms.u_matrix,!1,a),r.uniform2f(o.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(n,o,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}(t,i)},hillshade:function(t,e,i,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var r=t.context;r.setDepthMode(t.depthModeForSublayer(0,jl.ReadOnly)),r.setStencilMode(Vl.disabled),r.setColorMode(t.colorModeForRenderPass());for(var o=0,a=n;o<a.length;o+=1){var s=a[o],l=e.getTile(s);l.needsHillshadePrepare&&"offscreen"===t.renderPass?ac(t,l):"translucent"===t.renderPass&&oc(t,l,i)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")){var r,o,a=t.context,s=a.gl,l=e.getSource(),u=t.useProgram("raster");a.setStencilMode(Vl.disabled),a.setColorMode(t.colorModeForRenderPass()),s.uniform1f(u.uniforms.u_brightness_low,i.paint.get("raster-brightness-min")),s.uniform1f(u.uniforms.u_brightness_high,i.paint.get("raster-brightness-max")),s.uniform1f(u.uniforms.u_saturation_factor,(r=i.paint.get("raster-saturation"))>0?1-1/(1.001-r):-r),s.uniform1f(u.uniforms.u_contrast_factor,(o=i.paint.get("raster-contrast"))>0?1/(1-o):1+o),s.uniform3fv(u.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint.get("raster-hue-rotate"))),s.uniform1f(u.uniforms.u_buffer_scale,1),s.uniform1i(u.uniforms.u_image0,0),s.uniform1i(u.uniforms.u_image1,1);for(var c=n.length&&n[0].overscaledZ,h=0,p=n;h<p.length;h+=1){var f=p[h];a.setDepthMode(t.depthModeForSublayer(f.overscaledZ-c,1===i.paint.get("raster-opacity")?jl.ReadWrite:jl.ReadOnly,s.LESS));var d=e.getTile(f),m=t.transform.calculatePosMatrix(f.toUnwrapped(),!0);d.registerFadeDuration(i.paint.get("raster-fade-duration")),s.uniformMatrix4fv(u.uniforms.u_matrix,!1,m);var y=e.findLoadedParent(f,0,{}),g=sc(d,y,e,i,t.transform),v=void 0,_=void 0;if(a.activeTexture.set(s.TEXTURE0),d.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.activeTexture.set(s.TEXTURE1),y?(y.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),v=Math.pow(2,y.tileID.overscaledZ-d.tileID.overscaledZ),_=[d.tileID.canonical.x*v%1,d.tileID.canonical.y*v%1]):d.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),s.uniform2fv(u.uniforms.u_tl_parent,_||[0,0]),s.uniform1f(u.uniforms.u_scale_parent,v||1),s.uniform1f(u.uniforms.u_fade_t,g.mix),s.uniform1f(u.uniforms.u_opacity,g.opacity*i.paint.get("raster-opacity")),l instanceof ms){var x=l.boundsBuffer;l.boundsVAO.bind(a,u,x,[]),s.drawArrays(s.TRIANGLE_STRIP,0,x.length)}else if(d.maskedBoundsBuffer&&d.maskedIndexBuffer&&d.segments)u.draw(a,s.TRIANGLES,i.id,d.maskedBoundsBuffer,d.maskedIndexBuffer,d.segments);else{var b=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(a,u,b,[]),s.drawArrays(s.TRIANGLE_STRIP,0,b.length)}}}},background:function(t,e,i){var n=i.paint.get("background-color"),r=i.paint.get("background-opacity");if(0!==r){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=i.paint.get("background-pattern"),c=u||1!==n.a||1!==r?"translucent":"opaque";if(t.renderPass===c){var h;if(o.setStencilMode(Vl.disabled),o.setDepthMode(t.depthModeForSublayer(0,"opaque"===c?jl.ReadWrite:jl.ReadOnly)),o.setColorMode(t.colorModeForRenderPass()),u){if(Hu(u,t))return;h=t.useProgram("backgroundPattern"),Ku(u,t,h),t.tileExtentPatternVAO.bind(o,h,t.tileExtentBuffer,[])}else h=t.useProgram("background"),a.uniform4fv(h.uniforms.u_color,[n.r,n.g,n.b,n.a]),t.tileExtentVAO.bind(o,h,t.tileExtentBuffer,[]);a.uniform1f(h.uniforms.u_opacity,r);for(var p=0,f=s.coveringTiles({tileSize:l});p<f.length;p+=1){var d=f[p];u&&Ju({tileID:d,tileSize:l},t,h),a.uniformMatrix4fv(h.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(d.toUnwrapped())),a.drawArrays(a.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}},debug:function(t,e,i){for(var n=0;n<i.length;n++)lc(t,e,i[n])}},hc=function(t,e){this.context=new Ul(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=ql.maxUnderzooming+ql.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new gn,this.crossTileSymbolIndex=new Eu};function pc(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function fc(t,e,i,n,r){var o=Math.max(i,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=t.dx>0,h=e.dx<0,p=o;p<a;p++){var f=l*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=u*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;r(Math.floor(d),Math.ceil(f),p)}}function dc(t,e,i,n,r,o){var a,s=pc(t,e),l=pc(e,i),u=pc(i,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>u.dy&&(a=s,s=u,u=a),l.dy>u.dy&&(a=l,l=u,u=a),s.dy&&fc(u,s,n,r,o),l.dy&&fc(u,l,n,r,o)}hc.prototype.resize=function(t,e){var i=this.context.gl;if(this.width=t*o.devicePixelRatio,this.height=e*o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,r=this.style._order;n<r.length;n+=1){var a=r[n];this.style._layers[a].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},hc.prototype.setup=function(){var t=this.context,e=new Di;e.emplaceBack(0,0),e.emplaceBack(xn,0),e.emplaceBack(0,xn),e.emplaceBack(xn,xn),this.tileExtentBuffer=t.createVertexBuffer(e,Pu.members),this.tileExtentVAO=new ds,this.tileExtentPatternVAO=new ds;var i=new Di;i.emplaceBack(0,0),i.emplaceBack(xn,0),i.emplaceBack(xn,xn),i.emplaceBack(0,xn),i.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(i,Pu.members),this.debugVAO=new ds;var n=new Ri;n.emplaceBack(0,0,0,0),n.emplaceBack(xn,0,xn,0),n.emplaceBack(0,xn,0,xn),n.emplaceBack(xn,xn,xn,xn),this.rasterBoundsBuffer=t.createVertexBuffer(n,fs.members),this.rasterBoundsVAO=new ds;var r=new Di;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,Pu.members),this.viewportVAO=new ds},hc.prototype.clearStencil=function(){var t=this.context,e=t.gl;t.setColorMode(Nl.disabled),t.setDepthMode(jl.disabled),t.setStencilMode(new Vl({func:e.ALWAYS,mask:0},0,255,e.ZERO,e.ZERO,e.ZERO));var i=Cs.create();Cs.ortho(i,0,this.width,this.height,0,0,1),Cs.scale(i,i,[e.drawingBufferWidth,e.drawingBufferHeight,0]);var n=this.useProgram("clippingMask");e.uniformMatrix4fv(n.uniforms.u_matrix,!1,i),this.viewportVAO.bind(t,n,this.viewportBuffer,[]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},hc.prototype._renderTileClippingMasks=function(t){var e=this.context,i=e.gl;e.setColorMode(Nl.disabled),e.setDepthMode(jl.disabled);var n=1;this._tileClippingMaskIDs={};for(var r=0,o=t;r<o.length;r+=1){var a=o[r],s=this._tileClippingMaskIDs[a.key]=n++;e.setStencilMode(new Vl({func:i.ALWAYS,mask:0},s,255,i.KEEP,i.KEEP,i.REPLACE));var l=this.useProgram("clippingMask");i.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.posMatrix),this.tileExtentVAO.bind(this.context,l,this.tileExtentBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,this.tileExtentBuffer.length)}},hc.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Vl({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},hc.prototype.colorModeForRenderPass=function(){var t=this.context.gl;if(this._showOverdrawInspector){return new Nl([t.CONSTANT_COLOR,t.ONE],new ft(1/8,1/8,1/8,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Nl.unblended:Nl.alphaBlended},hc.prototype.depthModeForSublayer=function(t,e,i){var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,r=n-1+this.depthRange;return new jl(i||this.context.gl.LEQUAL,e,[r,n])},hc.prototype.render=function(t,e){var i=this;for(var n in this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.now()),t.sourceCaches){var r=i.style.sourceCaches[n];r.used&&r.prepare(i.context)}var a=this.style._order,s=A(this.style.sourceCaches,function(t){return"raster"===t.getSource().type||"raster-dem"===t.getSource().type}),l=function(t){var e=s[t];!function(t,e){for(var i=t.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),n=0;n<i.length;n++){var r={},o=i[n],a=i.slice(n+1);ju(o.tileID.wrapped(),o.tileID,a,new us(0,o.tileID.wrap+1,0,0,0),r),o.setMask(r,e)}}(e.getVisibleCoordinates().map(function(t){return e.getTile(t)}),i.context)};for(var u in s)l(u);this.renderPass="offscreen";var c,h=[];this.depthRboNeedsClear=!0;for(var p=0;p<a.length;p++){var f=i.style._layers[a[p]];f.hasOffscreenPass()&&!f.isHidden(i.transform.zoom)&&(f.source!==(c&&c.id)&&(h=[],(c=i.style.sourceCaches[f.source])&&(h=c.getVisibleCoordinates()).reverse()),h.length&&i.renderLayer(i,c,f,h))}this.context.bindFramebuffer.set(null),this.context.clear({color:e.showOverdrawInspector?ft.black:ft.transparent,depth:1}),this._showOverdrawInspector=e.showOverdrawInspector,this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var d,m=[];for(this.currentLayer=a.length-1,this.currentLayer;this.currentLayer>=0;this.currentLayer--){var y=i.style._layers[a[i.currentLayer]];y.source!==(d&&d.id)&&(m=[],(d=i.style.sourceCaches[y.source])&&(i.clearStencil(),m=d.getVisibleCoordinates(),d.getSource().isTileClipped&&i._renderTileClippingMasks(m))),i.renderLayer(i,d,y,m)}this.renderPass="translucent";var g,v=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<a.length;this.currentLayer++){var _=i.style._layers[a[i.currentLayer]];_.source!==(g&&g.id)&&(v=[],(g=i.style.sourceCaches[_.source])&&(i.clearStencil(),v=g.getVisibleCoordinates(),g.getSource().isTileClipped&&i._renderTileClippingMasks(v)),v.reverse()),i.renderLayer(i,g,_,v)}if(this.options.showTileBoundaries){var x=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];x&&cc.debug(this,x,x.getVisibleCoordinates())}},hc.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},hc.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||n.length)&&(this.id=i.id,cc[i.type](t,e,i,n))},hc.prototype.translatePosMatrix=function(t,e,i,n,r){if(!i[0]&&!i[1])return t;var o=r?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){var a=Math.sin(o),s=Math.cos(o);i=[i[0]*s-i[1]*a,i[0]*a+i[1]*s]}var l=[r?i[0]:su(e,i[0],this.transform.zoom),r?i[1]:su(e,i[1],this.transform.zoom),0],u=new Float32Array(16);return Cs.translate(u,t,l),u},hc.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},hc.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},hc.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new Fu(this.context,Ou[t],e,this._showOverdrawInspector)),this.cache[i]},hc.prototype.useProgram=function(t,e){var i=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.context.program.set(i.program),i};var mc=Is.vec4,yc=Is.mat4,gc=Is.mat2,vc=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new Qa(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},_c={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},x:{configurable:!0},y:{configurable:!0},point:{configurable:!0}};vc.prototype.clone=function(){var t=new vc(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},_c.minZoom.get=function(){return this._minZoom},_c.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},_c.maxZoom.get=function(){return this._maxZoom},_c.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},_c.renderWorldCopies.get=function(){return this._renderWorldCopies},_c.worldSize.get=function(){return this.tileSize*this.scale},_c.centerPoint.get=function(){return this.size._div(2)},_c.size.get=function(){return new c(this.width,this.height)},_c.bearing.get=function(){return-this.angle/Math.PI*180},_c.bearing.set=function(t){var e=-y(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=gc.create(),gc.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},_c.pitch.get=function(){return this._pitch/Math.PI*180},_c.pitch.set=function(t){var e=m(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},_c.fov.get=function(){return this._fov/Math.PI*180},_c.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},_c.zoom.get=function(){return this._zoom},_c.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},_c.center.get=function(){return this._center},_c.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},vc.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},vc.prototype.getVisibleUnwrappedCoordinates=function(t){var e=this.pointCoordinate(new c(0,0),0),i=this.pointCoordinate(new c(this.width,0),0),n=Math.floor(e.column),r=Math.floor(i.column),o=[new ls(0,t)];if(this._renderWorldCopies)for(var a=n;a<=r;a++)0!==a&&o.push(new ls(a,t));return o},vc.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),i=e;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);var n=this.pointCoordinate(this.centerPoint,e),r=new c(n.column-.5,n.row-.5);return function(t,e,i,n){void 0===n&&(n=!0);var r=1<<t,o={};function a(e,a,s){var l,u,c;if(s>=0&&s<=r)for(l=e;l<a;l++)0!==(u=Math.floor(l/r))&&!0!==n||(c=new us(i,u,t,(l%r+r)%r,s),o[c.key]=c)}return dc(e[0],e[1],e[2],0,r,a),dc(e[2],e[3],e[0],0,r,a),Object.keys(o).map(function(t){return o[t]})}(e,[this.pointCoordinate(new c(0,0),e),this.pointCoordinate(new c(this.width,0),e),this.pointCoordinate(new c(this.width,this.height),e),this.pointCoordinate(new c(0,this.height),e)],t.reparseOverscaled?i:e,this._renderWorldCopies).sort(function(t,e){return r.dist(t.canonical)-r.dist(e.canonical)})},vc.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},_c.unmodified.get=function(){return this._unmodified},vc.prototype.zoomScale=function(t){return Math.pow(2,t)},vc.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},vc.prototype.project=function(t){return new c(this.lngX(t.lng),this.latY(t.lat))},vc.prototype.unproject=function(t){return new Qa(this.xLng(t.x),this.yLat(t.y))},_c.x.get=function(){return this.lngX(this.center.lng)},_c.y.get=function(){return this.latY(this.center.lat)},_c.point.get=function(){return new c(this.x,this.y)},vc.prototype.lngX=function(t){return(180+t)*this.worldSize/360},vc.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},vc.prototype.xLng=function(t){return 360*t/this.worldSize-180},vc.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},vc.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i)),this._renderWorldCopies&&(this.center=this.center.wrap())},vc.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},vc.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},vc.prototype.locationCoordinate=function(t){return new u(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},vc.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new Qa(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},vc.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];mc.transformMat4(i,i,this.pixelMatrixInverse),mc.transformMat4(n,n,this.pixelMatrixInverse);var r=i[3],o=n[3],a=i[1]/r,s=n[1]/o,l=i[2]/r,c=n[2]/o,h=l===c?0:(0-l)/(c-l);return new u(Ft(i[0]/r,n[0]/o,h)/this.tileSize,Ft(a,s,h)/this.tileSize,this.zoom)._zoomTo(e)},vc.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return mc.transformMat4(i,i,this.pixelMatrix),new c(i[0]/i[3],i[1]/i[3])},vc.prototype.calculatePosMatrix=function(t,e){void 0===e&&(e=!1);var i=t.key,n=e?this._alignedPosMatrixCache:this._posMatrixCache;if(n[i])return n[i];var r=t.canonical,o=this.worldSize/this.zoomScale(r.z),a=r.x+Math.pow(2,r.z)*t.wrap,s=yc.identity(new Float64Array(16));return yc.translate(s,s,[a*o,r.y*o,0]),yc.scale(s,s,[o/xn,o/xn,1]),yc.multiply(s,e?this.alignedProjMatrix:this.projMatrix,s),n[i]=new Float32Array(s),n[i]},vc.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,n,r=-90,o=90,a=-180,s=180,l=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;r=this.latY(h[1]),t=(o=this.latY(h[0]))-r<l.y?l.y/(o-r):0}if(this.lngRange){var p=this.lngRange;a=this.lngX(p[0]),e=(s=this.lngX(p[1]))-a<l.x?l.x/(s-a):0}var f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new c(e?(s+a)/2:this.x,t?(o+r)/2:this.y)),this.zoom+=this.scaleZoom(f),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var d=this.y,m=l.y/2;d-m<r&&(n=r+m),d+m>o&&(n=o-m)}if(this.lngRange){var y=this.x,g=l.x/2;y-g<a&&(i=a+g),y+g>s&&(i=s-g)}void 0===i&&void 0===n||(this.center=this.unproject(new c(void 0!==i?i:this.x,void 0!==n?n:this.y))),this._unmodified=u,this._constraining=!1}},vc.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),n=this.x,r=this.y,o=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),a=new Float64Array(16);yc.perspective(a,this._fov,this.width/this.height,1,o),yc.scale(a,a,[1,-1,1]),yc.translate(a,a,[0,0,-this.cameraToCenterDistance]),yc.rotateX(a,a,this._pitch),yc.rotateZ(a,a,this.angle),yc.translate(a,a,[-n,-r,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));yc.scale(a,a,[1,1,s,1]),this.projMatrix=a;var l=this.width%2/2,u=this.height%2/2,c=Math.cos(this.angle),h=Math.sin(this.angle),p=n-Math.round(n)+c*l+h*u,f=r-Math.round(r)+c*u+h*l,d=new Float64Array(a);if(yc.translate(d,d,[p>.5?p-1:p,f>.5?f-1:f,0]),this.alignedProjMatrix=d,a=yc.create(),yc.scale(a,a,[this.width/2,-this.height/2,1]),yc.translate(a,a,[1,-1,0]),this.pixelMatrix=yc.multiply(new Float64Array(16),a,this.projMatrix),!(a=yc.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Object.defineProperties(vc.prototype,_c);var xc=function(){var t,e,i,n,r;T(["_onHashChange","_updateHash"],this),this._updateHash=(t=this._updateHashUnthrottled.bind(this),e=300,i=!1,n=0,r=function(){n=0,i&&(t(),n=setTimeout(r,e),i=!1)},function(){return i=!0,n||r(),n})};xc.prototype.addTo=function(t){return this._map=t,self.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},xc.prototype.remove=function(){return self.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},xc.prototype.getHashString=function(t){var e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,n),o=Math.round(e.lng*r)/r,a=Math.round(e.lat*r)/r,s=this._map.getBearing(),l=this._map.getPitch(),u="";return u+=t?"#/"+o+"/"+a+"/"+i:"#"+i+"/"+a+"/"+o,(s||l)&&(u+="/"+Math.round(10*s)/10),l&&(u+="/"+Math.round(l)),u},xc.prototype._onHashChange=function(){var t=self.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},xc.prototype._updateHashUnthrottled=function(){var t=this.getHashString();self.history.replaceState("","",t)};var bc=self.navigator.userAgent.toLowerCase(),wc=-1!==bc.indexOf("firefox"),Tc=-1!==bc.indexOf("safari")&&-1===bc.indexOf("chrom"),Sc=function(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,T(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};Sc.prototype.isEnabled=function(){return!!this._enabled},Sc.prototype.isActive=function(){return!!this._active},Sc.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},Sc.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},Sc.prototype._onWheel=function(t){var e=0;"wheel"===t.type?(e=t.deltaY,wc&&t.deltaMode===self.WheelEvent.DOM_DELTA_PIXEL&&(e/=o.devicePixelRatio),t.deltaMode===self.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,Tc&&(e/=3));var i=o.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%4.000244140625==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this.isActive()||this._start(t)),t.preventDefault()},Sc.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},Sc.prototype._start=function(t){if(this._delta){this._active=!0,this._map.moving=!0,this._map.zooming=!0,this._map.fire("movestart",{originalEvent:t}),this._map.fire("zoomstart",{originalEvent:t}),clearTimeout(this._finishTimeout);var e=L.mousePos(this._el,t);this._around=Qa.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(e)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._map._startAnimation(this._onScrollFrame,this._onScrollFinished)}},Sc.prototype._onScrollFrame=function(t){if(this.isActive()){if(0!==this._delta){var e="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);var n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*i))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}if("wheel"===this._type){var r=Math.min((o.now()-this._lastWheelEventTime)/200,1),a=this._easing(r);t.zoom=Ft(this._startZoom,this._targetZoom,a),1===r&&this._map.stop()}else t.zoom=this._targetZoom,this._map.stop();t.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire("move",{originalEvent:this._lastWheelEvent}),this._map.fire("zoom",{originalEvent:this._lastWheelEvent})}},Sc.prototype._onScrollFinished=function(){var t=this;this.isActive()&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._map.moving=!1,t._map.zooming=!1,t._map.fire("zoomend"),t._map.fire("moveend"),delete t._targetZoom},200))},Sc.prototype._smoothOutEasing=function(t){var e=d;if(this._prevEase){var i=this._prevEase,n=(o.now()-i.start)/i.duration,r=i.easing(n+.01)-i.easing(n),a=.27/Math.sqrt(r*r+1e-4)*.01;e=f(a,Math.sqrt(.0729-a*a),.25,1)}return this._prevEase={start:o.now(),duration:t,easing:e},e};var zc=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),T(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};zc.prototype.isEnabled=function(){return!!this._enabled},zc.prototype.isActive=function(){return!!this._active},zc.prototype.enable=function(){this.isEnabled()||(this._map.dragPan&&this._map.dragPan.disable(),this._el.addEventListener("mousedown",this._onMouseDown,!1),this._map.dragPan&&this._map.dragPan.enable(),this._enabled=!0)},zc.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},zc.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(self.document.addEventListener("mousemove",this._onMouseMove,!1),self.document.addEventListener("keydown",this._onKeyDown,!1),self.document.addEventListener("mouseup",this._onMouseUp,!1),L.disableDrag(),this._startPos=L.mousePos(this._el,t),this._active=!0)},zc.prototype._onMouseMove=function(t){var e=this._startPos,i=L.mousePos(this._el,t);this._box||(this._box=L.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),o=Math.min(e.y,i.y),a=Math.max(e.y,i.y);L.setTransform(this._box,"translate("+n+"px,"+o+"px)"),this._box.style.width=r-n+"px",this._box.style.height=a-o+"px"},zc.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,i=L.mousePos(this._el,t),n=(new ts).extend(this._map.unproject(e)).extend(this._map.unproject(i));this._finish(),e.x===i.x&&e.y===i.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(n,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:n})}},zc.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},zc.prototype._finish=function(){this._active=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!1),self.document.removeEventListener("keydown",this._onKeyDown,!1),self.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag()},zc.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})};var Ac=f(0,0,.25,1),kc=function(t,e){this._map=t,this._el=e.element||t.getCanvasContainer(),this._button=e.button||"right",this._bearingSnap=e.bearingSnap||0,this._pitchWithRotate=!1!==e.pitchWithRotate,T(["_onDown","_onMove","_onUp","_onDragFrame","_onDragFinished"],this)};kc.prototype.isEnabled=function(){return!!this._enabled},kc.prototype.isActive=function(){return!!this._active},kc.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},kc.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},kc.prototype._onDown=function(t){if(!(this._map.boxZoom&&this._map.boxZoom.isActive()||this._map.dragPan&&this._map.dragPan.isActive()||this.isActive())){if("right"===this._button){var e=t.ctrlKey?0:2,i=t.button;if(void 0!==self.InstallTrigger&&2===t.button&&t.ctrlKey&&self.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(i=0),i!==e)return}else if(t.ctrlKey||0!==t.button)return;L.disableDrag(),self.document.addEventListener("mousemove",this._onMove,{capture:!0}),self.document.addEventListener("mouseup",this._onUp),self.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[o.now(),this._map.getBearing()]],this._startPos=this._previousPos=L.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault()}},kc.prototype._onMove=function(t){this._lastMoveEvent=t,this._pos=L.mousePos(this._el,t),this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t),this._map._startAnimation(this._onDragFrame,this._onDragFinished)),this._map._update()},kc.prototype._onUp=function(t){self.document.removeEventListener("mousemove",this._onMove,{capture:!0}),self.document.removeEventListener("mouseup",this._onUp),self.removeEventListener("blur",this._onUp),L.enableDrag(),this._onDragFinished(t)},kc.prototype._onDragFrame=function(t){var e=this._lastMoveEvent;if(e){var i=this._previousPos,n=this._pos,r=.8*(i.x-n.x),a=-.5*(i.y-n.y),s=t.bearing-r,l=t.pitch-a,u=this._inertia,c=u[u.length-1];this._drainInertiaBuffer(),u.push([o.now(),this._map._normalizeBearing(s,c[1])]),t.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",e),t.pitch=l),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._previousPos=this._pos}},kc.prototype._onDragFinished=function(t){var e=this;if(this.isActive()){this._active=!1,delete this._lastMoveEvent,delete this._previousPos,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,o=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t)),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(r.length<2)o();else{var a=r[0],s=r[r.length-1],l=r[r.length-2],u=i._normalizeBearing(n,l[1]),c=s[1]-a[1],h=c<0?-1:1,p=(s[0]-a[0])/1e3;if(0!==c&&0!==p){var f=Math.abs(c*(.25/p));f>180&&(f=180);var d=f/180;u+=h*f*(d/2),Math.abs(i._normalizeBearing(u,0))<this._bearingSnap&&(u=i._normalizeBearing(0,u)),i.rotateTo(u,{duration:1e3*d,easing:Ac,noMoveStart:!0},{originalEvent:t})}else o()}}},kc.prototype._fireEvent=function(t,e){return this._map.fire(t,e?{originalEvent:e}:{})},kc.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=o.now();t.length>0&&e-t[0][0]>160;)t.shift()};var Ec=f(0,0,.3,1),Ic=function(t){this._map=t,this._el=t.getCanvasContainer(),T(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp","_onDragFrame","_onDragFinished"],this)};Ic.prototype.isEnabled=function(){return!!this._enabled},Ic.prototype.isActive=function(){return!!this._active},Ic.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},Ic.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},Ic.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(self.document.addEventListener("touchmove",this._onMove),self.document.addEventListener("touchend",this._onTouchEnd)):(self.document.addEventListener("mousemove",this._onMove),self.document.addEventListener("mouseup",this._onMouseUp)),self.addEventListener("blur",this._onMouseUp),this._active=!1,this._startPos=this._previousPos=L.mousePos(this._el,t),this._inertia=[[o.now(),this._startPos]])},Ic.prototype._onMove=function(t){this._ignoreEvent(t)||(this._lastMoveEvent=t,t.preventDefault(),this._pos=L.mousePos(this._el,t),this._drainInertiaBuffer(),this._inertia.push([o.now(),this._pos]),this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._map._startAnimation(this._onDragFrame,this._onDragFinished)),this._map._update())},Ic.prototype._onDragFrame=function(t){var e=this._lastMoveEvent;e&&(t.setLocationAtPoint(t.pointLocation(this._previousPos),this._pos),this._fireEvent("drag",e),this._fireEvent("move",e),this._previousPos=this._pos,delete this._lastMoveEvent)},Ic.prototype._onDragFinished=function(t){var e=this;if(this.isActive()){this._active=!1,delete this._lastMoveEvent,delete this._startPos,delete this._previousPos,delete this._pos,this._fireEvent("dragend",t),this._drainInertiaBuffer();var i=function(){e._map.moving=!1,e._fireEvent("moveend",t)},n=this._inertia;if(n.length<2)i();else{var r=n[n.length-1],o=n[0],a=r[1].sub(o[1]),s=(r[0]-o[0])/1e3;if(0===s||r[1].equals(o[1]))i();else{var l=a.mult(.3/s),u=l.mag();u>1400&&(u=1400,l._unit()._mult(u));var c=u/750,h=l.mult(-c/2);this._map.panBy(h,{duration:1e3*c,easing:Ec,noMoveStart:!0},{originalEvent:t})}}}},Ic.prototype._onUp=function(t){this._onDragFinished(t)},Ic.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),self.document.removeEventListener("mousemove",this._onMove),self.document.removeEventListener("mouseup",this._onMouseUp),self.removeEventListener("blur",this._onMouseUp))},Ic.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),self.document.removeEventListener("touchmove",this._onMove),self.document.removeEventListener("touchend",this._onTouchEnd))},Ic.prototype._fireEvent=function(t,e){return this._map.fire(t,e?{originalEvent:e}:{})},Ic.prototype._ignoreEvent=function(t){var e=this._map;return!(!e.boxZoom||!e.boxZoom.isActive())||(!(!e.dragRotate||!e.dragRotate.isActive())||(t.touches?t.touches.length>1:!!t.ctrlKey||"mousemove"!==t.type&&t.button&&0!==t.button))},Ic.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=o.now();t.length>0&&e-t[0][0]>160;)t.shift()};var Mc=function(t){this._map=t,this._el=t.getCanvasContainer(),T(["_onKeyDown"],this)};function Cc(t){return t*(2-t)}Mc.prototype.isEnabled=function(){return!!this._enabled},Mc.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},Mc.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},Mc.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),l={duration:300,delayEndEvents:500,easing:Cc,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*i,pitch:a.getPitch()+10*n,offset:[100*-r,100*-o],center:a.getCenter()};a.easeTo(l,{originalEvent:t})}};var Pc=function(t){this._map=t,T(["_onDblClick","_onZoomEnd"],this)};Pc.prototype.isEnabled=function(){return!!this._enabled},Pc.prototype.isActive=function(){return!!this._active},Pc.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},Pc.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},Pc.prototype._onDblClick=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Pc.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Lc=f(0,0,.15,1),Dc=function(t){this._map=t,this._el=t.getCanvasContainer(),T(["_onStart","_onMove","_onEnd"],this)};Dc.prototype.isEnabled=function(){return!!this._enabled},Dc.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},Dc.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},Dc.prototype.disableRotation=function(){this._rotationDisabled=!0},Dc.prototype.enableRotation=function(){this._rotationDisabled=!1},Dc.prototype._onStart=function(t){if(2===t.touches.length){var e=L.mousePos(this._el,t.touches[0]),i=L.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],self.document.addEventListener("touchmove",this._onMove,!1),self.document.addEventListener("touchend",this._onEnd,!1)}},Dc.prototype._onMove=function(t){if(2===t.touches.length){var e=L.mousePos(this._el,t.touches[0]),i=L.mousePos(this._el,t.touches[1]),n=e.add(i).div(2),r=e.sub(i),a=r.mag()/this._startVec.mag(),s=this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI,l=this._map;if(this._gestureIntent){var u={duration:0,around:l.unproject(n)};"rotate"===this._gestureIntent&&(u.bearing=this._startBearing+s),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(u.zoom=l.transform.scaleZoom(this._startScale*a)),l.stop(),this._drainInertiaBuffer(),this._inertia.push([o.now(),a,n]),l.easeTo(u,{originalEvent:t})}else{var c=Math.abs(1-a)>.15;Math.abs(s)>10?this._gestureIntent="rotate":c&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=r,this._startScale=l.transform.scale,this._startBearing=l.transform.bearing)}t.preventDefault()}},Dc.prototype._onEnd=function(t){self.document.removeEventListener("touchmove",this._onMove),self.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,i=this._map;if(e.length<2)i.snapToNorth({},{originalEvent:t});else{var n=e[e.length-1],r=e[0],o=i.transform.scaleZoom(this._startScale*n[1]),a=i.transform.scaleZoom(this._startScale*r[1]),s=o-a,l=(n[0]-r[0])/1e3,u=n[2];if(0!==l&&o!==a){var c=.15*s/l;Math.abs(c)>2.5&&(c=c>0?2.5:-2.5);var h=1e3*Math.abs(c/(12*.15)),p=o+c*h/2e3;p<0&&(p=0),i.easeTo({zoom:p,duration:h,easing:Lc,around:this._aroundCenter?i.getCenter():i.unproject(u)},{originalEvent:t})}else i.snapToNorth({},{originalEvent:t})}},Dc.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=o.now();t.length>2&&e-t[0][0]>160;)t.shift()};var Rc={scrollZoom:Sc,boxZoom:zc,dragRotate:kc,dragPan:Ic,keyboard:Mc,doubleClickZoom:Pc,touchZoomRotate:Dc};var Bc=function(t){function e(e,i){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=i.bearingSnap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},e.prototype.panBy=function(t,e,i){return t=c.convert(t).mult(-1),this.panTo(this.transform.center,_({offset:t},e),i)},e.prototype.panTo=function(t,e,i){return this.easeTo(_({center:t},e),i)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,i){return this.easeTo(_({zoom:t},e),i)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,i){return this.easeTo(_({bearing:t},e),i)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,_({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,i){if("number"==typeof(e=_({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){var n=e.padding;e.padding={top:n,bottom:n,right:n,left:n}}if(!p(Object.keys(e.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"]))return M("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'"),this;t=ts.convert(t);var r=[(e.padding.left-e.padding.right)/2,(e.padding.top-e.padding.bottom)/2],o=Math.min(e.padding.right,e.padding.left),a=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+r[0],e.offset[1]+r[1]];var s=c.convert(e.offset),l=this.transform,u=l.project(t.getNorthWest()),h=l.project(t.getSouthEast()),f=h.sub(u),d=(l.width-2*o-2*Math.abs(s.x))/f.x,m=(l.height-2*a-2*Math.abs(s.y))/f.y;return m<0||d<0?(M("Map cannot fit within canvas with the given bounds, padding, and/or offset."),this):(e.center=l.unproject(u.add(h).div(2)),e.zoom=Math.min(l.scaleZoom(l.scale*Math.min(d,m)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,i):this.flyTo(e,i))},e.prototype.jumpTo=function(t,e){this.stop();var i=this.transform,n=!1,r=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=Qa.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),n&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),r&&this.fire("rotate",e),o&&this.fire("pitchstart",e).fire("pitch",e).fire("pitchend",e),this.fire("moveend",e)},e.prototype.easeTo=function(t,e){var i=this;this.stop(),!1===(t=_({offset:[0,0],duration:500,easing:d},t)).animate&&(t.duration=0);var n=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s="zoom"in t?+t.zoom:r,l="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,h=n.centerPoint.add(c.convert(t.offset)),p=n.pointLocation(h),f=Qa.convert(t.center||p);this._normalizeCenter(f);var m,y,g=n.project(p),v=n.project(f).sub(g),x=n.zoomScale(s-r);return t.around&&(m=Qa.convert(t.around),y=n.locationPoint(m)),this.zooming=s!==r,this.rotating=o!==l,this.pitching=u!==a,this._prepareEase(e,t.noMoveStart),clearTimeout(this._onEaseEnd),this._ease(function(t){if(i.zooming&&(n.zoom=Ft(r,s,t)),i.rotating&&(n.bearing=Ft(o,l,t)),i.pitching&&(n.pitch=Ft(a,u,t)),m)n.setLocationAtPoint(m,y);else{var c=n.zoomScale(n.zoom-r),p=s>r?Math.min(2,x):Math.max(.5,x),f=Math.pow(p,1-t),d=n.unproject(g.add(v.mult(t*f)).mult(c));n.setLocationAtPoint(n.renderWorldCopies?d.wrap():d,h)}i._fireMoveEvents(e)},function(){t.delayEndEvents?i._onEaseEnd=setTimeout(function(){return i._afterEase(e)},t.delayEndEvents):i._afterEase(e)},t),this},e.prototype._prepareEase=function(t,e){this.moving=!0,e||this.fire("movestart",t),this.zooming&&this.fire("zoomstart",t),this.pitching&&this.fire("pitchstart",t)},e.prototype._fireMoveEvents=function(t){this.fire("move",t),this.zooming&&this.fire("zoom",t),this.rotating&&this.fire("rotate",t),this.pitching&&this.fire("pitch",t)},e.prototype._afterEase=function(t){var e=this.zooming,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),i&&this.fire("pitchend",t),this.fire("moveend",t)},e.prototype.flyTo=function(t,e){var i=this;this.stop(),t=_({offset:[0,0],speed:1.2,curve:1.42,easing:d},t);var n=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s="zoom"in t?m(+t.zoom,n.minZoom,n.maxZoom):r,l="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,h=n.zoomScale(s-r),p=n.centerPoint.add(c.convert(t.offset)),f=n.pointLocation(p),y=Qa.convert(t.center||f);this._normalizeCenter(y);var g=n.project(f),v=n.project(y).sub(g),x=t.curve,b=Math.max(n.width,n.height),w=b/h,T=v.mag();if("minZoom"in t){var S=m(Math.min(t.minZoom,r,s),n.minZoom,n.maxZoom),z=b/n.zoomScale(S-r);x=Math.sqrt(z/T*2)}var A=x*x;function k(t){var e=(w*w-b*b+(t?-1:1)*A*A*T*T)/(2*(t?w:b)*A*T);return Math.log(Math.sqrt(e*e+1)-e)}function E(t){return(Math.exp(t)-Math.exp(-t))/2}function I(t){return(Math.exp(t)+Math.exp(-t))/2}var M=k(0),C=function(t){return I(M)/I(M+x*t)},P=function(t){return b*((I(M)*(E(e=M+x*t)/I(e))-E(M))/A)/T;var e},L=(k(1)-M)/x;if(Math.abs(T)<1e-6||!isFinite(L)){if(Math.abs(b-w)<1e-6)return this.easeTo(t,e);var D=w<b?-1:1;L=Math.abs(Math.log(w/b))/x,P=function(){return 0},C=function(t){return Math.exp(D*x*t)}}if("duration"in t)t.duration=+t.duration;else{var R="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*L/R}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=o!==l,this.pitching=u!==a,this._prepareEase(e,!1),this._ease(function(t){var s=t*L,c=1/C(s);n.zoom=r+n.scaleZoom(c),i.rotating&&(n.bearing=Ft(o,l,t)),i.pitching&&(n.pitch=Ft(a,u,t));var h=n.unproject(g.add(v.mult(P(s))).mult(c));n.setLocationAtPoint(n.renderWorldCopies?h.wrap():h,p),i._fireMoveEvents(e)},function(){return i._afterEase(e)},t),this},e.prototype.isEasing=function(){return!!this._isEasing},e.prototype.isMoving=function(){return this.moving},e.prototype.stop=function(){return this._onFrame&&this._finishAnimation(),this},e.prototype._ease=function(t,e,i){var n=this;!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=o.now(),this._isEasing=!0,this._easeOptions=i,this._startAnimation(function(e){var i=Math.min((o.now()-n._easeStart)/n._easeOptions.duration,1);t(n._easeOptions.easing(i)),1===i&&n.stop()},function(){n._isEasing=!1,e()}))},e.prototype._updateCamera=function(){this._onFrame&&this._onFrame(this.transform)},e.prototype._startAnimation=function(t,e){return void 0===e&&(e=function(){}),this.stop(),this._onFrame=t,this._finishFn=e,this._update(),this},e.prototype._finishAnimation=function(){delete this._onFrame;var t=this._finishFn;delete this._finishFn,t.call(this)},e.prototype._normalizeBearing=function(t,e){t=y(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},e.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}},e}(H),Oc=function(t){this.options=t,T(["_updateEditLink","_updateData","_updateCompact"],this)};Oc.prototype.getDefaultPosition=function(){return"bottom-right"},Oc.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Oc.prototype.onRemove=function(){L.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},Oc.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var e=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:Ho.ACCESS_TOKEN}];if(t){var i=e.reduce(function(t,i,n){return i.value&&(t+=i.key+"="+i.value+(n<e.length-1?"&":"")),t},"?");t.href="https://www.mapbox.com/feedback/"+i+(this._map._hash?this._map._hash.getHashString(!0):"")}},Oc.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},Oc.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var i=this._map.style.sourceCaches;for(var n in i){var r=i[n].getSource();r.attribution&&t.indexOf(r.attribution)<0&&t.push(r.attribution)}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,i){for(var n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})).length?(this._container.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},Oc.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Fc=function(){T(["_updateLogo"],this)};Fc.prototype.onAdd=function(t){this._map=t,this._container=L.create("div","mapboxgl-ctrl");var e=L.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},Fc.prototype.onRemove=function(){L.remove(this._container),this._map.off("sourcedata",this._updateLogo)},Fc.prototype.getDefaultPosition=function(){return"bottom-left"},Fc.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Fc.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t){if(t[e].getSource().mapbox_logo)return!0}return!1}};var jc=self.HTMLImageElement,Vc=self.HTMLElement,Nc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300},Uc=function(t){function i(e){if(null!=(e=_({},Nc,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var i=new vc(e.minZoom,e.maxZoom,e.renderWorldCopies);t.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming;var n=e.transformRequest;if(this._transformRequest=n?function(t,e){return n(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof e.container){var r=self.document.getElementById(e.container);if(!r)throw new Error("Container '"+e.container+"' not found.");this._container=r}else{if(!(e.container instanceof Vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}e.maxBounds&&this.setMaxBounds(e.maxBounds),T(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),"undefined"!=typeof self&&(self.addEventListener("online",this._onWindowOnline,!1),self.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var i=t.getCanvasContainer(),n=null,r=!1,o=null,a=null;for(var s in Rc)t[s]=new Rc[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);function l(){a=null}function u(e,n){var r=L.mousePos(i,n);return t.fire(e,{lngLat:t.unproject(r),point:r,originalEvent:n})}function h(e,n){var r=L.touchPos(i,n),o=r.reduce(function(t,e,i,n){return t.add(e.div(n.length))},new c(0,0));return t.fire(e,{lngLat:t.unproject(o),point:o,lngLats:r.map(function(e){return t.unproject(e)},this),points:r,originalEvent:n})}i.addEventListener("mouseout",function(t){u("mouseout",t)},!1),i.addEventListener("mousedown",function(e){t.doubleClickZoom.isActive()||t.stop(),o=L.mousePos(i,e),u("mousedown",e),r=!0},!1),i.addEventListener("mouseup",function(e){var i=t.dragRotate&&t.dragRotate.isActive();n&&!i&&u("contextmenu",n),n=null,r=!1,u("mouseup",e)},!1),i.addEventListener("mousemove",function(e){if(!(t.dragPan&&t.dragPan.isActive()||t.dragRotate&&t.dragRotate.isActive())){for(var n=e.toElement||e.target;n&&n!==i;)n=n.parentNode;n===i&&u("mousemove",e)}},!1),i.addEventListener("mouseover",function(t){for(var e=t.toElement||t.target;e&&e!==i;)e=e.parentNode;e===i&&u("mouseover",t)},!1),i.addEventListener("touchstart",function(e){t.stop(),h("touchstart",e),!e.touches||e.touches.length>1||(a?(clearTimeout(a),a=null,u("dblclick",e)):a=setTimeout(l,300))},!1),i.addEventListener("touchend",function(t){h("touchend",t)},!1),i.addEventListener("touchmove",function(t){h("touchmove",t)},!1),i.addEventListener("touchcancel",function(t){h("touchcancel",t)},!1),i.addEventListener("click",function(t){L.mousePos(i,t).equals(o)&&u("click",t)},!1),i.addEventListener("dblclick",function(t){u("dblclick",t),t.preventDefault()},!1),i.addEventListener("contextmenu",function(e){var i=t.dragRotate&&t.dragRotate.isActive();r||i?r&&(n=e):u("contextmenu",e),e.preventDefault()},!1)}(this,e),this._hash=e.hash&&(new xc).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this.resize(),e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Oc),this.addControl(new Fc,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var n={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return i.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),n=this._controlPositions[e];return-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},i.prototype.removeControl=function(t){return t.onRemove(this),this},i.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],i=t[1];return this._resizeCanvas(e,i),this.transform.resize(e,i),this.painter.resize(e,i),this.fire("movestart").fire("move").fire("resize").fire("moveend")},i.prototype.getBounds=function(){var t=new ts(this.transform.pointLocation(new c(0,this.transform.height)),this.transform.pointLocation(new c(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new c(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new c(0,this.transform.size.y)))),t},i.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new ts([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},i.prototype.setMaxBounds=function(t){if(t){var e=ts.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null==t&&(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},i.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.project=function(t){return this.transform.locationPoint(Qa.convert(t))},i.prototype.unproject=function(t){return this.transform.pointLocation(c.convert(t))},i.prototype.on=function(e,i,n){var r,o=this;if(void 0===n)return t.prototype.on.call(this,e,i);var a=function(){if("mouseenter"===e||"mouseover"===e){var t=!1;return{layer:i,listener:n,delegates:{mousemove:function(r){var a=o.getLayer(i)?o.queryRenderedFeatures(r.point,{layers:[i]}):[];a.length?t||(t=!0,n.call(o,_({features:a},r,{type:e}))):t=!1},mouseout:function(){t=!1}}}}if("mouseleave"===e||"mouseout"===e){var a=!1;return{layer:i,listener:n,delegates:{mousemove:function(t){(o.getLayer(i)?o.queryRenderedFeatures(t.point,{layers:[i]}):[]).length?a=!0:a&&(a=!1,n.call(o,_({},t,{type:e})))},mouseout:function(t){a&&(a=!1,n.call(o,_({},t,{type:e})))}}}}return{layer:i,listener:n,delegates:(r={},r[e]=function(t){var e=o.getLayer(i)?o.queryRenderedFeatures(t.point,{layers:[i]}):[];e.length&&n.call(o,_({features:e},t))},r)}}();for(var s in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(a),a.delegates)o.on(s,a.delegates[s]);return this},i.prototype.off=function(e,i,n){if(void 0===n)return t.prototype.off.call(this,e,i);if(this._delegatedListeners&&this._delegatedListeners[e])for(var r=this._delegatedListeners[e],o=0;o<r.length;o++){var a=r[o];if(a.layer===i&&a.listener===n){for(var s in a.delegates)this.off(s,a.delegates[s]);return r.splice(o,1),this}}return this},i.prototype.queryRenderedFeatures=function(t,e){var i;return 2===arguments.length?(t=arguments[0],e=arguments[1]):1===arguments.length&&((i=arguments[0])instanceof c||Array.isArray(i))?(t=arguments[0],e={}):1===arguments.length?(t=void 0,e=arguments[0]):(t=void 0,e={}),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform.zoom,this.transform.angle):[]},i.prototype._makeQueryGeometry=function(t){var e,i=this;if(void 0===t&&(t=[c.convert([0,0]),c.convert([this.transform.width,this.transform.height])]),t instanceof c||"number"==typeof t[0]){e=[c.convert(t)]}else{var n=[c.convert(t[0]),c.convert(t[1])];e=[n[0],new c(n[1].x,n[0].y),n[1],new c(n[0].x,n[1].y),n[0]]}return e=e.map(function(t){return i.transform.pointCoordinate(t)})},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(t,e){if((!e||!1!==e.diff&&!e.localIdeographFontFamily)&&this.style&&t&&"object"==typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){M("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Cu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():M("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},i.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];if(void 0!==e)return e.loaded();this.fire("error",{error:new Error("There is no source with ID '"+t+"'")})},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var n in i){var r=i[n];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(t,e,i){void 0===i&&(i={});var n=i.pixelRatio;void 0===n&&(n=1);var r=i.sdf;if(void 0===r&&(r=!1),e instanceof jc){var a=o.getImageData(e),s=a.width,l=a.height,u=a.data;this.style.addImage(t,{data:new Xn({width:s,height:l},u),pixelRatio:n,sdf:r})}else{if(void 0===e.width||void 0===e.height)return this.fire("error",{error:new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")});var c=e.width,h=e.height,p=e.data;this.style.addImage(t,{data:new Xn({width:c,height:h},p.slice(0)),pixelRatio:n,sdf:r})}},i.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire("error",{error:new Error("Missing required image id")}),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(t,e){G(this._transformRequest(t,V.Image),e)},i.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},i.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,i){return this.style.setPaintProperty(t,e,i),this._update(!0),this},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSContainer=L.create("div","mapboxgl-missing-css",t)).innerHTML="Missing Mapbox GL JS CSS";var e=this._canvasContainer=L.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=L.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=L.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=L.create("div","mapboxgl-ctrl-"+t,n)})},i.prototype._resizeCanvas=function(t,e){var i=self.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},i.prototype._setupPainter=function(){var t=_({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},e.webGLContextAttributes),i=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);i?this.painter=new hc(i,this.transform):this.fire("error",{error:new Error("Failed to initialize WebGL")})},i.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&(o.cancelFrame(this._frameId),this._frameId=null),this.fire("webglcontextlost",{originalEvent:t})},i.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},i.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender())},i.prototype._render=function(){this._updateCamera();var t=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var e=this.transform.zoom,i=o.now();this.style.zoomHistory.update(e,i);var n=new ao(e,{now:i,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=n.crossFadingFactor();1===r&&r===this._crossFadingFactor||(t=!0,this._crossFadingFactor=r),this.style.update(n)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming,fadeDuration:this._fadeDuration}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this._rerender(),this},i.prototype.remove=function(){this._hash&&this._hash.remove(),o.cancelFrame(this._frameId),this._frameId=null,this.setStyle(null),"undefined"!=typeof self&&(self.removeEventListener("resize",this._onWindowResize,!1),self.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),qc(this._canvasContainer),qc(this._controlContainer),qc(this._missingCSSContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},i.prototype._rerender=function(){var t=this;this.style&&!this._frameId&&(this._frameId=o.frame(function(){t._frameId=null,t._render()}))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},n.showTileBoundaries.get=function(){return!!this._showTileBoundaries},n.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},n.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},n.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},n.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},n.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},n.repaint.get=function(){return!!this._repaint},n.repaint.set=function(t){this._repaint=t,this._update()},n.vertices.get=function(){return!!this._vertices},n.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},i.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(i.prototype,n),i}(Bc);function qc(t){t.parentNode&&t.parentNode.removeChild(t)}var Zc={showCompass:!0,showZoom:!0},Gc=function(t){var e=this;this.options=_({},Zc,t),this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom In",function(){return e._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom Out",function(){return e._map.zoomOut()})),this.options.showCompass&&(T(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset North",function(){return e._map.resetNorth()}),this._compassArrow=L.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function Wc(t,e,i){if(t=new Qa(t.lng,t.lat),e){var n=new Qa(t.lng-360,t.lat),r=new Qa(t.lng+360,t.lat),o=i.locationPoint(t).distSqr(e);i.locationPoint(n).distSqr(e)<o?t=n:i.locationPoint(r).distSqr(e)<o&&(t=r)}for(;Math.abs(t.lng-i.center.lng)>180;){var a=i.locationPoint(t);if(a.x>=0&&a.y>=0&&a.x<=i.width&&a.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}Gc.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Gc.prototype.onAdd=function(t){return this._map=t,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kc(t,{button:"left",element:this._compass}),this._handler.enable()),this._container},Gc.prototype.onRemove=function(){L.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._handler.disable(),delete this._handler),delete this._map},Gc.prototype._createButton=function(t,e,i){var n=L.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",e),n.addEventListener("click",i),n};var Xc=function(t,e){if(T(["_update","_onMapClick"],this),!t){t=L.create("div");var i=L.createNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS(null,"height","41px"),i.setAttributeNS(null,"width","27px"),i.setAttributeNS(null,"viewBox","0 0 27 41");var n=L.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"stroke-width","1"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"fill-rule","evenodd");var r=L.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"fill-rule","nonzero");var o=L.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"transform","translate(3.0, 29.0)"),o.setAttributeNS(null,"fill","#000000");for(var a=0,s=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];a<s.length;a+=1){var l=s[a],u=L.createNS("http://www.w3.org/2000/svg","ellipse");u.setAttributeNS(null,"opacity","0.04"),u.setAttributeNS(null,"cx","10.5"),u.setAttributeNS(null,"cy","5.80029008"),u.setAttributeNS(null,"rx",l.rx),u.setAttributeNS(null,"ry",l.ry),o.appendChild(u)}var h=L.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill","#3FB1CE");var p=L.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(p);var f=L.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"opacity","0.25"),f.setAttributeNS(null,"fill","#000000");var d=L.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),f.appendChild(d);var m=L.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(6.0, 7.0)"),m.setAttributeNS(null,"fill","#FFFFFF");var y=L.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var g=L.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");var v=L.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),y.appendChild(g),y.appendChild(v),r.appendChild(o),r.appendChild(h),r.appendChild(f),r.appendChild(m),r.appendChild(y),i.appendChild(r),t.appendChild(i);var _=[0,-14];e&&e.offset||(e?e.offset=_:e={offset:_})}this._offset=c.convert(e&&e.offset||[0,0]),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};Xc.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},Xc.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this},Xc.prototype.getLngLat=function(){return this._lngLat},Xc.prototype.setLngLat=function(t){return this._lngLat=Qa.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Xc.prototype.getElement=function(){return this._element},Xc.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&("offset"in t.options||(t.options.offset=this._offset),this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)),this},Xc.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},Xc.prototype.getPopup=function(){return this._popup},Xc.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},Xc.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Wc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),L.setTransform(this._element,"translate(-50%, -50%) translate("+this._pos.x+"px, "+this._pos.y+"px)"))},Xc.prototype.getOffset=function(){return this._offset},Xc.prototype.setOffset=function(t){return this._offset=c.convert(t),this._update(),this};var Hc,Kc={positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0};var Jc=function(t){function e(e){t.call(this),this.options=_({},Kc,e),T(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker","_onClickGeolocate"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){var e;return this._map=t,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,void 0!==Hc?e(Hc):void 0!==self.navigator.permissions?self.navigator.permissions.query({name:"geolocation"}).then(function(t){Hc="denied"!==t.state,e(Hc)}):(Hc=!!self.navigator.geolocation,e(Hc)),this._container},e.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(self.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),L.remove(this._container),this._map=void 0},e.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire("geolocate",t),this._finish()},e.prototype._updateCamera=function(t){var e=new Qa(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy;this._map.fitBounds(e.toBounds(i),this.options.fitBoundsOptions,{geolocateSource:!0})},e.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},e.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire("error",t),this._finish()},e.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},e.prototype._setupUI=function(t){var e=this;!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=L.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Xc(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)),this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==e._watchState||(e._watchState="BACKGROUND",e._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),e._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),e.fire("trackuserlocationend"))}))},e.prototype._onClickGeolocate=function(){if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire("trackuserlocationstart");break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire("trackuserlocationend");break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire("trackuserlocationstart")}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=self.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else self.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4)},e.prototype._clearWatch=function(){self.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},e}(H),Yc=function(t){this.options=t,T(["_onMove"],this)};function $c(t,e,i,n){var r,o,a,s=(r=i,(o=Math.pow(10,(""+Math.floor(r)).length-1))*(a=(a=r/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:1)),l=s/i;"m"===n&&s>=1e3&&(s/=1e3,n="km"),t.style.width=e*l+"px",t.innerHTML=s+n}Yc.prototype.getDefaultPosition=function(){return"bottom-left"},Yc.prototype._onMove=function(){!function(t,e,i){var n=i&&i.maxWidth||100,r=t._container.clientHeight/2,o=(a=t.unproject([0,r]),s=t.unproject([n,r]),l=Math.PI/180,u=a.lat*l,c=s.lat*l,h=Math.sin(u)*Math.sin(c)+Math.cos(u)*Math.cos(c)*Math.cos((s.lng-a.lng)*l),6371e3*Math.acos(Math.min(h,1)));var a,s,l,u,c,h;if(i&&"imperial"===i.unit){var p=3.2808*o;if(p>5280){var f=p/5280;$c(e,n,f,"mi")}else $c(e,n,p,"ft")}else if(i&&"nautical"===i.unit){var d=o/1852;$c(e,n,d,"nm")}else $c(e,n,o,"m")}(this._map,this._container,this.options)},Yc.prototype.onAdd=function(t){return this._map=t,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Yc.prototype.onRemove=function(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0};var Qc=function(){this._fullscreen=!1,T(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in self.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in self.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in self.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in self.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Qc.prototype.onAdd=function(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=L.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",M("This device does not support fullscreen mode.")),this._container},Qc.prototype.onRemove=function(){L.remove(this._container),this._map=null,self.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Qc.prototype._checkFullscreenSupport=function(){return!!(self.document.fullscreenEnabled||self.document.mozFullScreenEnabled||self.document.msFullscreenEnabled||self.document.webkitFullscreenEnabled)},Qc.prototype._setupUI=function(){var t=this._fullscreenButton=L.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),self.document.addEventListener(this._fullscreenchange,this._changeIcon)},Qc.prototype._isFullscreen=function(){return this._fullscreen},Qc.prototype._changeIcon=function(){(self.document.fullscreenElement||self.document.mozFullScreenElement||self.document.webkitFullscreenElement||self.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},Qc.prototype._onClickFullscreen=function(){this._isFullscreen()?self.document.exitFullscreen?self.document.exitFullscreen():self.document.mozCancelFullScreen?self.document.mozCancelFullScreen():self.document.msExitFullscreen?self.document.msExitFullscreen():self.document.webkitCancelFullScreen&&self.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()};var th={closeButton:!0,closeOnClick:!0},eh=function(t){function e(e){t.call(this),this.options=_(Object.create(th),e),T(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=Qa.convert(t),this._pos=null,this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(self.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,i=self.document.createDocumentFragment(),n=self.document.createElement("body");for(n.innerHTML=t;e=n.firstChild;)i.appendChild(e);return this.setDOMContent(i)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&L.remove(this._content),this._content=L.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=L.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=L.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=L.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this._map.transform.renderWorldCopies&&(this._lngLat=Wc(this._lngLat,this._pos,this._map.transform));var t=this._pos=this._map.project(this._lngLat),e=this.options.anchor,i=function t(e){if(e){if("number"==typeof e){var i=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{top:new c(0,e),"top-left":new c(i,i),"top-right":new c(-i,i),bottom:new c(0,-e),"bottom-left":new c(i,-i),"bottom-right":new c(-i,-i),left:new c(e,0),right:new c(-e,0)}}if(e instanceof c||Array.isArray(e)){var n=c.convert(e);return{top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{top:c.convert(e.top||[0,0]),"top-left":c.convert(e["top-left"]||[0,0]),"top-right":c.convert(e["top-right"]||[0,0]),bottom:c.convert(e.bottom||[0,0]),"bottom-left":c.convert(e["bottom-left"]||[0,0]),"bottom-right":c.convert(e["bottom-right"]||[0,0]),left:c.convert(e.left||[0,0]),right:c.convert(e.right||[0,0])}}return t(new c(0,0))}(this.options.offset);if(!e){var n=this._container.offsetWidth,r=this._container.offsetHeight;e=t.y+i.bottom.y<r?["top"]:t.y>this._map.transform.height-r?["bottom"]:[],t.x<n/2?e.push("left"):t.x>this._map.transform.width-n/2&&e.push("right"),e=0===e.length?"bottom":e.join("-")}var o=t.add(i[e]).round(),a={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},s=this._container.classList;for(var l in a)s.remove("mapboxgl-popup-anchor-"+l);s.add("mapboxgl-popup-anchor-"+e),L.setTransform(this._container,a[e]+" translate("+o.x+"px,"+o.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(H);function ih(t){var e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,r=t;n<r.length;n+=1){i+=ih(r[n])+","}return i+"]"}for(var o=Object.keys(t).sort(),a="{",s=0;s<o.length;s++)a+=JSON.stringify(o[s])+":"+ih(t[o[s]])+",";return a+"}"}function nh(t){for(var e="",i=0,n=Kl;i<n.length;i+=1){e+="/"+ih(t[n[i]])}return e}var rh=function(t){t&&this.replace(t)};function oh(t,e,i,n,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-i/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<i/2;){var c=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>n;)u-=l.shift().angleDelta;if(u>r)return!1;a++,s+=h.dist(p)}return!0}function ah(t,e,i,n,r,o,a,s,l){var u=n?.6*o*a:0,c=Math.max(n?n.right-n.left:0,r?r.right-r.left:0),h=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-c*a<e/4&&(e=c*a+e/4),function t(e,i,n,r,o,a,s,l,u){var c=a/2;var h=0;for(var p=0;p<e.length-1;p++)h+=e[p].dist(e[p+1]);var f=0,d=i-n;var m=[];for(var y=0;y<e.length-1;y++){for(var g=e[y],v=e[y+1],_=g.dist(v),x=v.angleTo(g);d+n<f+_;){var b=((d+=n)-f)/_,w=Ft(g.x,v.x,b),T=Ft(g.y,v.y,b);if(w>=0&&w<u&&T>=0&&T<u&&d-c>=0&&d+c<=h){var S=new Mo(w,T,x,y);S._round(),r&&!oh(e,S,a,r,o)||m.push(S)}}f+=_}l||m.length||s||(m=t(e,f/2,n,r,o,a,s,!0,u));return m}(t,h?e/2*s%e:(c/2+2*o)*a*s%e,e,u,i,c*a,h,!1,l)}rh.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},rh.prototype.update=function(t,e){for(var i=this,n=0,r=t;n<r.length;n+=1){var o=r[n];i._layerConfigs[o.id]=o;var a=i._layers[o.id]=Xo(o);a._featureFilter=Ge(a.filter)}for(var s=0,l=e;s<l.length;s+=1){var u=l[s];delete i._layerConfigs[u],delete i._layers[u]}this.familiesBySource={};for(var c=0,h=function(t){for(var e={},i=0;i<t.length;i++){var n=nh(t[i]),r=e[n];r||(r=e[n]=[]),r.push(t[i])}var o=[];for(var a in e)o.push(e[a]);return o}(v(this._layerConfigs));c<h.length;c+=1){var p=h[c].map(function(t){return i._layers[t.id]}),f=p[0];if("none"!==f.visibility){var d=f.source||"",m=i.familiesBySource[d];m||(m=i.familiesBySource[d]={});var y=f.sourceLayer||"_geojsonTileLayer",g=m[y];g||(g=m[y]=[]),g.push(p)}}};var sh=function(){this.opacity=0,this.targetOpacity=0,this.time=0};sh.prototype.clone=function(){var t=new sh;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},hi("OpacityState",sh);var lh=function(t,e,i,n,r,o,a,s,l,u,c){var h=a.top*s-l,p=a.bottom*s+l,f=a.left*s-l,d=a.right*s+l;if(this.boxStartIndex=t.length,u){var m=p-h,y=d-f;m>0&&(m=Math.max(10*s,m),this._addLineCollisionCircles(t,e,i,i.segment,y,m,n,r,o,c))}else t.emplaceBack(i.x,i.y,f,h,d,p,n,r,o,0,0);this.boxEndIndex=t.length};lh.prototype._addLineCollisionCircles=function(t,e,i,n,r,o,a,s,l,u){var c=o/2,h=Math.floor(r/c),p=1+.4*Math.log(u)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,m=i,y=n+1,g=d,v=-r/2,_=v-r/4;do{if(--y<0){if(g>v)return;y=0;break}g-=e[y].dist(m),m=e[y]}while(g>_);for(var x=e[y].dist(e[y+1]),b=-f;b<h+f;b++){var w=b*c,T=v+w;if(w<0&&(T+=w),w>r&&(T+=w-r),!(T<g)){for(;g+x<T;){if(g+=x,++y+1>=e.length)return;x=e[y].dist(e[y+1])}var S=T-g,z=e[y],A=e[y+1].sub(z)._unit()._mult(S)._add(z)._round(),k=Math.abs(T-d)<c?0:.8*(T-d);t.emplaceBack(A.x,A.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,k)}}};var uh=ch;function ch(t,e){if(!(this instanceof ch))return new ch(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||hh,this.length>0)for(var i=this.length>>1;i>=0;i--)this._down(i)}function hh(t,e){return t<e?-1:t>e?1:0}function ph(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!1);for(var n=1/0,r=1/0,o=-1/0,a=-1/0,s=t[0],l=0;l<s.length;l++){var u=s[l];(!l||u.x<n)&&(n=u.x),(!l||u.y<r)&&(r=u.y),(!l||u.x>o)&&(o=u.x),(!l||u.y>a)&&(a=u.y)}var h=o-n,p=a-r,f=Math.min(h,p),d=f/2,m=new uh(null,fh);if(0===f)return new c(n,r);for(var y=n;y<o;y+=f)for(var g=r;g<a;g+=f)m.push(new dh(y+d,g+d,d,t));for(var v=function(t){for(var e=0,i=0,n=0,r=t[0],o=0,a=r.length,s=a-1;o<a;s=o++){var l=r[o],u=r[s],c=l.x*u.y-u.x*l.y;i+=(l.x+u.x)*c,n+=(l.y+u.y)*c,e+=3*c}return new dh(i/e,n/e,0,t)}(t),_=m.length;m.length;){var x=m.pop();(x.d>v.d||!v.d)&&(v=x,i&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,_)),x.max-v.d<=e||(d=x.h/2,m.push(new dh(x.p.x-d,x.p.y-d,d,t)),m.push(new dh(x.p.x+d,x.p.y-d,d,t)),m.push(new dh(x.p.x-d,x.p.y+d,d,t)),m.push(new dh(x.p.x+d,x.p.y+d,d,t)),_+=4)}return i&&(console.log("num probes: "+_),console.log("best distance: "+v.d)),v.p}function fh(t,e){return e.max-t.max}function dh(t,e,i,n){this.p=new c(t,e),this.h=i,this.d=function(t,e){for(var i=!1,n=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(i=!i),n=Math.min(n,Dn(t,u,c))}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}function mh(t,e,i,n,r,o){t.createArrays(),t.symbolInstances=[];var a=512*t.overscaling;t.tilePixelRatio=xn/a,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,p=c.max;u.compositeTextSizes=[l["text-size"].possiblyEvaluate(new ao(h)),l["text-size"].possiblyEvaluate(new ao(p))]}if("composite"===t.iconSizeData.functionType){var f=t.iconSizeData.zoomRange,d=f.min,m=f.max;u.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new ao(d)),l["icon-size"].possiblyEvaluate(new ao(m))]}u.layoutTextSize=l["text-size"].possiblyEvaluate(new ao(t.zoom+1)),u.layoutIconSize=l["icon-size"].possiblyEvaluate(new ao(t.zoom+1)),u.textMaxSize=l["text-size"].possiblyEvaluate(new ao(18));for(var y=24*s.get("text-line-height"),g="map"===s.get("text-rotation-alignment")&&"line"===s.get("symbol-placement"),v=s.get("text-keep-upright"),_=0,x=t.features;_<x.length;_+=1){var b=x[_],w=s.get("text-font").evaluate(b).join(","),T=e[w]||{},S=i[w]||{},z={},A=b.text;if(A){var k=s.get("text-offset").evaluate(b).map(function(t){return 24*t}),E=24*s.get("text-letter-spacing").evaluate(b),I=zo(A)?E:0,C=s.get("text-anchor").evaluate(b),P=s.get("text-justify").evaluate(b),L="line"!==s.get("symbol-placement")?24*s.get("text-max-width").evaluate(b):0;z.horizontal=Ls(A,T,L,y,C,P,I,k,24,Ps.horizontal),So(A)&&g&&v&&(z.vertical=Ls(A,T,L,y,C,P,I,k,24,Ps.vertical))}var D=void 0;if(b.icon){var R=n[b.icon];R&&(D=Us(r[b.icon],s.get("icon-offset").evaluate(b),s.get("icon-anchor").evaluate(b)),void 0===t.sdfIcons?t.sdfIcons=R.sdf:t.sdfIcons!==R.sdf&&M("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),R.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(z.horizontal||D)&&yh(t,b,z,D,S,u)}o&&t.generateCollisionDebugBuffers()}function yh(t,e,i,n,r,o){var a=o.layoutTextSize.evaluate(e),s=o.layoutIconSize.evaluate(e),l=o.textMaxSize.evaluate(e);void 0===l&&(l=a);var u=t.layers[0].layout,h=u.get("text-offset").evaluate(e),p=u.get("icon-offset").evaluate(e),f=a/24,d=t.tilePixelRatio*f,m=t.tilePixelRatio*l/24,y=t.tilePixelRatio*s,g=t.tilePixelRatio*u.get("symbol-spacing"),v=u.get("text-padding")*t.tilePixelRatio,_=u.get("icon-padding")*t.tilePixelRatio,x=u.get("text-max-angle")/180*Math.PI,b="map"===u.get("text-rotation-alignment")&&"line"===u.get("symbol-placement"),w="map"===u.get("icon-rotation-alignment")&&"line"===u.get("symbol-placement"),T=g/2,S=function(a,s){s.x<0||s.x>=xn||s.y<0||s.y>=xn||t.symbolInstances.push(function(t,e,i,n,r,o,a,s,l,u,h,p,f,d,m,y,g,v,_,x,b,w){var T,S,z=t.addToLineVertexArray(e,i),A=0,k=0,E=0,I=n.horizontal?n.horizontal.text:"",C=[];n.horizontal&&(T=new lh(a,i,e,s,l,u,n.horizontal,h,p,f,t.overscaling),k+=gh(t,e,n.horizontal,o,f,_,x,d,z,n.vertical?Ps.horizontal:Ps.horizontalOnly,C,b,w),n.vertical&&(E+=gh(t,e,n.vertical,o,f,_,x,d,z,Ps.vertical,C,b,w)));var P=T?T.boxStartIndex:t.collisionBoxArray.length,L=T?T.boxEndIndex:t.collisionBoxArray.length;if(r){var D=function(t,e,i,n,r,o,a){var s,l,u,h,p=e.image,f=i.layout,d=e.top-1/p.pixelRatio,m=e.left-1/p.pixelRatio,y=e.bottom+1/p.pixelRatio,g=e.right+1/p.pixelRatio;if("none"!==f.get("icon-text-fit")&&r){var v=g-m,_=y-d,x=f.get("text-size").evaluate(a)/24,b=r.left*x,w=r.right*x,T=r.top*x,S=w-b,z=r.bottom*x-T,A=f.get("icon-text-fit-padding")[0],k=f.get("icon-text-fit-padding")[1],E=f.get("icon-text-fit-padding")[2],I=f.get("icon-text-fit-padding")[3],M="width"===f.get("icon-text-fit")?.5*(z-_):0,C="height"===f.get("icon-text-fit")?.5*(S-v):0,P="width"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?S:v,L="height"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?z:_;s=new c(b+C-I,T+M-A),l=new c(b+C+k+P,T+M-A),u=new c(b+C+k+P,T+M+E+L),h=new c(b+C-I,T+M+E+L)}else s=new c(m,d),l=new c(g,d),u=new c(g,y),h=new c(m,y);var D=i.layout.get("icon-rotate").evaluate(a)*Math.PI/180;if(D){var R=Math.sin(D),B=Math.cos(D),O=[B,-R,R,B];s._matMult(O),l._matMult(O),h._matMult(O),u._matMult(O)}return[{tl:s,tr:l,bl:h,br:u,tex:{x:p.textureRect.x-1,y:p.textureRect.y-1,w:p.textureRect.w+2,h:p.textureRect.h+2},writingMode:void 0,glyphOffset:[0,0]}]}(0,r,o,0,n.horizontal,0,x);S=new lh(a,i,e,s,l,u,r,m,y,!1,t.overscaling),A=4*D.length;var R=t.iconSizeData,B=null;"source"===R.functionType?B=[10*o.layout.get("icon-size").evaluate(x)]:"composite"===R.functionType&&(B=[10*w.compositeIconSizes[0].evaluate(x),10*w.compositeIconSizes[1].evaluate(x)]),t.addSymbols(t.icon,D,B,v,g,x,!1,e,z.lineStartIndex,z.lineLength)}var O=S?S.boxStartIndex:t.collisionBoxArray.length,F=S?S.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=jo.MAX_GLYPHS&&M("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var j=new sh,V=new sh;return{key:I,textBoxStartIndex:P,textBoxEndIndex:L,iconBoxStartIndex:O,iconBoxEndIndex:F,textOffset:d,iconOffset:v,anchor:e,line:i,featureIndex:s,feature:x,numGlyphVertices:k,numVerticalGlyphVertices:E,numIconVertices:A,textOpacityState:j,iconOpacityState:V,isDuplicate:!1,placedTextSymbolIndices:C,crossTileID:0}}(t,s,a,i,n,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,d,v,b,h,y,_,w,p,{zoom:t.zoom},e,r,o))};if("line"===u.get("symbol-placement"))for(var z=0,A=function(t,e,i,n,r){for(var o=[],a=0;a<t.length;a++)for(var s=t[a],l=void 0,u=0;u<s.length-1;u++){var h=s[u],p=s[u+1];h.x<e&&p.x<e||(h.x<e?h=new c(e,h.y+(p.y-h.y)*((e-h.x)/(p.x-h.x)))._round():p.x<e&&(p=new c(e,h.y+(p.y-h.y)*((e-h.x)/(p.x-h.x)))._round()),h.y<i&&p.y<i||(h.y<i?h=new c(h.x+(p.x-h.x)*((i-h.y)/(p.y-h.y)),i)._round():p.y<i&&(p=new c(h.x+(p.x-h.x)*((i-h.y)/(p.y-h.y)),i)._round()),h.x>=n&&p.x>=n||(h.x>=n?h=new c(n,h.y+(p.y-h.y)*((n-h.x)/(p.x-h.x)))._round():p.x>=n&&(p=new c(n,h.y+(p.y-h.y)*((n-h.x)/(p.x-h.x)))._round()),h.y>=r&&p.y>=r||(h.y>=r?h=new c(h.x+(p.x-h.x)*((r-h.y)/(p.y-h.y)),r)._round():p.y>=r&&(p=new c(h.x+(p.x-h.x)*((r-h.y)/(p.y-h.y)),r)._round()),l&&h.equals(l[l.length-1])||(l=[h],o.push(l)),l.push(p)))))}return o}(e.geometry,0,0,xn,xn);z<A.length;z+=1)for(var k=A[z],E=0,I=ah(k,g,x,i.vertical||i.horizontal,n,24,m,t.overscaling,xn);E<I.length;E+=1){var C=I[E],P=i.horizontal;P&&vh(t,P.text,T,C)||S(k,C)}else if("Polygon"===e.type)for(var L=0,D=kr(e.geometry,0);L<D.length;L+=1){var R=D[L],B=ph(R,16);S(R[0],new Mo(B.x,B.y,0))}else if("LineString"===e.type)for(var O=0,F=e.geometry;O<F.length;O+=1){var j=F[O];S(j,new Mo(j[0].x,j[0].y,0))}else if("Point"===e.type)for(var V=0,N=e.geometry;V<N.length;V+=1)for(var U=0,q=N[V];U<q.length;U+=1){var Z=q[U];S([Z],new Mo(Z.x,Z.y,0))}}function gh(t,e,i,n,r,o,a,s,l,u,h,p,f){var d=function(t,e,i,n,r,o,a){for(var s=i.layout.get("text-rotate").evaluate(o)*Math.PI/180,l=i.layout.get("text-offset").evaluate(o).map(function(t){return 24*t}),u=e.positionedGlyphs,h=[],p=0;p<u.length;p++){var f=u[p],d=a[f.glyph];if(d){var m=d.rect;if(m){var y=Fa+1,g=d.metrics.advance/2,v=n?[f.x+g,f.y]:[0,0],_=n?[0,0]:[f.x+g+l[0],f.y+l[1]],x=d.metrics.left-y-g+_[0],b=-d.metrics.top-y+_[1],w=x+m.w,T=b+m.h,S=new c(x,b),z=new c(w,b),A=new c(x,T),k=new c(w,T);if(n&&f.vertical){var E=new c(-g,g),I=-Math.PI/2,M=new c(5,0);S._rotateAround(I,E)._add(M),z._rotateAround(I,E)._add(M),A._rotateAround(I,E)._add(M),k._rotateAround(I,E)._add(M)}if(s){var C=Math.sin(s),P=Math.cos(s),L=[P,-C,C,P];S._matMult(L),z._matMult(L),A._matMult(L),k._matMult(L)}h.push({tl:S,tr:z,bl:A,br:k,tex:m,writingMode:e.writingMode,glyphOffset:v})}}}return h}(0,i,n,r,0,a,p),m=t.textSizeData,y=null;return"source"===m.functionType?y=[10*n.layout.get("text-size").evaluate(a)]:"composite"===m.functionType&&(y=[10*f.compositeTextSizes[0].evaluate(a),10*f.compositeTextSizes[1].evaluate(a)]),t.addSymbols(t.text,d,y,s,r,a,u,e,l.lineStartIndex,l.lineLength),h.push(t.text.placedSymbolArray.length-1),4*d.length}function vh(t,e,i,n){var r=t.compareText;if(e in r){for(var o=r[e],a=o.length-1;a>=0;a--)if(n.dist(o[a])<i)return!0}else r[e]=[];return r[e].push(n),!1}ch.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length,r=n>>1,o=e[t];t<r;){var a=1+(t<<1),s=a+1,l=e[a];if(s<n&&i(e[s],l)<0&&(a=s,l=e[s]),i(l,o)>=0)break;e[t]=l,t=a}e[t]=o}};var _h=1;var xh=function(t){this.tileID=new us(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming};function bh(t,e){for(var i=new ao(e),n=0,r=t;n<r.length;n+=1){r[n].recalculate(i)}}xh.prototype.parse=function(t,e,i,n){var r=this;this.status="parsing",this.data=t,this.collisionBoxArray=new Qi;var o=new Ts(Object.keys(t.layers).sort()),a=new As(this.tileID,this.overscaling);a.bucketLayerIDs=[];var s,l,u,c={},h={featureIndex:a,iconDependencies:{},glyphDependencies:{}},p=e.familiesBySource[this.source];for(var f in p){var d=t.layers[f];if(d){1===d.version&&M('Vector tile source "'+r.source+'" layer "'+f+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var m=o.encode(f),y=[],g=0;g<d.length;g++){var _=d.feature(g);y.push({feature:_,index:g,sourceLayerIndex:m})}for(var x=0,b=p[f];x<b.length;x+=1){var w=b[x],T=w[0];if(!(T.minzoom&&r.zoom<Math.floor(T.minzoom)))if(!(T.maxzoom&&r.zoom>=T.maxzoom))if("none"!==T.visibility)bh(w,r.zoom),(c[T.id]=T.createBucket({index:a.bucketLayerIDs.length,layers:w,zoom:r.zoom,pixelRatio:r.pixelRatio,overscaling:r.overscaling,collisionBoxArray:r.collisionBoxArray})).populate(y,h),a.bucketLayerIDs.push(w.map(function(t){return t.id}))}}}var S=z(h.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(S).length?i.send("getGlyphs",{uid:this.uid,stacks:S},function(t,e){s||(s=t,l=e,k.call(r))}):l={};var A=Object.keys(h.iconDependencies);function k(){if(s)return n(s);if(l&&u){var t=function(t){var e=new Wn({width:0,height:0}),i={},n=new aa(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=i[r]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u=n.packOne(l.bitmap.width+2*_h,l.bitmap.height+2*_h);e.resize({width:n.w,height:n.h}),Wn.copy(l.bitmap,e,{x:0,y:0},{x:u.x+_h,y:u.y+_h},l.bitmap),a[s]={rect:u,metrics:l.metrics}}}}return n.shrink(),e.resize({width:n.w,height:n.h}),{image:e,positions:i}}(l),e=function(t){var e=new Xn({width:0,height:0}),i={},n=new aa(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=n.packOne(o.data.width+2*sa,o.data.height+2*sa);e.resize({width:n.w,height:n.h}),Xn.copy(o.data,e,{x:0,y:0},{x:a.x+sa,y:a.y+sa},o.data),i[r]=la(a,o)}return n.shrink(),e.resize({width:n.w,height:n.h}),{image:e,positions:i}}(u);for(var i in c){var r=c[i];r instanceof jo&&(bh(r.layers,this.zoom),mh(r,l,t.positions,u,e.positions,this.showCollisionBoxes))}this.status="done",n(null,{buckets:v(c).filter(function(t){return!t.isEmpty()}),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,iconAtlasImage:e.image})}}A.length?i.send("getImages",{icons:A},function(t,e){s||(s=t,u=e,k.call(r))}):u={},k.call(this)};var wh=function(t){return!(!performance||!performance.getEntriesByName)&&performance.getEntriesByName(t)};function Th(t,e){var i=Z(t.request,function(t,i){t?e(t):i&&e(null,{vectorTile:new Kr.VectorTile(new ga(i.data)),rawData:i.data,cacheControl:i.cacheControl,expires:i.expires})});return function(){i.abort(),e()}}var Sh=function(t,e,i){this.actor=t,this.layerIndex=e,this.loadVectorData=i||Th,this.loading={},this.loaded={}};Sh.prototype.loadTile=function(t,e){var i=this,n=t.uid;this.loading||(this.loading={});var r=this.loading[n]=new xh(t);r.abort=this.loadVectorData(t,function(o,a){if(delete i.loading[n],o||!a)return e(o);var s=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var u={};if(t.request&&t.request.collectResourceTiming){var c=wh(t.request.url);c&&(u.resourceTiming=JSON.parse(JSON.stringify(c)))}r.vectorTile=a.vectorTile,r.parse(a.vectorTile,i.layerIndex,i.actor,function(t,i){if(t||!i)return e(t);e(null,_({rawTileData:s.slice(0)},i,l,u))}),i.loaded=i.loaded||{},i.loaded[n]=r})},Sh.prototype.reloadTile=function(t,e){var i=this.loaded,n=t.uid,r=this;if(i&&i[n]){var o=i[n];o.showCollisionBoxes=t.showCollisionBoxes,"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,function(t,i){if(this.reloadCallback){var n=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,r.layerIndex,r.actor,n)}e(t,i)}.bind(o))}},Sh.prototype.abortTile=function(t,e){var i=this.loading,n=t.uid;i&&i[n]&&i[n].abort&&(i[n].abort(),delete i[n]),e()},Sh.prototype.removeTile=function(t,e){var i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()};var zh=function(t,e,i){if(t<=0)throw new RangeError("Level must have positive dimension");this.dim=t,this.border=e,this.stride=this.dim+2*this.border,this.data=i||new Int32Array((this.dim+2*this.border)*(this.dim+2*this.border))};zh.prototype.set=function(t,e,i){this.data[this._idx(t,e)]=i+65536},zh.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},zh.prototype._idx=function(t,e){if(t<-this.border||t>=this.dim+this.border||e<-this.border||e>=this.dim+this.border)throw new RangeError("out of range source coordinates for DEM data");return(e+this.border)*this.stride+(t+this.border)},hi("Level",zh);var Ah=function(t,e,i){this.uid=t,this.scale=e||1,this.level=i||new zh(256,512),this.loaded=!!i};Ah.prototype.loadFromImage=function(t){if(t.height!==t.width)throw new RangeError("DEM tiles must be square");for(var e=this.level=new zh(t.width,t.width/2),i=t.data,n=0;n<e.dim;n++)for(var r=0;r<e.dim;r++){var o=4*(n*e.dim+r);e.set(r,n,this.scale*((256*i[o]*256+256*i[o+1]+i[o+2])/10-1e4))}for(var a=0;a<e.dim;a++)e.set(-1,a,e.get(0,a)),e.set(e.dim,a,e.get(e.dim-1,a)),e.set(a,-1,e.get(a,0)),e.set(a,e.dim,e.get(a,e.dim-1));e.set(-1,-1,e.get(0,0)),e.set(e.dim,-1,e.get(e.dim-1,0)),e.set(-1,e.dim,e.get(0,e.dim-1)),e.set(e.dim,e.dim,e.get(e.dim-1,e.dim-1)),this.loaded=!0},Ah.prototype.getPixels=function(){return new Xn({width:this.level.dim+2*this.level.border,height:this.level.dim+2*this.level.border},new Uint8Array(this.level.data.buffer))},Ah.prototype.backfillBorder=function(t,e,i){var n=this.level,r=t.level;if(n.dim!==r.dim)throw new Error("level mismatch (dem dimension)");var o=e*n.dim,a=e*n.dim+n.dim,s=i*n.dim,l=i*n.dim+n.dim;switch(e){case-1:o=a-1;break;case 1:a=o+1}switch(i){case-1:s=l-1;break;case 1:l=s+1}for(var u=m(o,-n.border,n.dim+n.border),c=m(a,-n.border,n.dim+n.border),h=m(s,-n.border,n.dim+n.border),p=m(l,-n.border,n.dim+n.border),f=-e*n.dim,d=-i*n.dim,y=h;y<p;y++)for(var g=u;g<c;g++)n.set(g,y,r.get(g+f,y+d))},hi("DEMData",Ah);var kh=function(){this.loading={},this.loaded={}};kh.prototype.loadTile=function(t,e){var i=t.uid,n=new Ah(i);this.loading[i]=n,n.loadFromImage(t.rawImageData),delete this.loading[i],this.loaded=this.loaded||{},this.loaded[i]=n,e(null,n)},kh.prototype.removeTile=function(t){var e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]};var Eh={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function Ih(t){var e=0;if(t&&t.length>0){e+=Math.abs(Mh(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(Mh(t[i]))}return e}function Mh(t){var e,i,n,r,o,a,s=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(n=l-2,r=l-1,o=0):a===l-1?(n=l-1,r=0,o=1):(n=a,r=a+1,o=a+2),e=t[n],i=t[r],s+=(Ch(t[o][0])-Ch(e[0]))*Math.sin(Ch(i[1]));s=s*Eh.RADIUS*Eh.RADIUS/2}return s}function Ch(t){return t*Math.PI/180}var Ph={geometry:function t(e){var i,n=0;switch(e.type){case"Polygon":return Ih(e.coordinates);case"MultiPolygon":for(i=0;i<e.coordinates.length;i++)n+=Ih(e.coordinates[i]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)n+=t(e.geometries[i]);return n}},ring:Mh},Lh=function t(e,i){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(Dh(t,i)),e;case"Feature":return e.geometry=t(e.geometry,i),e;case"Polygon":case"MultiPolygon":return function(t,e){"Polygon"===t.type?t.coordinates=Rh(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(Dh(Rh,e)));return t}(e,i);default:return e}};function Dh(t,e){return function(i){return t(i,e)}}function Rh(t,e){e=!!e,t[0]=Bh(t[0],e);for(var i=1;i<t.length;i++)t[i]=Bh(t[i],!e);return t}function Bh(t,e){return function(t){return Ph.ring(t)>=0}(t)===e?t:t.reverse()}var Oh=Kr.VectorTileFeature.prototype.toGeoJSON,Fh=function(t){this._feature=t,this.extent=xn,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};Fh.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],e=0,i=this._feature.geometry;e<i.length;e+=1){var n=i[e];t.push([new c(n[0],n[1])])}return t}for(var r=[],o=0,a=this._feature.geometry;o<a.length;o+=1){for(var s=[],l=0,u=a[o];l<u.length;l+=1){var h=u[l];s.push(new c(h[0],h[1]))}r.push(s)}return r},Fh.prototype.toGeoJSON=function(t,e,i){return Oh.call(this,t,e,i)};var jh=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=xn,this.length=t.length,this._features=t};jh.prototype.feature=function(t){return new Fh(this._features[t])};var Vh=Kr.VectorTileFeature,Nh=Uh;function Uh(t){this.features=t,this.length=t.length}function qh(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}Uh.prototype.feature=function(t){return new qh(this.features[t])},qh.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new c(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},qh.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},qh.prototype.toGeoJSON=Vh.prototype.toGeoJSON;var Zh=Hh,Gh=Hh,Wh=function(t){var e={};for(var i in t)e[i]=new Nh(t[i].features),e[i].name=i;return Hh({layers:e})},Xh=Nh;function Hh(t){var e=new ga;return function(t,e){for(var i in t.layers)e.writeMessage(3,Kh,t.layers[i])}(t,e),e.finish()}function Kh(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,Jh,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)e.writeMessage(4,ep,o[i])}function Jh(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,Yh,t),e.writeVarintField(3,i.type),e.writeMessage(4,tp,i)}function Yh(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,a=t.valuecache;for(var s in i.properties){var l=o[s];void 0===l&&(n.push(s),l=n.length-1,o[s]=l),e.writeVarint(l);var u=i.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(r.push(u),p=r.length-1,a[h]=p),e.writeVarint(p)}}function $h(t,e){return(e<<3)+(7&t)}function Qh(t){return t<<1^t>>31}function tp(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],u=1;1===n&&(u=l.length),e.writeVarint($h(1,u));for(var c=0;c<l.length;c++){1===c&&1!==n&&e.writeVarint($h(2,l.length-1));var h=l[c].x-r,p=l[c].y-o;e.writeVarint(Qh(h)),e.writeVarint(Qh(p)),r+=h,o+=p}}}function ep(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}Zh.fromVectorTileJs=Gh,Zh.fromGeojsonVt=Wh,Zh.GeoJSONWrapper=Xh;var ip=function t(e,i,n,r,o,a){if(o-r<=n)return;var s=Math.floor((r+o)/2);!function t(e,i,n,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,l=n-r+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1),p=Math.max(r,Math.floor(n-l*c/s+h)),f=Math.min(o,Math.floor(n+(s-l)*c/s+h));t(e,i,n,p,f,a)}var d=i[2*n+a],m=r,y=o;for(np(e,i,r,n),i[2*o+a]>d&&np(e,i,r,o);m<y;){for(np(e,i,m,y),m++,y--;i[2*m+a]<d;)m++;for(;i[2*y+a]>d;)y--}i[2*r+a]===d?np(e,i,r,y):np(e,i,++y,o),y<=n&&(r=y+1),n<=y&&(o=y-1)}}(e,i,s,r,o,a%2);t(e,i,n,r,s-1,a+1);t(e,i,n,s+1,o,a+1)};function np(t,e,i,n){rp(t,i,n),rp(e,2*i,2*n),rp(e,2*i+1,2*n+1)}function rp(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}var op=function(t,e,i,n,r,o,a){var s,l,u=[0,t.length-1,0],c=[];for(;u.length;){var h=u.pop(),p=u.pop(),f=u.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],l=e[2*d+1],s>=i&&s<=r&&l>=n&&l<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);s=e[2*m],l=e[2*m+1],s>=i&&s<=r&&l>=n&&l<=o&&c.push(t[m]);var y=(h+1)%2;(0===h?i<=s:n<=l)&&(u.push(f),u.push(m-1),u.push(y)),(0===h?r>=s:o>=l)&&(u.push(m+1),u.push(p),u.push(y))}}return c};var ap=function(t,e,i,n,r,o){var a=[0,t.length-1,0],s=[],l=r*r;for(;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)sp(e[2*p],e[2*p+1],i,n)<=l&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],m=e[2*f+1];sp(d,m,i,n)<=l&&s.push(t[f]);var y=(u+1)%2;(0===u?i-r<=d:n-r<=m)&&(a.push(h),a.push(f-1),a.push(y)),(0===u?i+r>=d:n+r>=m)&&(a.push(f+1),a.push(c),a.push(y))}}return s};function sp(t,e,i,n){var r=t-i,o=e-n;return r*r+o*o}var lp=function(t,e,i,n,r){return new up(t,e,i,n,r)};function up(t,e,i,n,r){e=e||cp,i=i||hp,r=r||Array,this.nodeSize=n||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=i(t[o]);ip(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function cp(t){return t[0]}function hp(t){return t[1]}up.prototype={range:function(t,e,i,n){return op(this.ids,this.coords,t,e,i,n,this.nodeSize)},within:function(t,e,i){return ap(this.ids,this.coords,t,e,i,this.nodeSize)}};var pp=function(t){return new fp(t)};function fp(t){this.options=xp(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function dp(t,e,i,n,r){return{x:t,y:e,zoom:1/0,id:n,properties:r,parentId:-1,numPoints:i}}function mp(t,e){var i=t.geometry.coordinates;return{x:vp(i[0]),y:_p(i[1]),zoom:1/0,id:e,parentId:-1}}function yp(t){return{type:"Feature",properties:gp(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,i=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var e,i,n}function gp(t){var e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return xp(xp({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function vp(t){return t/360+.5}function _p(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function xp(t,e){for(var i in e)t[i]=e[i];return t}function bp(t){return t.x}function wp(t){return t.y}fp.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var i="prepare "+t.length+" points";e&&console.time(i),this.points=t;var n=t.map(mp);e&&console.timeEnd(i);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var o=+Date.now();this.trees[r+1]=lp(n,bp,wp,this.options.nodeSize,Float32Array),n=this._cluster(n,r),e&&console.log("z%d: %d clusters in %dms",r,n.length,+Date.now()-o)}return this.trees[this.options.minZoom]=lp(n,bp,wp,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var i=this.trees[this._limitZoom(e)],n=i.range(vp(t[0]),_p(t[3]),vp(t[2]),_p(t[1])),r=[],o=0;o<n.length;o++){var a=i.points[n[o]];r.push(a.numPoints?yp(a):this.points[a.id])}return r},getChildren:function(t,e){for(var i=this.trees[e+1].points[t],n=this.options.radius/(this.options.extent*Math.pow(2,e)),r=this.trees[e+1].within(i.x,i.y,n),o=[],a=0;a<r.length;a++){var s=this.trees[e+1].points[r[a]];s.parentId===t&&o.push(s.numPoints?yp(s):this.points[s.id])}return o},getLeaves:function(t,e,i,n){i=i||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,i,n,0),r},getTile:function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(i-a)/r,l=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,s,(e+1+a)/r,l),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,s,1,l),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,s,a/r,l),n.points,-1,i,r,u),u.features.length?u:null},getClusterExpansionZoom:function(t,e){for(;e<this.options.maxZoom;){var i=this.getChildren(t,e);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e},_appendLeaves:function(t,e,i,n,r,o){for(var a=this.getChildren(e,i),s=0;s<a.length;s++){var l=a[s].properties;if(l.cluster?o+l.point_count<=r?o+=l.point_count:o=this._appendLeaves(t,l.cluster_id,i+1,n,r,o):o<r?o++:t.push(a[s]),t.length===n)break}return o},_addTileFeatures:function(t,e,i,n,r,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*r-i)),Math.round(this.options.extent*(s.y*r-n))]],tags:s.numPoints?gp(s):this.points[s.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var i=[],n=this.options.radius/(this.options.extent*Math.pow(2,e)),r=0;r<t.length;r++){var o=t[r];if(!(o.zoom<=e)){o.zoom=e;var a=this.trees[e+1],s=a.within(o.x,o.y,n),l=o.numPoints||1,u=o.x*l,c=o.y*l,h=null;this.options.reduce&&(h=this.options.initial(),this._accumulate(h,o));for(var p=0;p<s.length;p++){var f=a.points[s[p]];if(e<f.zoom){var d=f.numPoints||1;f.zoom=e,u+=f.x*d,c+=f.y*d,l+=d,f.parentId=r,this.options.reduce&&this._accumulate(h,f)}}1===l?i.push(o):(o.parentId=r,i.push(dp(u/l,c/l,l,r,h)))}}return i},_accumulate:function(t,e){var i=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,i)}};var Tp=function t(e,i,n,r){var o=r;var a;var s=e[i];var l=e[i+1];var u=e[n];var c=e[n+1];for(var h=i+3;h<n;h+=3){var p=Sp(e[h],e[h+1],s,l,u,c);p>o&&(a=h,o=p)}o>r&&(a-i>3&&t(e,i,a,r),e[a+2]=o,n-a>3&&t(e,a,n,r))};function Sp(t,e,i,n,r,o){var a=r-i,s=o-n;if(0!==a||0!==s){var l=((t-i)*a+(e-n)*s)/(a*a+s*s);l>1?(i=r,n=o):l>0&&(i+=a*l,n+=s*l)}return(a=t-i)*a+(s=e-n)*s}var zp=function(t,e,i,n){var r={id:t||null,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Ap(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)Ap(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)Ap(t,e[n][r])}(r),r};function Ap(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}var kp=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Ep(i,t.features[n],e);else"Feature"===t.type?Ep(i,t,e):Ep(i,{geometry:t},e);return i};function Ep(t,e,i){if(e.geometry){var n=e.geometry.coordinates,r=e.geometry.type,o=i*i,a=[];if("Point"===r)Ip(n,a);else if("MultiPoint"===r)for(var s=0;s<n.length;s++)Ip(n[s],a);else if("LineString"===r)Mp(n,a,o,!1);else if("MultiLineString"===r)Cp(n,a,o,!1);else if("Polygon"===r)Cp(n,a,o,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"===r){for(s=0;s<e.geometry.geometries.length;s++)Ep(t,{geometry:e.geometry.geometries[s],properties:e.properties},i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(s=0;s<n.length;s++){var l=[];Cp(n[s],l,o,!0),a.push(l)}}t.push(zp(e.id,r,a,e.properties))}}function Ip(t,e){e.push(Pp(t[0])),e.push(Lp(t[1])),e.push(0)}function Mp(t,e,i,n){for(var r,o,a=0,s=0;s<t.length;s++){var l=Pp(t[s][0]),u=Lp(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=n?(r*u-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(u-o,2))),r=l,o=u}var c=e.length-3;e[2]=1,Tp(e,0,c,i),e[c+2]=1,e.size=Math.abs(a)}function Cp(t,e,i,n){for(var r=0;r<t.length;r++){var o=[];Mp(t[r],o,i,n),e.push(o)}}function Pp(t){return t/360+.5}function Lp(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Dp(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}var Rp={tile:function(t,e){if(t.transformed)return t;var i,n,r,o=t.z2,a=t.x,s=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(Dp(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var h=[];for(r=0;r<u[n].length;r+=2)h.push(Dp(u[n][r],u[n][r+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t},point:Dp},Bp=function(t,e,i,n,r,o,a){if(n/=e,o>=(i/=e)&&a<=n)return t;if(o>n||a<i)return null;for(var s=[],l=0;l<t.length;l++){var u=t[l],c=u.geometry,h=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=i&&f<=n)s.push(u);else if(!(p>n||f<i)){var d=[];if("Point"===h||"MultiPoint"===h)Op(c,d,i,n,r);else if("LineString"===h)Fp(c,d,i,n,r,!1);else if("MultiLineString"===h)jp(c,d,i,n,r,!1);else if("Polygon"===h)jp(c,d,i,n,r,!0);else if("MultiPolygon"===h)for(var m=0;m<c.length;m++){var y=[];jp(c[m],y,i,n,r,!0),y.length&&d.push(y)}d.length&&("LineString"!==h&&"MultiLineString"!==h||(1===d.length?(h="LineString",d=d[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===d.length?"Point":"MultiPoint"),s.push(zp(u.id,h,d,u.tags)))}}return s.length?s:null};function Op(t,e,i,n,r){for(var o=0;o<t.length;o+=3){var a=t[o+r];a>=i&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Fp(t,e,i,n,r,o){for(var a=[],s=0===r?Np:Up,l=0;l<t.length-3;l+=3){var u=t[l],c=t[l+1],h=t[l+2],p=t[l+3],f=t[l+4],d=0===r?u:c,m=0===r?p:f,y=!1;d<i?m>=i&&s(a,u,c,p,f,i):d>n?m<=n&&s(a,u,c,p,f,n):Vp(a,u,c,h),m<i&&d>=i&&(s(a,u,c,p,f,i),y=!0),m>n&&d<=n&&(s(a,u,c,p,f,n),y=!0),!o&&y&&(a.size=t.size,e.push(a),a=[])}var g=t.length-3;u=t[g],c=t[g+1],h=t[g+2],(d=0===r?u:c)>=i&&d<=n&&Vp(a,u,c,h),g=a.length-3,o&&g>=3&&(a[g]!==a[0]||a[g+1]!==a[1])&&Vp(a,a[0],a[1],a[2]),a.length&&(a.size=t.size,e.push(a))}function jp(t,e,i,n,r,o){for(var a=0;a<t.length;a++)Fp(t[a],e,i,n,r,o)}function Vp(t,e,i,n){t.push(e),t.push(i),t.push(n)}function Np(t,e,i,n,r,o){t.push(o),t.push(i+(o-e)*(r-i)/(n-e)),t.push(1)}function Up(t,e,i,n,r,o){t.push(e+(o-i)*(n-e)/(r-i)),t.push(o),t.push(1)}var qp=function(t,e){var i=t,n=Bp(t,1,-1-e,e,0,-1,2),r=Bp(t,1,1-e,2+e,0,-1,2);(n||r)&&(i=Bp(t,1,-e,1+e,0,-1,2)||[],n&&(i=Zp(n,1).concat(i)),r&&(i=i.concat(Zp(r,-1))));return i};function Zp(t,e){for(var i=[],n=0;n<t.length;n++){var r,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=Gp(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var s=0;s<o.geometry.length;s++)r.push(Gp(o.geometry[s],e))}else if("MultiPolygon"===a)for(r=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(Gp(o.geometry[s][u],e));r.push(l)}i.push(zp(o.id,a,r,o.tags))}return i}function Gp(t,e){var i=[];i.size=t.size;for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}var Wp=function(t,e,i,n,r,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z2:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Xp(a,t[s],r,o);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a};function Xp(t,e,i,n){var r=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Hp(a,r,t,i,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)Hp(a,r[s],t,i,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var u=r[l];for(s=0;s<u.length;s++)Hp(a,u[s],t,i,n,!0,0===s)}if(a.length){var c={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:e.tags||null};null!==e.id&&(c.id=e.id),t.features.push(c)}}function Hp(t,e,i,n,r,o,a){var s=n*n;if(!r&&e.size<(o?s:n))i.numPoints+=e.length/3;else{for(var l=[],u=0;u<e.length;u+=3)(r||e[u+2]>s)&&(i.numSimplified++,l.push(e[u]),l.push(e[u+1])),i.numPoints++;o&&function(t,e){for(var i=0,n=0,r=t.length,o=r-2;n<r;o=n,n+=2)i+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(i>0===e)for(n=0,r=t.length;n<r/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=a,t[r-1-n]=s}}(l,a),t.push(l)}}var Kp=function(t,e){return new Jp(t,e)};function Jp(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");var n=1<<e.maxZoom,r=kp(t,e.tolerance/(n*e.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=qp(r,e.buffer/e.extent)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yp(t,e,i){return 32*((1<<t)*i+e)+t}function $p(t,e){var i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);var r=new jh(n.features),o=Zh(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}Jp.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},Jp.prototype.splitTile=function(t,e,i,n,r,o,a){for(var s=[t,e,i,n],l=this.options,u=l.debug;s.length;){n=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Yp(e,i,n),p=this.tiles[h],f=e===l.maxZoom?0:l.tolerance/(c*l.extent);if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=Wp(t,c,i,n,f,e===l.maxZoom),this.tileCoords.push({z:e,x:i,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var m=1<<r-e;if(i!==Math.floor(o/m)||n!==Math.floor(a/m))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var y,g,v,_,x,b,w=.5*l.buffer/l.extent,T=.5-w,S=.5+w,z=1+w;y=g=v=_=null,x=Bp(t,c,i-w,i+S,0,p.minX,p.maxX),b=Bp(t,c,i+T,i+z,0,p.minX,p.maxX),t=null,x&&(y=Bp(x,c,n-w,n+S,1,p.minY,p.maxY),g=Bp(x,c,n+T,n+z,1,p.minY,p.maxY),x=null),b&&(v=Bp(b,c,n-w,n+S,1,p.minY,p.maxY),_=Bp(b,c,n+T,n+z,1,p.minY,p.maxY),b=null),u>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*i,2*n),s.push(g||[],e+1,2*i,2*n+1),s.push(v||[],e+1,2*i+1,2*n),s.push(_||[],e+1,2*i+1,2*n+1)}}},Jp.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=Yp(t,e=(e%a+a)%a,i);if(this.tiles[s])return Rp.tile(this.tiles[s],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,u=t,c=e,h=i;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[Yp(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Rp.tile(this.tiles[s],r):null):null};var Qp=function(t){function e(e,i,n){t.call(this,e,i,$p),n&&(this.loadGeoJSON=n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},e.prototype._loadData=function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var e=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams,this.loadGeoJSON(i,function(n,r){if(n||!r)return e(n);if("object"!=typeof r)return e(new Error("Input data is not a valid GeoJSON object."));Lh(r,!0);try{t._geoJSONIndex=i.cluster?pp(i.superclusterOptions).load(r.features):Kp(r,i.geojsonVtOptions)}catch(n){return e(n)}t.loaded={};var o={};if(i.request&&i.request.collectResourceTiming){var a=wh(i.request.url);a&&(o.resourceTiming={},o.resourceTiming[i.source]=JSON.parse(JSON.stringify(a)))}e(null,o)})}},e.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},e.prototype.reloadTile=function(e,i){var n=this.loaded,r=e.uid;return n&&n[r]?t.prototype.reloadTile.call(this,e,i):this.loadTile(e,i)},e.prototype.loadGeoJSON=function(t,e){if(t.request)q(t.request,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},e.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},e}(Sh),tf=function(t){var e=this;this.self=t,this.actor=new Ja(t,this),this.layerIndexes={},this.workerSourceTypes={vector:Sh,geojson:Qp},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,i){if(e.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');e.workerSourceTypes[t]=i},this.self.registerRTLTextPlugin=function(t){if(bo.applyArabicShaping||bo.processBidirectionalText)throw new Error("RTL text plugin already registered.");bo.applyArabicShaping=t.applyArabicShaping,bo.processBidirectionalText=t.processBidirectionalText}};tf.prototype.setLayers=function(t,e,i){this.getLayerIndex(t).replace(e),i()},tf.prototype.updateLayers=function(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()},tf.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).loadTile(e,i)},tf.prototype.loadDEMTile=function(t,e,i){this.getDEMWorkerSource(t,e.source).loadTile(e,i)},tf.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i)},tf.prototype.abortTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)},tf.prototype.removeTile=function(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)},tf.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},tf.prototype.removeSource=function(t,e,i){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}},tf.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t)}},tf.prototype.loadRTLTextPlugin=function(t,e,i){try{bo.applyArabicShaping||bo.processBidirectionalText||(this.self.importScripts(e),bo.applyArabicShaping&&bo.processBidirectionalText||i(new Error("RTL Text Plugin failed to import scripts from "+e)))}catch(t){i(t)}},tf.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new rh),e},tf.prototype.getWorkerSource=function(t,e,i){var n=this;if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][i]){var r={send:function(e,i,r){n.actor.send(e,i,r,t)}};this.workerSources[t][e][i]=new this.workerSourceTypes[e](r,this.getLayerIndex(t))}return this.workerSources[t][e][i]},tf.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new kh),this.demWorkerSources[t][e]};var ef={version:"0.44.0",supported:e,workerCount:Math.max(Math.floor(o.hardwareConcurrency/2),1),setRTLTextPlugin:function(t,e){if(go)throw new Error("setRTLTextPlugin cannot be called multiple times.");go=!0,co=e,Z({url:t},function(t,i){t?e(t):i&&(vo=function(t){return self.URL.createObjectURL(new self.Blob([t.data],{type:"text/javascript"}))}(i),_o.fire("pluginAvailable",{pluginBlobURL:vo,errorCallback:e}))})},Map:Uc,NavigationControl:Gc,GeolocateControl:Jc,AttributionControl:Oc,ScaleControl:Yc,FullscreenControl:Qc,Popup:eh,Marker:Xc,Style:Cu,LngLat:Qa,LngLatBounds:ts,Point:c,Evented:H,config:Ho,get accessToken(){return Ho.ACCESS_TOKEN},set accessToken(t){Ho.ACCESS_TOKEN=t},_createWorker:function(t){return new tf(t)}};return ef});
//# sourceMappingURL=mapboxgl-rollup.js.map
